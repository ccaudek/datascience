<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Capitolo 11 Inferenza sul parametro \(\mu\) (media di una v.c. Normale) | A Minimal Book Example</title>
  <meta name="description" content="This is a minimal example of using the bookdown package to write a book. The output format for this example is bookdown::gitbook." />
  <meta name="generator" content="bookdown 0.26.2 and GitBook 2.6.7" />

  <meta property="og:title" content="Capitolo 11 Inferenza sul parametro \(\mu\) (media di una v.c. Normale) | A Minimal Book Example" />
  <meta property="og:type" content="book" />
  
  <meta property="og:description" content="This is a minimal example of using the bookdown package to write a book. The output format for this example is bookdown::gitbook." />
  <meta name="github-repo" content="rstudio/bookdown-demo" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Capitolo 11 Inferenza sul parametro \(\mu\) (media di una v.c. Normale) | A Minimal Book Example" />
  
  <meta name="twitter:description" content="This is a minimal example of using the bookdown package to write a book. The output format for this example is bookdown::gitbook." />
  

<meta name="author" content="Yihui Xie" />


<meta name="date" content="2022-04-22" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="ch-prediction.html"/>

<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
/* Used with Pandoc 2.11+ new --citeproc when CSL is used */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">A Minimal Book Example</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Prerequisites</a></li>
<li class="part"><span><b>I Inferenza bayesiana</b></span></li>
<li class="chapter" data-level="2" data-path="ch:intro-bayes-inference.html"><a href="ch:intro-bayes-inference.html"><i class="fa fa-check"></i><b>2</b> Flusso di lavoro bayesiano</a>
<ul>
<li class="chapter" data-level="2.1" data-path="ch:intro-bayes-inference.html"><a href="ch:intro-bayes-inference.html#modellizzazione-bayesiana"><i class="fa fa-check"></i><b>2.1</b> Modellizzazione bayesiana</a>
<ul>
<li class="chapter" data-level="2.1.1" data-path="ch:intro-bayes-inference.html"><a href="ch:intro-bayes-inference.html#notazione"><i class="fa fa-check"></i><b>2.1.1</b> Notazione</a></li>
</ul></li>
<li class="chapter" data-level="2.2" data-path="ch:intro-bayes-inference.html"><a href="ch:intro-bayes-inference.html#distribuzioni-a-priori"><i class="fa fa-check"></i><b>2.2</b> Distribuzioni a priori</a>
<ul>
<li class="chapter" data-level="2.2.1" data-path="ch:intro-bayes-inference.html"><a href="ch:intro-bayes-inference.html#tipologie-di-distribuzioni-a-priori"><i class="fa fa-check"></i><b>2.2.1</b> Tipologie di distribuzioni a priori</a></li>
<li class="chapter" data-level="2.2.2" data-path="ch:intro-bayes-inference.html"><a href="ch:intro-bayes-inference.html#selezione-della-distribuzione-a-priori"><i class="fa fa-check"></i><b>2.2.2</b> Selezione della distribuzione a priori</a></li>
<li class="chapter" data-level="2.2.3" data-path="ch:intro-bayes-inference.html"><a href="ch:intro-bayes-inference.html#unapplicazione-empirica"><i class="fa fa-check"></i><b>2.2.3</b> Un’applicazione empirica</a></li>
</ul></li>
<li class="chapter" data-level="2.3" data-path="ch:intro-bayes-inference.html"><a href="ch:intro-bayes-inference.html#la-funzione-di-verosimiglianza"><i class="fa fa-check"></i><b>2.3</b> La funzione di verosimiglianza</a>
<ul>
<li class="chapter" data-level="2.3.1" data-path="ch:intro-bayes-inference.html"><a href="ch:intro-bayes-inference.html#notazione-1"><i class="fa fa-check"></i><b>2.3.1</b> Notazione</a></li>
<li class="chapter" data-level="2.3.2" data-path="ch:intro-bayes-inference.html"><a href="ch:intro-bayes-inference.html#la-log-verosimiglianza"><i class="fa fa-check"></i><b>2.3.2</b> La log-verosimiglianza</a></li>
<li class="chapter" data-level="2.3.3" data-path="ch:intro-bayes-inference.html"><a href="ch:intro-bayes-inference.html#unapplicazione-empirica-1"><i class="fa fa-check"></i><b>2.3.3</b> Un’applicazione empirica</a></li>
</ul></li>
<li class="chapter" data-level="2.4" data-path="ch:intro-bayes-inference.html"><a href="ch:intro-bayes-inference.html#sec:const-normaliz-bino23"><i class="fa fa-check"></i><b>2.4</b> La verosimiglianza marginale</a>
<ul>
<li class="chapter" data-level="2.4.1" data-path="ch:intro-bayes-inference.html"><a href="ch:intro-bayes-inference.html#unapplicazione-empirica-2"><i class="fa fa-check"></i><b>2.4.1</b> Un’applicazione empirica</a></li>
</ul></li>
<li class="chapter" data-level="2.5" data-path="ch:intro-bayes-inference.html"><a href="ch:intro-bayes-inference.html#distribuzione-a-posteriori"><i class="fa fa-check"></i><b>2.5</b> Distribuzione a posteriori</a></li>
<li class="chapter" data-level="2.6" data-path="ch:intro-bayes-inference.html"><a href="ch:intro-bayes-inference.html#distribuzione-predittiva-a-priori"><i class="fa fa-check"></i><b>2.6</b> Distribuzione predittiva a priori</a></li>
<li class="chapter" data-level="2.7" data-path="ch:intro-bayes-inference.html"><a href="ch:intro-bayes-inference.html#distribuzione-predittiva-a-posteriori"><i class="fa fa-check"></i><b>2.7</b> Distribuzione predittiva a posteriori</a></li>
<li class="chapter" data-level="" data-path="ch:intro-bayes-inference.html"><a href="ch:intro-bayes-inference.html#commenti-e-considerazioni-finali"><i class="fa fa-check"></i>Commenti e considerazioni finali</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="ch-subj-think-prop.html"><a href="ch-subj-think-prop.html"><i class="fa fa-check"></i><b>3</b> Pensare ad una proporzione in termini soggettivi</a>
<ul>
<li class="chapter" data-level="3.1" data-path="ch-subj-think-prop.html"><a href="ch-subj-think-prop.html#ch-prior-discr-binom"><i class="fa fa-check"></i><b>3.1</b> Inferenza bayesiana con una distribuzione a priori discreta</a></li>
<li class="chapter" data-level="3.2" data-path="ch-subj-think-prop.html"><a href="ch-subj-think-prop.html#ch-prior-cont-binom"><i class="fa fa-check"></i><b>3.2</b> Inferenza bayesiana con una distribuzione a priori continua</a>
<ul>
<li class="chapter" data-level="3.2.1" data-path="ch-subj-think-prop.html"><a href="ch-subj-think-prop.html#quali-parametri-per-la-distribuzione-beta"><i class="fa fa-check"></i><b>3.2.1</b> Quali parametri per la distribuzione Beta?</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="ch-subj-think-prop.html"><a href="ch-subj-think-prop.html#commenti-e-considerazioni-finali-1"><i class="fa fa-check"></i>Commenti e considerazioni finali</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="ch-distr-coniugate.html"><a href="ch-distr-coniugate.html"><i class="fa fa-check"></i><b>4</b> Distribuzioni coniugate</a>
<ul>
<li class="chapter" data-level="4.1" data-path="ch-distr-coniugate.html"><a href="ch-distr-coniugate.html#lo-schema-beta-binomiale"><i class="fa fa-check"></i><b>4.1</b> Lo schema beta-binomiale</a>
<ul>
<li class="chapter" data-level="4.1.1" data-path="ch-distr-coniugate.html"><a href="ch-distr-coniugate.html#la-specificazione-della-distribuzione-a-priori"><i class="fa fa-check"></i><b>4.1.1</b> La specificazione della distribuzione a priori</a></li>
<li class="chapter" data-level="4.1.2" data-path="ch-distr-coniugate.html"><a href="ch-distr-coniugate.html#la-specificazione-della-distribuzione-a-posteriori"><i class="fa fa-check"></i><b>4.1.2</b> La specificazione della distribuzione a posteriori</a></li>
</ul></li>
<li class="chapter" data-level="4.2" data-path="ch-distr-coniugate.html"><a href="ch-distr-coniugate.html#inferenza-bayesiana-con-distribuzioni-a-priori-continue"><i class="fa fa-check"></i><b>4.2</b> Inferenza bayesiana con distribuzioni a priori continue</a>
<ul>
<li class="chapter" data-level="4.2.1" data-path="ch-distr-coniugate.html"><a href="ch-distr-coniugate.html#approccio-bayesiano-alla-verifica-di-ipotesi"><i class="fa fa-check"></i><b>4.2.1</b> Approccio bayesiano alla verifica di ipotesi</a></li>
<li class="chapter" data-level="4.2.2" data-path="ch-distr-coniugate.html"><a href="ch-distr-coniugate.html#intervalli-di-credibilità"><i class="fa fa-check"></i><b>4.2.2</b> Intervalli di credibilità</a></li>
</ul></li>
<li class="chapter" data-level="4.3" data-path="ch-distr-coniugate.html"><a href="ch-distr-coniugate.html#principali-distribuzioni-coniugate"><i class="fa fa-check"></i><b>4.3</b> Principali distribuzioni coniugate</a></li>
<li class="chapter" data-level="" data-path="ch-distr-coniugate.html"><a href="ch-distr-coniugate.html#commenti-e-considerazioni-finali-2"><i class="fa fa-check"></i>Commenti e considerazioni finali</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="chapter-balance.html"><a href="chapter-balance.html"><i class="fa fa-check"></i><b>5</b> L’influenza della distribuzione a priori</a>
<ul>
<li class="chapter" data-level="5.1" data-path="chapter-balance.html"><a href="chapter-balance.html#il-test-di-benchdel"><i class="fa fa-check"></i><b>5.1</b> Il test di Benchdel</a></li>
<li class="chapter" data-level="5.2" data-path="chapter-balance.html"><a href="chapter-balance.html#stessi-dati-ma-diverse-distribuzioni-a-priori"><i class="fa fa-check"></i><b>5.2</b> Stessi dati ma diverse distribuzioni a priori</a></li>
<li class="chapter" data-level="5.3" data-path="chapter-balance.html"><a href="chapter-balance.html#dati-diversi-ma-la-stessa-distribuzione-a-priori"><i class="fa fa-check"></i><b>5.3</b> Dati diversi ma la stessa distribuzione a priori</a></li>
<li class="chapter" data-level="5.4" data-path="chapter-balance.html"><a href="chapter-balance.html#dati-diversi-e-diverse-distribuzioni-a-priori"><i class="fa fa-check"></i><b>5.4</b> Dati diversi e diverse distribuzioni a priori</a></li>
<li class="chapter" data-level="5.5" data-path="chapter-balance.html"><a href="chapter-balance.html#collegare-le-intuizioni-alla-teoria"><i class="fa fa-check"></i><b>5.5</b> Collegare le intuizioni alla teoria</a></li>
<li class="chapter" data-level="" data-path="chapter-balance.html"><a href="chapter-balance.html#commenti-e-considerazioni-finali-3"><i class="fa fa-check"></i>Commenti e considerazioni finali</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="ch:metropolis.html"><a href="ch:metropolis.html"><i class="fa fa-check"></i><b>6</b> Approssimazione della distribuzione a posteriori</a>
<ul>
<li class="chapter" data-level="6.1" data-path="ch:metropolis.html"><a href="ch:metropolis.html#metodo-basato-su-griglia"><i class="fa fa-check"></i><b>6.1</b> Metodo basato su griglia</a>
<ul>
<li class="chapter" data-level="6.1.1" data-path="ch:metropolis.html"><a href="ch:metropolis.html#modello-beta-binomiale"><i class="fa fa-check"></i><b>6.1.1</b> Modello Beta-Binomiale</a></li>
</ul></li>
<li class="chapter" data-level="6.2" data-path="ch:metropolis.html"><a href="ch:metropolis.html#chapter-simulazioneMC"><i class="fa fa-check"></i><b>6.2</b> Metodo Monte Carlo</a>
<ul>
<li class="chapter" data-level="6.2.1" data-path="ch:metropolis.html"><a href="ch:metropolis.html#integration-mc"><i class="fa fa-check"></i><b>6.2.1</b> Integrazione di Monte Carlo</a></li>
<li class="chapter" data-level="6.2.2" data-path="ch:metropolis.html"><a href="ch:metropolis.html#descrizione-intuitiva"><i class="fa fa-check"></i><b>6.2.2</b> Descrizione intuitiva</a></li>
<li class="chapter" data-level="6.2.3" data-path="ch:metropolis.html"><a href="ch:metropolis.html#unapplicazione-empirica-3"><i class="fa fa-check"></i><b>6.2.3</b> Un’applicazione empirica</a></li>
<li class="chapter" data-level="6.2.4" data-path="ch:metropolis.html"><a href="ch:metropolis.html#una-passeggiata-casuale-sui-numeri-naturali"><i class="fa fa-check"></i><b>6.2.4</b> Una passeggiata casuale sui numeri naturali</a></li>
<li class="chapter" data-level="6.2.5" data-path="ch:metropolis.html"><a href="ch:metropolis.html#lalgoritmo-di-metropolis"><i class="fa fa-check"></i><b>6.2.5</b> L’algoritmo di Metropolis</a></li>
<li class="chapter" data-level="6.2.6" data-path="ch:metropolis.html"><a href="ch:metropolis.html#unapplicazione-empirica-4"><i class="fa fa-check"></i><b>6.2.6</b> Un’applicazione empirica</a></li>
<li class="chapter" data-level="6.2.7" data-path="ch:metropolis.html"><a href="ch:metropolis.html#gibbs-sampling"><i class="fa fa-check"></i><b>6.2.7</b> Gibb’s sampling</a></li>
<li class="chapter" data-level="6.2.8" data-path="ch:metropolis.html"><a href="ch:metropolis.html#input"><i class="fa fa-check"></i><b>6.2.8</b> Input</a></li>
<li class="chapter" data-level="6.2.9" data-path="ch:metropolis.html"><a href="ch:metropolis.html#stazionarietà"><i class="fa fa-check"></i><b>6.2.9</b> Stazionarietà</a></li>
<li class="chapter" data-level="6.2.10" data-path="ch:metropolis.html"><a href="ch:metropolis.html#test-di-convergenza"><i class="fa fa-check"></i><b>6.2.10</b> Test di convergenza</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="ch:metropolis.html"><a href="ch:metropolis.html#commenti-e-considerazioni-finali-4"><i class="fa fa-check"></i>Commenti e considerazioni finali</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="stan-beta-binom.html"><a href="stan-beta-binom.html"><i class="fa fa-check"></i><b>7</b> Il modello beta-binomiale in linguaggio Stan</a>
<ul>
<li class="chapter" data-level="7.1" data-path="stan-beta-binom.html"><a href="stan-beta-binom.html#il-presidente-trump-e-lidrossiclorochina"><i class="fa fa-check"></i><b>7.1</b> Il presidente Trump e l’idrossiclorochina</a></li>
<li class="chapter" data-level="7.2" data-path="stan-beta-binom.html"><a href="stan-beta-binom.html#una-proporzione"><i class="fa fa-check"></i><b>7.2</b> Una proporzione</a></li>
<li class="chapter" data-level="7.3" data-path="stan-beta-binom.html"><a href="stan-beta-binom.html#cmdstanr-gautret"><i class="fa fa-check"></i><b>7.3</b> Interfaccia <code>cmdstanr</code></a>
<ul>
<li class="chapter" data-level="7.3.1" data-path="stan-beta-binom.html"><a href="stan-beta-binom.html#fase-1"><i class="fa fa-check"></i><b>7.3.1</b> Fase 1</a></li>
<li class="chapter" data-level="7.3.2" data-path="stan-beta-binom.html"><a href="stan-beta-binom.html#fase-2"><i class="fa fa-check"></i><b>7.3.2</b> Fase 2</a></li>
<li class="chapter" data-level="7.3.3" data-path="stan-beta-binom.html"><a href="stan-beta-binom.html#burn-in"><i class="fa fa-check"></i><b>7.3.3</b> Burn-in</a></li>
<li class="chapter" data-level="7.3.4" data-path="stan-beta-binom.html"><a href="stan-beta-binom.html#inferenza"><i class="fa fa-check"></i><b>7.3.4</b> Inferenza</a></li>
</ul></li>
<li class="chapter" data-level="7.4" data-path="stan-beta-binom.html"><a href="stan-beta-binom.html#la-critica-di-hulme_2020"><i class="fa fa-check"></i><b>7.4</b> La critica di <span class="citation">Hulme et al. (<span>2020</span>)</span></a></li>
<li class="chapter" data-level="7.5" data-path="stan-beta-binom.html"><a href="stan-beta-binom.html#due-proporzioni"><i class="fa fa-check"></i><b>7.5</b> Due proporzioni</a></li>
<li class="chapter" data-level="" data-path="stan-beta-binom.html"><a href="stan-beta-binom.html#commenti-e-considerazioni-finali-5"><i class="fa fa-check"></i>Commenti e considerazioni finali</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="diagn-markov-chains.html"><a href="diagn-markov-chains.html"><i class="fa fa-check"></i><b>8</b> Diagnostica delle catene markoviane</a>
<ul>
<li class="chapter" data-level="8.1" data-path="diagn-markov-chains.html"><a href="diagn-markov-chains.html#esame-dei-trace-plot"><i class="fa fa-check"></i><b>8.1</b> Esame dei <em>trace plot</em></a></li>
<li class="chapter" data-level="8.2" data-path="diagn-markov-chains.html"><a href="diagn-markov-chains.html#confronto-delle-catene-parallele"><i class="fa fa-check"></i><b>8.2</b> Confronto delle catene parallele</a></li>
<li class="chapter" data-level="8.3" data-path="diagn-markov-chains.html"><a href="diagn-markov-chains.html#numerosita-campionaria-effettiva"><i class="fa fa-check"></i><b>8.3</b> Numerosità campionaria effettiva</a></li>
<li class="chapter" data-level="8.4" data-path="diagn-markov-chains.html"><a href="diagn-markov-chains.html#autocorrelazione"><i class="fa fa-check"></i><b>8.4</b> Autocorrelazione</a></li>
<li class="chapter" data-level="8.5" data-path="diagn-markov-chains.html"><a href="diagn-markov-chains.html#statistica-hatr"><i class="fa fa-check"></i><b>8.5</b> Statistica <span class="math inline">\(\hat{R}\)</span></a></li>
<li class="chapter" data-level="8.6" data-path="diagn-markov-chains.html"><a href="diagn-markov-chains.html#diagnostica-di-convergenza-di-geweke"><i class="fa fa-check"></i><b>8.6</b> Diagnostica di convergenza di Geweke</a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="chapter-sintesi-distr-post.html"><a href="chapter-sintesi-distr-post.html"><i class="fa fa-check"></i><b>9</b> Sintesi a posteriori</a>
<ul>
<li class="chapter" data-level="9.1" data-path="chapter-sintesi-distr-post.html"><a href="chapter-sintesi-distr-post.html#stima-puntuale"><i class="fa fa-check"></i><b>9.1</b> Stima puntuale</a></li>
<li class="chapter" data-level="9.2" data-path="chapter-sintesi-distr-post.html"><a href="chapter-sintesi-distr-post.html#intervallo-di-credibilità"><i class="fa fa-check"></i><b>9.2</b> Intervallo di credibilità</a>
<ul>
<li class="chapter" data-level="9.2.1" data-path="chapter-sintesi-distr-post.html"><a href="chapter-sintesi-distr-post.html#intervallo-di-credibilità-a-code-uguali"><i class="fa fa-check"></i><b>9.2.1</b> Intervallo di credibilità a code uguali</a></li>
<li class="chapter" data-level="9.2.2" data-path="chapter-sintesi-distr-post.html"><a href="chapter-sintesi-distr-post.html#intervallo-di-credibilità-a-densità-a-posteriori-più-alta"><i class="fa fa-check"></i><b>9.2.2</b> Intervallo di credibilità a densità a posteriori più alta</a></li>
<li class="chapter" data-level="9.2.3" data-path="chapter-sintesi-distr-post.html"><a href="chapter-sintesi-distr-post.html#interpretazione"><i class="fa fa-check"></i><b>9.2.3</b> Interpretazione</a></li>
</ul></li>
<li class="chapter" data-level="9.3" data-path="chapter-sintesi-distr-post.html"><a href="chapter-sintesi-distr-post.html#un-esempio-concreto"><i class="fa fa-check"></i><b>9.3</b> Un esempio concreto</a>
<ul>
<li class="chapter" data-level="9.3.1" data-path="chapter-sintesi-distr-post.html"><a href="chapter-sintesi-distr-post.html#stime-puntuali-della-distribuzione-a-posteriori"><i class="fa fa-check"></i><b>9.3.1</b> Stime puntuali della distribuzione a posteriori</a></li>
<li class="chapter" data-level="9.3.2" data-path="chapter-sintesi-distr-post.html"><a href="chapter-sintesi-distr-post.html#intervallo-di-credibilità-1"><i class="fa fa-check"></i><b>9.3.2</b> Intervallo di credibilità</a></li>
<li class="chapter" data-level="9.3.3" data-path="chapter-sintesi-distr-post.html"><a href="chapter-sintesi-distr-post.html#probabilità-della-distribuzione-a-posteriori"><i class="fa fa-check"></i><b>9.3.3</b> Probabilità della distribuzione a posteriori</a></li>
</ul></li>
<li class="chapter" data-level="9.4" data-path="chapter-sintesi-distr-post.html"><a href="chapter-sintesi-distr-post.html#la-funzione-di-perdita-attesa"><i class="fa fa-check"></i><b>9.4</b> La funzione di perdita attesa</a></li>
<li class="chapter" data-level="" data-path="chapter-sintesi-distr-post.html"><a href="chapter-sintesi-distr-post.html#commenti-e-considerazioni-finali-6"><i class="fa fa-check"></i>Commenti e considerazioni finali</a></li>
</ul></li>
<li class="chapter" data-level="10" data-path="ch-prediction.html"><a href="ch-prediction.html"><i class="fa fa-check"></i><b>10</b> La predizione bayesiana</a>
<ul>
<li class="chapter" data-level="10.1" data-path="ch-prediction.html"><a href="ch-prediction.html#la-distribuzione-predittiva"><i class="fa fa-check"></i><b>10.1</b> La distribuzione predittiva</a></li>
<li class="chapter" data-level="10.2" data-path="ch-prediction.html"><a href="ch-prediction.html#la-distribuzione-predittiva-a-posteriori-mediante-simulazione"><i class="fa fa-check"></i><b>10.2</b> La distribuzione predittiva a posteriori mediante simulazione</a></li>
<li class="chapter" data-level="10.3" data-path="ch-prediction.html"><a href="ch-prediction.html#la-distribuzione-predittiva-a-posteriori-mediante-mcmc"><i class="fa fa-check"></i><b>10.3</b> La distribuzione predittiva a posteriori mediante MCMC</a></li>
<li class="chapter" data-level="10.4" data-path="ch-prediction.html"><a href="ch-prediction.html#i-metodi-per-la-valutazione-del-modello"><i class="fa fa-check"></i><b>10.4</b> I metodi per la valutazione del modello</a>
<ul>
<li class="chapter" data-level="10.4.1" data-path="ch-prediction.html"><a href="ch-prediction.html#posterior-predictive-checks"><i class="fa fa-check"></i><b>10.4.1</b> Posterior predictive checks</a></li>
</ul></li>
<li class="chapter" data-level="10.5" data-path="ch-prediction.html"><a href="ch-prediction.html#distribuzione-predittiva-a-priori-1"><i class="fa fa-check"></i><b>10.5</b> Distribuzione predittiva a priori</a></li>
<li class="chapter" data-level="" data-path="ch-prediction.html"><a href="ch-prediction.html#commenti-e-considerazioni-finali-7"><i class="fa fa-check"></i>Commenti e considerazioni finali</a></li>
</ul></li>
<li class="chapter" data-level="11" data-path="normal-normal-mod-stan.html"><a href="normal-normal-mod-stan.html"><i class="fa fa-check"></i><b>11</b> Inferenza sul parametro <span class="math inline">\(\mu\)</span> (media di una v.c. Normale)</a>
<ul>
<li class="chapter" data-level="11.1" data-path="normal-normal-mod-stan.html"><a href="normal-normal-mod-stan.html#caso-normale-normale-con-varianza-nota"><i class="fa fa-check"></i><b>11.1</b> Caso Normale-Normale con varianza nota</a></li>
<li class="chapter" data-level="11.2" data-path="normal-normal-mod-stan.html"><a href="normal-normal-mod-stan.html#derivazione-analitica-della-distribuzione-a-posteriori-pmu-mid-y"><i class="fa fa-check"></i><b>11.2</b> Derivazione analitica della distribuzione a posteriori <span class="math inline">\(p(\mu \mid y)\)</span></a></li>
<li class="chapter" data-level="11.3" data-path="normal-normal-mod-stan.html"><a href="normal-normal-mod-stan.html#il-modello-normale-con-stan"><i class="fa fa-check"></i><b>11.3</b> Il modello Normale con Stan</a>
<ul>
<li class="chapter" data-level="11.3.1" data-path="normal-normal-mod-stan.html"><a href="normal-normal-mod-stan.html#versione-1-sigma-nota"><i class="fa fa-check"></i><b>11.3.1</b> Versione 1 (<span class="math inline">\(\sigma\)</span> nota)</a></li>
<li class="chapter" data-level="11.3.2" data-path="normal-normal-mod-stan.html"><a href="normal-normal-mod-stan.html#versione-2-sigma-incognita"><i class="fa fa-check"></i><b>11.3.2</b> Versione 2 (<span class="math inline">\(\sigma\)</span> incognita)</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="normal-normal-mod-stan.html"><a href="normal-normal-mod-stan.html#commenti-e-considerazioni-finali-8"><i class="fa fa-check"></i>Commenti e considerazioni finali</a></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">A Minimal Book Example</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="normal-normal-mod-stan" class="section level1 hasAnchor" number="11">
<h1><span class="header-section-number">Capitolo 11</span> Inferenza sul parametro <span class="math inline">\(\mu\)</span> (media di una v.c. Normale)<a href="normal-normal-mod-stan.html#normal-normal-mod-stan" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<p>Estendiamo ora la discussione precedente considerano un altro caso comune: quello in cui disponiamo di un campione di dati a livello di scala a intervalli o rapporti e vogliamo fare inferenza sulla media della popolazione da cui il campione è stato estratto.</p>
<div id="caso-normale-normale-con-varianza-nota" class="section level2 hasAnchor" number="11.1">
<h2><span class="header-section-number">11.1</span> Caso Normale-Normale con varianza nota<a href="normal-normal-mod-stan.html#caso-normale-normale-con-varianza-nota" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Supponiamo che i dati <span class="math inline">\(y\)</span> siano un campione casuale estratto da una popolazione che segue la legge Normale. Ciò significa che le osservazioni possono essere considerate come una sequenza di variabili casuali indipendenti e identicamente distribuite. Supponiamo che ciascuna v.c. segua la distribuzione Normale. Abbiamo dunque</p>
<p><span class="math display">\[
Y_1, \dots, Y_n  \stackrel{iid}{\sim} \mathcal{N}(\mu, \sigma).
\]</span></p>
<p>In precedenza abbiamo visto come, in tali circostanze, la verosimiglianza <span class="math inline">\(p(y \mid \mu, \sigma)\)</span> sia Normale. Per fare inferenza sul parametro <span class="math inline">\(\mu\)</span>, facciamo due assunzioni: consideriamo <span class="math inline">\(\sigma\)</span> nota e imponiamo su <span class="math inline">\(\mu\)</span> una distribuzione a priori Normale. Questa situazione definisce lo schema coniugato Normale-Normale. Il caso Normale-Normale consente una derivazione analitica della distribuzione a posteriori <span class="math inline">\(p(\mu \mid y)\)</span> (così come nel caso beta-binomiale era possibile una derivazione analitica della distribuzione a posteriori <span class="math inline">\(p(\theta \mid y)\)</span>).</p>
<p>La trattazione matematica di una tale derivazione è piuttosto complessa e qui verrà solo accennata. Nel seguito, impareremo invece ad applicare la soluzione che viene ottenuta in tali circostanze; mostreremo inoltre come fare inferenza su <span class="math inline">\(\mu\)</span> mediante i metodi MCMC.</p>
</div>
<div id="derivazione-analitica-della-distribuzione-a-posteriori-pmu-mid-y" class="section level2 hasAnchor" number="11.2">
<h2><span class="header-section-number">11.2</span> Derivazione analitica della distribuzione a posteriori <span class="math inline">\(p(\mu \mid y)\)</span><a href="normal-normal-mod-stan.html#derivazione-analitica-della-distribuzione-a-posteriori-pmu-mid-y" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Per <span class="math inline">\(\sigma^2\)</span> nota, la famiglia della distribuzione Normale è coniugata a sé stessa: se la funzione di verosimiglianza è Normale, la scelta di una distribuzione a priori Normale per <span class="math inline">\(\mu\)</span> assicura che anche la distribuzione a posteriori <span class="math inline">\(p(\mu \mid y)\)</span> sia Normale.</p>
<p>Poniamoci dunque il problema di trovare <span class="math inline">\(p(\mu \mid y)\)</span> nel caso di un campione casuale <span class="math inline">\(Y_1, \dots, Y_n \stackrel{iid}{\sim} \mathcal{N}(\mu, \sigma)\)</span>, supponendo <span class="math inline">\(\sigma\)</span> perfettamente nota e imponendo su <span class="math inline">\(\mu\)</span> una distribuzione a priori Normale. Ricordiamo che la densità gaussiana è</p>
<p><span class="math display">\[
p(y_i \mid \mu, \sigma) = \frac{1}{{\sigma \sqrt {2\pi}}}\exp\left\{{-\frac{(y_i - \mu)^2}{2\sigma^2}}\right\}.
\]</span></p>
<p>Essendo le variabili i.i.d., possiamo scrivere la densità congiunta come il prodotto delle singole densità e quindi si ottiene</p>
<p><span class="math display">\[
p(y \mid \mu) = \, \prod_{i=1}^n p(y_i \mid \mu).
\]</span></p>
<p>Una volta osservati i dati <span class="math inline">\(y\)</span>, la verosimiglianza diventa</p>
<p><span class="math display">\[\begin{align}
p(y \mid \mu) =&amp; \, \prod_{i=1}^n p(y_i \mid \mu) = \notag\\
&amp; \frac{1}{{\sigma \sqrt {2\pi}}}\exp\left\{{-\frac{(y_1 - \mu)^2}{2\sigma^2}}\right\} \times \notag\\
&amp; \frac{1}{{\sigma \sqrt {2\pi}}}\exp\left\{{-\frac{(y_2 - \mu)^2}{2\sigma^2}}\right\} \times  \notag\\
&amp; \vdots \notag\\
&amp; \frac{1}{{\sigma \sqrt {2\pi}}}\exp\left\{{-\frac{(y_n - \mu)^2}{2\sigma^2}}\right\}.
\end{align}\]</span></p>
<p>Se la densità a priori <span class="math inline">\(p(\mu)\)</span> è gaussiana, allora anche la densità a posteriori <span class="math inline">\(p(\mu \mid y)\)</span> sarà gaussiana. Poniamo</p>
<p><span class="math display" id="eq:prior-mu-norm-norm">\[\begin{equation}
p(\mu) = \frac{1}{{\tau_0 \sqrt {2\pi}}}\exp\left\{{-\frac{(\mu - \mu_0)^2}{2\tau_0^2}}\right\},
\tag{11.1}
\end{equation}\]</span></p>
<p>ovvero imponiamo a <span class="math inline">\(\mu\)</span> una distribuzione a priori gaussiana con media <span class="math inline">\(\mu_0\)</span> e varianza <span class="math inline">\(\tau_0^2\)</span>. Ciò significa dire che, a priori, <span class="math inline">\(\mu_0\)</span> rappresenta il valore più verosimile per <span class="math inline">\(\mu\)</span>, mentre <span class="math inline">\(\tau_0^2\)</span> quantifica il grado della nostra incertezza rispetto a tale valore.</p>
<p>Svolgendo una serie di passaggi algebrici, si arriva alla distribuzione a posteriori</p>
<p><span class="math display" id="eq:post-norm-norm">\[\begin{equation}
p(\mu \mid y) = \frac{1}{{\tau_p \sqrt {2\pi}}}\exp\left\{{-\frac{(\mu - \mu_p)^2}{2\tau_p^2}}\right\},
\tag{11.2}
\end{equation}\]</span></p>
<p>dove</p>
<p><span class="math display" id="eq:post-norm-mup">\[\begin{equation}
\mu_p = \frac{\frac{1}{\tau_0^2}\mu_0+ \frac{n}{\sigma^2}\bar{y}}{\frac {1}{\tau_0^2} + \frac{n}{\sigma^2}}
\tag{11.3}
\end{equation}\]</span></p>
<p>e</p>
<p><span class="math display" id="eq:post-norm-taup2">\[\begin{equation}
\tau_p^2 = \frac{1}{\frac {1}{\tau_0^2}+ \frac{n}{\sigma^2}}.
\tag{11.4}
\end{equation}\]</span></p>
<p>Ciò significa che, se la distribuzione a priori <span class="math inline">\(p(\mu)\)</span> è gaussiana, allora anche la distribuzione a posteriori <span class="math inline">\(p(\mu \mid y)\)</span> sarà gaussiana con valore atteso <span class="math inline">\(\mu_p\)</span> e varianza <span class="math inline">\(\tau_p^2\)</span> date dalle espressioni precedenti.</p>
<p>In conclusione, il risultato trovato indica che:</p>
<ul>
<li>il valore atteso a posteriori è una media pesata fra il valore atteso a priori <span class="math inline">\(\mu_0\)</span> e la media campionaria <span class="math inline">\(\bar{y}\)</span>; il peso della media campionaria è tanto maggiore tanto più è grande <span class="math inline">\(n\)</span> (il numero di osservazioni) e <span class="math inline">\(\tau_0^2\)</span> (l’incertezza iniziale);</li>
<li>l’incertezza (varianza) a posteriori <span class="math inline">\(\tau_p^2\)</span> è sempre più piccola dell’incertezza a priori <span class="math inline">\(\tau_0^2\)</span> e diminuisce al crescere di <span class="math inline">\(n\)</span>.</li>
</ul>
<div class="exercise">
<p><span id="exr:unlabeled-div-7" class="exercise"><strong>Esercizio 11.1  </strong></span>Per esaminare un esempio pratico, consideriamo i 30 valori BDI-II dei soggetti clinici di <span class="citation">Zetsche, Bürkner, and Renneberg (<a href="#ref-zetschefuture2019" role="doc-biblioref">2019</a>)</span>:</p>
<div class="sourceCode" id="cb197"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb197-1"><a href="normal-normal-mod-stan.html#cb197-1" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb197-2"><a href="normal-normal-mod-stan.html#cb197-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">y =</span> <span class="fu">c</span>(</span>
<span id="cb197-3"><a href="normal-normal-mod-stan.html#cb197-3" aria-hidden="true" tabindex="-1"></a>    <span class="fl">26.0</span>, <span class="fl">35.0</span>, <span class="dv">30</span>, <span class="dv">25</span>, <span class="dv">44</span>, <span class="dv">30</span>, <span class="dv">33</span>, <span class="dv">43</span>, <span class="dv">22</span>, <span class="dv">43</span>,</span>
<span id="cb197-4"><a href="normal-normal-mod-stan.html#cb197-4" aria-hidden="true" tabindex="-1"></a>    <span class="dv">24</span>, <span class="dv">19</span>, <span class="dv">39</span>, <span class="dv">31</span>, <span class="dv">25</span>, <span class="dv">28</span>, <span class="dv">35</span>, <span class="dv">30</span>, <span class="dv">26</span>, <span class="dv">31</span>, <span class="dv">41</span>,</span>
<span id="cb197-5"><a href="normal-normal-mod-stan.html#cb197-5" aria-hidden="true" tabindex="-1"></a>    <span class="dv">36</span>, <span class="dv">26</span>, <span class="dv">35</span>, <span class="dv">33</span>, <span class="dv">28</span>, <span class="dv">27</span>, <span class="dv">34</span>, <span class="dv">27</span>, <span class="dv">22</span></span>
<span id="cb197-6"><a href="normal-normal-mod-stan.html#cb197-6" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb197-7"><a href="normal-normal-mod-stan.html#cb197-7" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<p>Supponiamo che la varianza <span class="math inline">\(\sigma^2\)</span> della popolazione sia identica alla varianza del campione:</p>
<div class="sourceCode" id="cb198"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb198-1"><a href="normal-normal-mod-stan.html#cb198-1" aria-hidden="true" tabindex="-1"></a>sigma <span class="ot">&lt;-</span> <span class="fu">sd</span>(df<span class="sc">$</span>y)</span>
<span id="cb198-2"><a href="normal-normal-mod-stan.html#cb198-2" aria-hidden="true" tabindex="-1"></a>sigma</span>
<span id="cb198-3"><a href="normal-normal-mod-stan.html#cb198-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] 6.606858</span></span></code></pre></div>
<p>Per fare un esempio, imponiamo su <span class="math inline">\(\mu\)</span> una distribuzione a priori <span class="math inline">\(\mathcal{N}(25, 2)\)</span>. In tali circostanze, la distribuzione a posteriori del parametro <span class="math inline">\(\mu\)</span> può essere determinata per via analitica e corrisponde ad una Normale di media e varianza definite dalle equazioni <a href="normal-normal-mod-stan.html#eq:post-norm-mup">(11.3)</a> e <a href="normal-normal-mod-stan.html#eq:post-norm-taup2">(11.4)</a>. È possibile visualizzare tale distribuzione a posteriori usando la funzione <code>plot_normal_normal()</code> del pacchetto <code>bayesrules</code>.</p>
<div class="sourceCode" id="cb199"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb199-1"><a href="normal-normal-mod-stan.html#cb199-1" aria-hidden="true" tabindex="-1"></a>bayesrules<span class="sc">::</span><span class="fu">plot_normal_normal</span>(</span>
<span id="cb199-2"><a href="normal-normal-mod-stan.html#cb199-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">mean =</span> <span class="dv">25</span>, <span class="co"># media della distribuzione a priori per mu</span></span>
<span id="cb199-3"><a href="normal-normal-mod-stan.html#cb199-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">sd =</span> <span class="dv">2</span>, <span class="co"># sd della distribuzione a priori per mu</span></span>
<span id="cb199-4"><a href="normal-normal-mod-stan.html#cb199-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">sigma =</span> <span class="fu">sd</span>(df<span class="sc">$</span>y), <span class="co"># sd del campione</span></span>
<span id="cb199-5"><a href="normal-normal-mod-stan.html#cb199-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">y_bar =</span> <span class="fu">mean</span>(df<span class="sc">$</span>y), <span class="co"># media del campione</span></span>
<span id="cb199-6"><a href="normal-normal-mod-stan.html#cb199-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">n =</span> <span class="fu">length</span>(df<span class="sc">$</span>y) <span class="co"># ampiezza campionaria</span></span>
<span id="cb199-7"><a href="normal-normal-mod-stan.html#cb199-7" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<p><img src="bookdown-demo_files/figure-html/unnamed-chunk-197-1.png" width="576" style="display: block; margin: auto;" /></p>
<p>La funzione <code>bayesrules::summarize_normal_normal()</code> fornisce una sintesi numerica della distribuzione a posteriori <span class="math inline">\(p(\mu \mid y, \sigma)\)</span>.</p>
<div class="sourceCode" id="cb200"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb200-1"><a href="normal-normal-mod-stan.html#cb200-1" aria-hidden="true" tabindex="-1"></a>bayesrules<span class="sc">::</span><span class="fu">summarize_normal_normal</span>(</span>
<span id="cb200-2"><a href="normal-normal-mod-stan.html#cb200-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">mean =</span> <span class="dv">25</span>, <span class="co"># media della distribuzione a priori per mu</span></span>
<span id="cb200-3"><a href="normal-normal-mod-stan.html#cb200-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">sd =</span> <span class="dv">2</span>, <span class="co"># sd della distribuzione a priori per mu</span></span>
<span id="cb200-4"><a href="normal-normal-mod-stan.html#cb200-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">sigma=</span> <span class="fu">sd</span>(df<span class="sc">$</span>y), <span class="co"># sd del campione</span></span>
<span id="cb200-5"><a href="normal-normal-mod-stan.html#cb200-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">y_bar =</span> <span class="fu">mean</span>(df<span class="sc">$</span>y), <span class="co"># media del campione</span></span>
<span id="cb200-6"><a href="normal-normal-mod-stan.html#cb200-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">n =</span> <span class="fu">length</span>(df<span class="sc">$</span>y) <span class="co"># ampiezza campionaria</span></span>
<span id="cb200-7"><a href="normal-normal-mod-stan.html#cb200-7" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb200-8"><a href="normal-normal-mod-stan.html#cb200-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;       model     mean     mode      var       sd</span></span>
<span id="cb200-9"><a href="normal-normal-mod-stan.html#cb200-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1     prior 25.00000 25.00000 4.000000 2.000000</span></span>
<span id="cb200-10"><a href="normal-normal-mod-stan.html#cb200-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 2 posterior 29.35073 29.35073 1.066921 1.032919</span></span></code></pre></div>
<p>Verifichiamo i risultati forniti da <code>bayesrules::summarize_normal_normal()</code> applicando le formule <a href="normal-normal-mod-stan.html#eq:post-norm-mup">(11.3)</a> e <a href="normal-normal-mod-stan.html#eq:post-norm-taup2">(11.4)</a>. La media della distribuzione a posteriori di <span class="math inline">\(\mu\)</span> è</p>
<div class="sourceCode" id="cb201"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb201-1"><a href="normal-normal-mod-stan.html#cb201-1" aria-hidden="true" tabindex="-1"></a>mu_post <span class="ot">&lt;-</span> <span class="cf">function</span>(tau_0, mu_0, sigma, ybar, n) {</span>
<span id="cb201-2"><a href="normal-normal-mod-stan.html#cb201-2" aria-hidden="true" tabindex="-1"></a>  (<span class="dv">1</span><span class="sc">/</span>tau_0<span class="sc">^</span><span class="dv">2</span> <span class="sc">*</span> mu_0 <span class="sc">+</span> n<span class="sc">/</span>sigma<span class="sc">^</span><span class="dv">2</span> <span class="sc">*</span> ybar) <span class="sc">/</span> (<span class="dv">1</span><span class="sc">/</span>tau_0<span class="sc">^</span><span class="dv">2</span> <span class="sc">+</span> n<span class="sc">/</span>sigma<span class="sc">^</span><span class="dv">2</span>)</span>
<span id="cb201-3"><a href="normal-normal-mod-stan.html#cb201-3" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<div class="sourceCode" id="cb202"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb202-1"><a href="normal-normal-mod-stan.html#cb202-1" aria-hidden="true" tabindex="-1"></a>mu_0 <span class="ot">&lt;-</span> <span class="dv">25</span>  <span class="co"># media della distribuzione a priori per mu</span></span>
<span id="cb202-2"><a href="normal-normal-mod-stan.html#cb202-2" aria-hidden="true" tabindex="-1"></a>tau_0 <span class="ot">&lt;-</span> <span class="dv">2</span>  <span class="co"># sd della distribuzione a priori per mu</span></span>
<span id="cb202-3"><a href="normal-normal-mod-stan.html#cb202-3" aria-hidden="true" tabindex="-1"></a>sigma <span class="ot">&lt;-</span> <span class="fu">sd</span>(df<span class="sc">$</span>y) <span class="co"># sd del campione (assunta essere sigma)</span></span>
<span id="cb202-4"><a href="normal-normal-mod-stan.html#cb202-4" aria-hidden="true" tabindex="-1"></a>ybar <span class="ot">&lt;-</span> <span class="fu">mean</span>(df<span class="sc">$</span>y) <span class="co"># media del campione</span></span>
<span id="cb202-5"><a href="normal-normal-mod-stan.html#cb202-5" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="fu">length</span>(df<span class="sc">$</span>y)</span>
<span id="cb202-6"><a href="normal-normal-mod-stan.html#cb202-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb202-7"><a href="normal-normal-mod-stan.html#cb202-7" aria-hidden="true" tabindex="-1"></a><span class="fu">mu_post</span>(tau_0, mu_0, sigma, ybar, n) </span>
<span id="cb202-8"><a href="normal-normal-mod-stan.html#cb202-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] 29.35073</span></span></code></pre></div>
<p>La deviazione standard della distribuzione a posteriori di <span class="math inline">\(\mu\)</span> è</p>
<div class="sourceCode" id="cb203"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb203-1"><a href="normal-normal-mod-stan.html#cb203-1" aria-hidden="true" tabindex="-1"></a>tau_post <span class="ot">&lt;-</span> <span class="cf">function</span>(tau_0, sigma, n) {</span>
<span id="cb203-2"><a href="normal-normal-mod-stan.html#cb203-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">sqrt</span>(<span class="dv">1</span> <span class="sc">/</span> (<span class="dv">1</span><span class="sc">/</span>tau_0<span class="sc">^</span><span class="dv">2</span> <span class="sc">+</span> n<span class="sc">/</span>sigma<span class="sc">^</span><span class="dv">2</span>))</span>
<span id="cb203-3"><a href="normal-normal-mod-stan.html#cb203-3" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<div class="sourceCode" id="cb204"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb204-1"><a href="normal-normal-mod-stan.html#cb204-1" aria-hidden="true" tabindex="-1"></a>tau_0 <span class="ot">&lt;-</span> <span class="dv">2</span>  <span class="co"># sd della distribuzione a priori per mu</span></span>
<span id="cb204-2"><a href="normal-normal-mod-stan.html#cb204-2" aria-hidden="true" tabindex="-1"></a>sigma <span class="ot">&lt;-</span> <span class="fu">sd</span>(df<span class="sc">$</span>y) <span class="co"># sd del campione (assunta essere sigma)</span></span>
<span id="cb204-3"><a href="normal-normal-mod-stan.html#cb204-3" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="fu">length</span>(df<span class="sc">$</span>y)</span>
<span id="cb204-4"><a href="normal-normal-mod-stan.html#cb204-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb204-5"><a href="normal-normal-mod-stan.html#cb204-5" aria-hidden="true" tabindex="-1"></a><span class="fu">tau_post</span>(tau_0, sigma, n) </span>
<span id="cb204-6"><a href="normal-normal-mod-stan.html#cb204-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] 1.032919</span></span></code></pre></div>
<p>I risultati trovati riproducono quelli forniti da <code>bayesrules::summarize_normal_normal()</code>.</p>
</div>
</div>
<div id="il-modello-normale-con-stan" class="section level2 hasAnchor" number="11.3">
<h2><span class="header-section-number">11.3</span> Il modello Normale con Stan<a href="normal-normal-mod-stan.html#il-modello-normale-con-stan" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>I priori coniugati Normali di una Normale non richiedono una approssimazione numerica ottenuta mediante metodi MCMC. Tuttavia, per fare un esercizio e per verificare che i risultati ottenuti mediante MCMC siano simili a quelli trovati per via analitica, ripetiamo l’esercizio precedente usando Stan.</p>
<div id="versione-1-sigma-nota" class="section level3 hasAnchor" number="11.3.1">
<h3><span class="header-section-number">11.3.1</span> Versione 1 (<span class="math inline">\(\sigma\)</span> nota)<a href="normal-normal-mod-stan.html#versione-1-sigma-nota" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Come in precedenza, impongo su <span class="math inline">\(\mu\)</span> una distribuzione a priori <span class="math inline">\(\mathcal{N}(25, 2)\)</span> e considero noto il parametro <span class="math inline">\(\sigma = 6.606858\)</span>. Il modello dunque diventa il seguente.</p>
<p><span class="math display">\[\begin{align}
Y_i &amp;\sim \mathcal{N}(\mu, \sigma) \notag\\
\mu &amp;\sim \mathcal{N}(25, 2) \notag\\
\sigma &amp;= 6.606858 \notag
\end{align}\]</span></p>
<p>In base al modello definito sopra, la variabile casuale <span class="math inline">\(Y\)</span> segue la distribuzione Normale di parametri <span class="math inline">\(\mu\)</span> e <span class="math inline">\(\sigma\)</span>. Il parametro <span class="math inline">\(\mu\)</span> è sconosciuto e abbiamo deciso di descrivere la nostra incertezza relativa ad esso mediante una distribuzione a priori Normale di media 25 e deviazione standard 2. Il parametro <span class="math inline">\(\sigma\)</span> è invece assunto essere noto e uguale a 6.606858. Usando il linguaggio Stan specifico il modello come segue.</p>
<div class="sourceCode" id="cb205"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb205-1"><a href="normal-normal-mod-stan.html#cb205-1" aria-hidden="true" tabindex="-1"></a>modelString <span class="ot">=</span> <span class="st">&quot;</span></span>
<span id="cb205-2"><a href="normal-normal-mod-stan.html#cb205-2" aria-hidden="true" tabindex="-1"></a><span class="st">data {</span></span>
<span id="cb205-3"><a href="normal-normal-mod-stan.html#cb205-3" aria-hidden="true" tabindex="-1"></a><span class="st">  int&lt;lower=0&gt; N;</span></span>
<span id="cb205-4"><a href="normal-normal-mod-stan.html#cb205-4" aria-hidden="true" tabindex="-1"></a><span class="st">  real&lt;lower=0&gt; sigma;</span></span>
<span id="cb205-5"><a href="normal-normal-mod-stan.html#cb205-5" aria-hidden="true" tabindex="-1"></a><span class="st">  vector[N] y;</span></span>
<span id="cb205-6"><a href="normal-normal-mod-stan.html#cb205-6" aria-hidden="true" tabindex="-1"></a><span class="st">}</span></span>
<span id="cb205-7"><a href="normal-normal-mod-stan.html#cb205-7" aria-hidden="true" tabindex="-1"></a><span class="st">parameters {</span></span>
<span id="cb205-8"><a href="normal-normal-mod-stan.html#cb205-8" aria-hidden="true" tabindex="-1"></a><span class="st">  real mu;</span></span>
<span id="cb205-9"><a href="normal-normal-mod-stan.html#cb205-9" aria-hidden="true" tabindex="-1"></a><span class="st">}</span></span>
<span id="cb205-10"><a href="normal-normal-mod-stan.html#cb205-10" aria-hidden="true" tabindex="-1"></a><span class="st">model {</span></span>
<span id="cb205-11"><a href="normal-normal-mod-stan.html#cb205-11" aria-hidden="true" tabindex="-1"></a><span class="st">  mu ~ normal(25, 2);</span></span>
<span id="cb205-12"><a href="normal-normal-mod-stan.html#cb205-12" aria-hidden="true" tabindex="-1"></a><span class="st">  y ~ normal(mu, sigma);</span></span>
<span id="cb205-13"><a href="normal-normal-mod-stan.html#cb205-13" aria-hidden="true" tabindex="-1"></a><span class="st">}</span></span>
<span id="cb205-14"><a href="normal-normal-mod-stan.html#cb205-14" aria-hidden="true" tabindex="-1"></a><span class="st">&quot;</span></span>
<span id="cb205-15"><a href="normal-normal-mod-stan.html#cb205-15" aria-hidden="true" tabindex="-1"></a><span class="fu">writeLines</span>(modelString, <span class="at">con =</span> <span class="st">&quot;code/normal_normal_1.stan&quot;</span>)</span></code></pre></div>
<p>Sistemo i dati nel formato appropriato per Stan.</p>
<div class="sourceCode" id="cb206"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb206-1"><a href="normal-normal-mod-stan.html#cb206-1" aria-hidden="true" tabindex="-1"></a>dlist <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb206-2"><a href="normal-normal-mod-stan.html#cb206-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">N =</span> <span class="fu">length</span>(df<span class="sc">$</span>y),</span>
<span id="cb206-3"><a href="normal-normal-mod-stan.html#cb206-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">sigma =</span> <span class="fu">sd</span>(df<span class="sc">$</span>y),</span>
<span id="cb206-4"><a href="normal-normal-mod-stan.html#cb206-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">y =</span> df<span class="sc">$</span>y</span>
<span id="cb206-5"><a href="normal-normal-mod-stan.html#cb206-5" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<p>Leggo il file in cui ho salvato il codice Stan.</p>
<div class="sourceCode" id="cb207"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb207-1"><a href="normal-normal-mod-stan.html#cb207-1" aria-hidden="true" tabindex="-1"></a>file <span class="ot">&lt;-</span> <span class="fu">file.path</span>(<span class="st">&quot;code&quot;</span>, <span class="st">&quot;normal_normal_1.stan&quot;</span>)</span></code></pre></div>
<p>Compilo il modello.</p>
<div class="sourceCode" id="cb208"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb208-1"><a href="normal-normal-mod-stan.html#cb208-1" aria-hidden="true" tabindex="-1"></a>mod <span class="ot">&lt;-</span> <span class="fu">cmdstan_model</span>(file)</span></code></pre></div>
<p>Eseguo il campionamento MCMC.</p>
<div class="sourceCode" id="cb209"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb209-1"><a href="normal-normal-mod-stan.html#cb209-1" aria-hidden="true" tabindex="-1"></a>fit <span class="ot">&lt;-</span> mod<span class="sc">$</span><span class="fu">sample</span>(</span>
<span id="cb209-2"><a href="normal-normal-mod-stan.html#cb209-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> dlist,</span>
<span id="cb209-3"><a href="normal-normal-mod-stan.html#cb209-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">iter_sampling =</span> 100000L,</span>
<span id="cb209-4"><a href="normal-normal-mod-stan.html#cb209-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">iter_warmup =</span> 2000L,</span>
<span id="cb209-5"><a href="normal-normal-mod-stan.html#cb209-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">chains =</span> 4L,</span>
<span id="cb209-6"><a href="normal-normal-mod-stan.html#cb209-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">refresh =</span> <span class="dv">0</span></span>
<span id="cb209-7"><a href="normal-normal-mod-stan.html#cb209-7" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<p>Una sintesi della distribuzione a posteriori dei parametri si ottiene nel modo seguente.</p>
<div class="sourceCode" id="cb210"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb210-1"><a href="normal-normal-mod-stan.html#cb210-1" aria-hidden="true" tabindex="-1"></a>fit<span class="sc">$</span><span class="fu">summary</span>(<span class="fu">c</span>(<span class="st">&quot;mu&quot;</span>))</span>
<span id="cb210-2"><a href="normal-normal-mod-stan.html#cb210-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # A tibble: 1 × 10</span></span>
<span id="cb210-3"><a href="normal-normal-mod-stan.html#cb210-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   variable  mean median    sd   mad    q5   q95  rhat ess_bulk ess_tail</span></span>
<span id="cb210-4"><a href="normal-normal-mod-stan.html#cb210-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   &lt;chr&gt;    &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt;</span></span>
<span id="cb210-5"><a href="normal-normal-mod-stan.html#cb210-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1 mu        29.4   29.4  1.04  1.04  27.6  31.1  1.00  153786.  188314.</span></span></code></pre></div>
<p>Si noti che le stime ottenute sono molto vicine ai valori teorici attesi, ovvero <span class="math inline">\(\mu_p\)</span> = 29.57 contro un valore teorico di 29.35 e <span class="math inline">\(\tau_p\)</span> = 0.96 contro un valore teorico di 1.03.</p>
<p>Qui sotto è fornita una rappresentazione grafica dell’intera distribuzione a posteriori del parametro <span class="math inline">\(\mu\)</span>.</p>
<div class="sourceCode" id="cb211"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb211-1"><a href="normal-normal-mod-stan.html#cb211-1" aria-hidden="true" tabindex="-1"></a>stanfit <span class="ot">&lt;-</span> rstan<span class="sc">::</span><span class="fu">read_stan_csv</span>(fit<span class="sc">$</span><span class="fu">output_files</span>())</span>
<span id="cb211-2"><a href="normal-normal-mod-stan.html#cb211-2" aria-hidden="true" tabindex="-1"></a>mu_draws <span class="ot">&lt;-</span> <span class="fu">as.matrix</span>(stanfit,<span class="at">pars =</span><span class="st">&quot;mu&quot;</span>)</span>
<span id="cb211-3"><a href="normal-normal-mod-stan.html#cb211-3" aria-hidden="true" tabindex="-1"></a><span class="fu">mcmc_areas</span>(mu_draws,<span class="at">prob =</span> <span class="fl">0.95</span>) </span></code></pre></div>
<p><img src="bookdown-demo_files/figure-html/unnamed-chunk-209-1.png" width="576" style="display: block; margin: auto;" /></p>
<p>Trovo l’intervallo di credibilità al 95%.</p>
<div class="sourceCode" id="cb212"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb212-1"><a href="normal-normal-mod-stan.html#cb212-1" aria-hidden="true" tabindex="-1"></a>post <span class="ot">&lt;-</span> fit<span class="sc">$</span><span class="fu">draws</span>()</span>
<span id="cb212-2"><a href="normal-normal-mod-stan.html#cb212-2" aria-hidden="true" tabindex="-1"></a>post_parms <span class="ot">&lt;-</span> <span class="fu">subset_draws</span>(post, <span class="fu">c</span>(<span class="st">&quot;mu&quot;</span>))</span>
<span id="cb212-3"><a href="normal-normal-mod-stan.html#cb212-3" aria-hidden="true" tabindex="-1"></a>posterior<span class="sc">::</span><span class="fu">summarise_draws</span>(</span>
<span id="cb212-4"><a href="normal-normal-mod-stan.html#cb212-4" aria-hidden="true" tabindex="-1"></a>  post_parms,</span>
<span id="cb212-5"><a href="normal-normal-mod-stan.html#cb212-5" aria-hidden="true" tabindex="-1"></a>  <span class="sc">~</span> <span class="fu">quantile</span>(.x, <span class="at">probs =</span> <span class="fu">c</span>(<span class="fl">0.025</span>, <span class="fl">0.975</span>))</span>
<span id="cb212-6"><a href="normal-normal-mod-stan.html#cb212-6" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb212-7"><a href="normal-normal-mod-stan.html#cb212-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # A tibble: 1 × 3</span></span>
<span id="cb212-8"><a href="normal-normal-mod-stan.html#cb212-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   variable `2.5%` `97.5%`</span></span>
<span id="cb212-9"><a href="normal-normal-mod-stan.html#cb212-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   &lt;chr&gt;     &lt;dbl&gt;   &lt;dbl&gt;</span></span>
<span id="cb212-10"><a href="normal-normal-mod-stan.html#cb212-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1 mu         27.3    31.4</span></span></code></pre></div>
<p>Le stime così trovate sono molto simili ai quantili di ordine 0.025 e 0.975 della vera distribuzione a posteriori di <span class="math inline">\(\mu\)</span>:</p>
<div class="sourceCode" id="cb213"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb213-1"><a href="normal-normal-mod-stan.html#cb213-1" aria-hidden="true" tabindex="-1"></a><span class="fu">qnorm</span>(<span class="fu">c</span>(<span class="fl">0.025</span>, <span class="fl">0.975</span>), <span class="fl">29.35073</span>, <span class="fl">1.032919</span>)</span>
<span id="cb213-2"><a href="normal-normal-mod-stan.html#cb213-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] 27.32625 31.37521</span></span></code></pre></div>
</div>
<div id="versione-2-sigma-incognita" class="section level3 hasAnchor" number="11.3.2">
<h3><span class="header-section-number">11.3.2</span> Versione 2 (<span class="math inline">\(\sigma\)</span> incognita)<a href="normal-normal-mod-stan.html#versione-2-sigma-incognita" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>È facile estendere il caso precedente alla situazione in cui il parametro <span class="math inline">\(\sigma\)</span> è incognito. Se non conosciamo <span class="math inline">\(\sigma\)</span>, è necessario imporre su tale parametro una distribuzione a priori. Supponiamo di ipotizzare per <span class="math inline">\(\sigma\)</span> una distribuzione a priori <span class="math inline">\(\mbox{Cauchy}(0, 15)\)</span>.</p>
<p>Mediante una <span class="math inline">\(\mbox{Cauchy}(0, 15)\)</span> descrivo il grado di plausibilità soggettiva che attribuisco ai possibili valori (&gt; 0) del parametro <span class="math inline">\(\sigma\)</span>. Ai valori prossimi allo 0 attribuisco la plausibilità maggiore; la plausibilità dei possibili valori <span class="math inline">\(\sigma\)</span> diminuisce progressivamente quando ci si allontana dallo 0, come indicato dalla curva della figura seguente. Ritengo poco plausibili valori <span class="math inline">\(\sigma\)</span> maggiori di 40, anche se non escludo completamente che <span class="math inline">\(\sigma\)</span> possa assumere un valore di questo tipo.</p>
<div class="sourceCode" id="cb214"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb214-1"><a href="normal-normal-mod-stan.html#cb214-1" aria-hidden="true" tabindex="-1"></a><span class="fu">curve</span>(</span>
<span id="cb214-2"><a href="normal-normal-mod-stan.html#cb214-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">dcauchy</span>(x, <span class="at">location =</span> <span class="dv">0</span>, <span class="at">scale =</span> <span class="dv">15</span>), </span>
<span id="cb214-3"><a href="normal-normal-mod-stan.html#cb214-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">from =</span> <span class="dv">0</span>, <span class="at">to =</span> <span class="dv">50</span>, <span class="at">col =</span> <span class="st">&#39;gray&#39;</span>, <span class="at">lwd =</span> <span class="dv">3</span>,</span>
<span id="cb214-4"><a href="normal-normal-mod-stan.html#cb214-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">ylab =</span> <span class="st">&quot;Densità&quot;</span>,</span>
<span id="cb214-5"><a href="normal-normal-mod-stan.html#cb214-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">xlab =</span> <span class="st">&quot;sigma&quot;</span></span>
<span id="cb214-6"><a href="normal-normal-mod-stan.html#cb214-6" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<p><img src="bookdown-demo_files/figure-html/unnamed-chunk-212-1.png" width="576" style="display: block; margin: auto;" /></p>
<p>In questo secondo caso, più realistico, il modello diventa il seguente.</p>
<p><span class="math display">\[\begin{align}
Y_i &amp;\sim \mathcal{N}(\mu, \sigma) \notag\\
\mu &amp;\sim \mathcal{N}(25, 2) \notag\\
\sigma &amp;\sim \mbox{Cauchy}(0, 15) \notag
\end{align}\]</span></p>
<p>Il modello precedente è simile a quello esaminato in precedenza, eccetto che abbiamo quantificato la nostra incertezza relativa a <span class="math inline">\(\sigma\)</span> (che è ignota) mediante una distribuzione a priori <span class="math inline">\(\mbox{Cauchy}(0, 15)\)</span>.</p>
<p>La procedura MCMC utilizzata da Stan è basata su un campionamento Monte Carlo Hamiltoniano che non richiede l’uso di distribuzioni a priori coniugate. Pertanto è possibile scegliere per i parametri una qualunque distribuzione a priori. Nel caso presente, appunto, per <span class="math inline">\(\sigma\)</span> ho scelto una <span class="math inline">\(\mbox{Cauchy}(0, 15)\)</span>. Per un tale caso non è possibile ottenere la derivazione analitica della distribuzione a posteriori di <span class="math inline">\(\mu\)</span>. È dunque necessario procedere con il campionamento MCMC.</p>
<p>Scrivo il modello in linguaggio in Stan.</p>
<div class="sourceCode" id="cb215"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb215-1"><a href="normal-normal-mod-stan.html#cb215-1" aria-hidden="true" tabindex="-1"></a>model_string_2 <span class="ot">=</span> <span class="st">&quot;</span></span>
<span id="cb215-2"><a href="normal-normal-mod-stan.html#cb215-2" aria-hidden="true" tabindex="-1"></a><span class="st">data {</span></span>
<span id="cb215-3"><a href="normal-normal-mod-stan.html#cb215-3" aria-hidden="true" tabindex="-1"></a><span class="st">  int&lt;lower=0&gt; N;</span></span>
<span id="cb215-4"><a href="normal-normal-mod-stan.html#cb215-4" aria-hidden="true" tabindex="-1"></a><span class="st">  vector[N] y;</span></span>
<span id="cb215-5"><a href="normal-normal-mod-stan.html#cb215-5" aria-hidden="true" tabindex="-1"></a><span class="st">}</span></span>
<span id="cb215-6"><a href="normal-normal-mod-stan.html#cb215-6" aria-hidden="true" tabindex="-1"></a><span class="st">parameters {</span></span>
<span id="cb215-7"><a href="normal-normal-mod-stan.html#cb215-7" aria-hidden="true" tabindex="-1"></a><span class="st">  real mu;</span></span>
<span id="cb215-8"><a href="normal-normal-mod-stan.html#cb215-8" aria-hidden="true" tabindex="-1"></a><span class="st">  real&lt;lower=0&gt; sigma;</span></span>
<span id="cb215-9"><a href="normal-normal-mod-stan.html#cb215-9" aria-hidden="true" tabindex="-1"></a><span class="st">}</span></span>
<span id="cb215-10"><a href="normal-normal-mod-stan.html#cb215-10" aria-hidden="true" tabindex="-1"></a><span class="st">model {</span></span>
<span id="cb215-11"><a href="normal-normal-mod-stan.html#cb215-11" aria-hidden="true" tabindex="-1"></a><span class="st">  mu ~ normal(25, 2);</span></span>
<span id="cb215-12"><a href="normal-normal-mod-stan.html#cb215-12" aria-hidden="true" tabindex="-1"></a><span class="st">  sigma ~ cauchy(0, 15);</span></span>
<span id="cb215-13"><a href="normal-normal-mod-stan.html#cb215-13" aria-hidden="true" tabindex="-1"></a><span class="st">  y ~ normal(mu, sigma);</span></span>
<span id="cb215-14"><a href="normal-normal-mod-stan.html#cb215-14" aria-hidden="true" tabindex="-1"></a><span class="st">}</span></span>
<span id="cb215-15"><a href="normal-normal-mod-stan.html#cb215-15" aria-hidden="true" tabindex="-1"></a><span class="st">&quot;</span></span>
<span id="cb215-16"><a href="normal-normal-mod-stan.html#cb215-16" aria-hidden="true" tabindex="-1"></a><span class="fu">writeLines</span>(model_string_2, <span class="at">con =</span> <span class="st">&quot;code/normal_mod_2.stan&quot;</span>)</span></code></pre></div>
<p>Creo l’oggetto di classe <code>list</code> che contiene i dati.</p>
<div class="sourceCode" id="cb216"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb216-1"><a href="normal-normal-mod-stan.html#cb216-1" aria-hidden="true" tabindex="-1"></a>dlist2 <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb216-2"><a href="normal-normal-mod-stan.html#cb216-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">N =</span> <span class="fu">length</span>(df<span class="sc">$</span>y),</span>
<span id="cb216-3"><a href="normal-normal-mod-stan.html#cb216-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">y =</span> df<span class="sc">$</span>y</span>
<span id="cb216-4"><a href="normal-normal-mod-stan.html#cb216-4" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<p>Leggo il file con il codice Stan del modello.</p>
<div class="sourceCode" id="cb217"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb217-1"><a href="normal-normal-mod-stan.html#cb217-1" aria-hidden="true" tabindex="-1"></a>file2 <span class="ot">&lt;-</span> <span class="fu">file.path</span>(<span class="st">&quot;code&quot;</span>, <span class="st">&quot;normal_mod_2.stan&quot;</span>)</span></code></pre></div>
<p>Compilo il modello.</p>
<div class="sourceCode" id="cb218"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb218-1"><a href="normal-normal-mod-stan.html#cb218-1" aria-hidden="true" tabindex="-1"></a>mod2 <span class="ot">&lt;-</span> <span class="fu">cmdstan_model</span>(file2)</span></code></pre></div>
<p>Eseguo il campionamento MCMC.</p>
<div class="sourceCode" id="cb219"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb219-1"><a href="normal-normal-mod-stan.html#cb219-1" aria-hidden="true" tabindex="-1"></a>fit2 <span class="ot">&lt;-</span> mod2<span class="sc">$</span><span class="fu">sample</span>(</span>
<span id="cb219-2"><a href="normal-normal-mod-stan.html#cb219-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> dlist2,</span>
<span id="cb219-3"><a href="normal-normal-mod-stan.html#cb219-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">iter_sampling =</span> 50000L,</span>
<span id="cb219-4"><a href="normal-normal-mod-stan.html#cb219-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">iter_warmup =</span> 2000L,</span>
<span id="cb219-5"><a href="normal-normal-mod-stan.html#cb219-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">chains =</span> 4L,</span>
<span id="cb219-6"><a href="normal-normal-mod-stan.html#cb219-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">refresh =</span> <span class="dv">0</span></span>
<span id="cb219-7"><a href="normal-normal-mod-stan.html#cb219-7" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<p>In questo modo ottengo le seguenti stime a posteriori dei parametri.</p>
<div class="sourceCode" id="cb220"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb220-1"><a href="normal-normal-mod-stan.html#cb220-1" aria-hidden="true" tabindex="-1"></a>fit2<span class="sc">$</span><span class="fu">summary</span>(<span class="fu">c</span>(<span class="st">&quot;mu&quot;</span>, <span class="st">&quot;sigma&quot;</span>))</span>
<span id="cb220-2"><a href="normal-normal-mod-stan.html#cb220-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # A tibble: 2 × 10</span></span>
<span id="cb220-3"><a href="normal-normal-mod-stan.html#cb220-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   variable  mean median    sd   mad    q5   q95  rhat ess_bulk ess_tail</span></span>
<span id="cb220-4"><a href="normal-normal-mod-stan.html#cb220-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   &lt;chr&gt;    &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt;</span></span>
<span id="cb220-5"><a href="normal-normal-mod-stan.html#cb220-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1 mu       29.2   29.2   1.14 1.12  27.3  31.0   1.00  129256.  114237.</span></span>
<span id="cb220-6"><a href="normal-normal-mod-stan.html#cb220-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 2 sigma     7.06   6.95  1.01 0.954  5.63  8.88  1.00  121123.  115765.</span></span></code></pre></div>
<p>Dopo avere trasformato l’oggetto <code>fit2</code> nel formato <code>stanfit</code>, trovo l’intervallo di credibilità al 95%.</p>
<div class="sourceCode" id="cb221"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb221-1"><a href="normal-normal-mod-stan.html#cb221-1" aria-hidden="true" tabindex="-1"></a>stanfit <span class="ot">&lt;-</span> rstan<span class="sc">::</span><span class="fu">read_stan_csv</span>(fit2<span class="sc">$</span><span class="fu">output_files</span>())</span>
<span id="cb221-2"><a href="normal-normal-mod-stan.html#cb221-2" aria-hidden="true" tabindex="-1"></a>out <span class="ot">&lt;-</span> rstantools<span class="sc">::</span><span class="fu">posterior_interval</span>(</span>
<span id="cb221-3"><a href="normal-normal-mod-stan.html#cb221-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.matrix</span>(stanfit), </span>
<span id="cb221-4"><a href="normal-normal-mod-stan.html#cb221-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">prob =</span> <span class="fl">0.95</span></span>
<span id="cb221-5"><a href="normal-normal-mod-stan.html#cb221-5" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb221-6"><a href="normal-normal-mod-stan.html#cb221-6" aria-hidden="true" tabindex="-1"></a>out</span>
<span id="cb221-7"><a href="normal-normal-mod-stan.html#cb221-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;             2.5%      97.5%</span></span>
<span id="cb221-8"><a href="normal-normal-mod-stan.html#cb221-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; mu     26.851295  31.331500</span></span>
<span id="cb221-9"><a href="normal-normal-mod-stan.html#cb221-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; sigma   5.418299   9.360616</span></span>
<span id="cb221-10"><a href="normal-normal-mod-stan.html#cb221-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; lp__  -76.415107 -72.666800</span></span></code></pre></div>
<p>Come in precedenza, uso la funzione <code>mcmc_areas()</code> per creare una rappresentazione grafica della distribuzione a posteriori di <span class="math inline">\(\mu\)</span>.</p>
<div class="sourceCode" id="cb222"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb222-1"><a href="normal-normal-mod-stan.html#cb222-1" aria-hidden="true" tabindex="-1"></a>mu_draws <span class="ot">&lt;-</span> <span class="fu">as.matrix</span>(stanfit, <span class="at">pars =</span><span class="st">&quot;mu&quot;</span>)</span>
<span id="cb222-2"><a href="normal-normal-mod-stan.html#cb222-2" aria-hidden="true" tabindex="-1"></a><span class="fu">mcmc_areas</span>(mu_draws, <span class="at">prob =</span> <span class="fl">0.95</span>) </span></code></pre></div>
<p><img src="bookdown-demo_files/figure-html/unnamed-chunk-220-1.png" width="576" style="display: block; margin: auto;" /></p>
<p>Considerati i dati osservati e le mie ipotesi a priori sui parametri, posso dunque concludere, con un grado di certezza soggettiva del 95%, che la media della popolazione dei punteggi BDI-II dei pazienti clinici depressi è compresa nell’intervallo [26.85, 31.33].</p>
<!-- ## Il modello normale con `brms::brm()` -->
<!-- Ripetiamo qui l'analisi precedente usando la funzione `brms::brm()`. In questo caso non è necessario scrivere il modello in forma esplicita, come abbiamo fatto in precedenza. La sintassi seguente viene trasformata in maniera automatica in linguaggio Stan prima di adattare il modello ai dati: -->
<!-- ```{r} -->
<!-- fit <- brm( -->
<!--   data = df, -->
<!--   family = gaussian(), -->
<!--   y ~ 1, -->
<!--   prior = c( -->
<!--     prior(normal(25, 2), class = Intercept), -->
<!--     prior(normal(5, 2.5), class = sigma) -->
<!--   ), -->
<!--   iter = 4000, -->
<!--   refresh = 0, -->
<!--   chains = 4, -->
<!--   backend = "cmdstanr" -->
<!-- ) -->
<!-- ``` -->
<!-- I trace-plot si ottengono nel modo seguente: -->
<!-- ```{r} -->
<!-- plot(fit) -->
<!-- ``` -->
<!-- La stima a posteriori di $\mu$ è fornita dalla funzione `fixef()`: -->
<!-- ```{r} -->
<!-- fixef(fit) -->
<!-- ``` -->
<!-- In conclusione, la funzione `brms::brm()` produce lo stesso risultato (considerate le fluttuazioni nella stima numerica MCMC) trovato in precedenza usando un modello scritto in Stan. -->
</div>
</div>
<div id="commenti-e-considerazioni-finali-8" class="section level2 unnumbered hasAnchor">
<h2>Commenti e considerazioni finali<a href="normal-normal-mod-stan.html#commenti-e-considerazioni-finali-8" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>In questo capitolo abbiamo visto come calcolare l’intervallo di credibilità per la media di una v.c. Normale. La domanda più ovvia di analisi dei dati, dopo avere visto come trovare l’intervallo di credibilità per la media di un solo gruppo, riguarda il confronto tra le medie di due gruppi. Il confronto tra le medie di due gruppi può essere considerato come un caso particolare di un metodo più generale di analisi dei dati, chiamato analisi di regressione lineare. Prima di discutere il problema del confronto tra le medie di due gruppi è dunque necessario esaminare il modello statistico della regressione lineare.</p>

<div id="refs" class="references csl-bib-body hanging-indent">
<div class="csl-entry">
Albert, Jim, and Jingchen Hu. 2019. <em>Probability and Bayesian Modeling</em>. Chapman; Hall/CRC.
</div>
<div class="csl-entry">
Bechdel, Alison. 1986. <em>Dykes to Watch Out for</em>. Firebrand Books.
</div>
<div class="csl-entry">
Carpenter, Bob, Andrew Gelman, Matthew D Hoffman, Daniel Lee, Ben Goodrich, Michael Betancourt, Marcus Brubaker, Jiqiang Guo, Peter Li, and Allen Riddell. 2017. <span>“Stan: A Probabilistic Programming Language.”</span> <em>Journal of Statistical Software</em> 76 (1): 1–32.
</div>
<div class="csl-entry">
Eckhardt, Roger. 1987. <span>“<span class="nocase">Stan Ulam, John Von Neumann and the Monte Carlo Method</span>.”</span> <em>Los Alamos Science Special Issue</em>.
</div>
<div class="csl-entry">
Gautret, P., J. C. Lagier, P. Parola, L. Meddeb, M. Mailhe, B. Doudier, and S. Honoré. 2020. <span>“Hydroxychloroquine and Azithromycin as a Treatment of COVID-19: Results of an Open-Label Non-Randomized Clinical Trial.”</span> <em>International Journal of Antimicrobial Agents</em>.
</div>
<div class="csl-entry">
Gelman, Andrew, John B Carlin, Hal S Stern, and Donald B Rubin. 1995. <em>Bayesian Data Analysis</em>. Chapman; Hall/CRC.
</div>
<div class="csl-entry">
Gelman, Andrew, Jennifer Hill, and Aki Vehtari. 2020. <em>Regression and Other Stories</em>. Cambridge University Press.
</div>
<div class="csl-entry">
Hulme, O. J., E. J. Wagenmakers, P. Damkier, C. F. Madelung, H. R. Siebner, J. Helweg-Larsen, and K. H. Madsen. 2020. <span>“Reply to Gautret Et Al. 2020: A Bayesian Reanalysis of the Effects of Hydroxychloroquine and Azithromycin on Viral Carriage in Patients with COVID-19.”</span> <em>medRxiv</em>.
</div>
<div class="csl-entry">
Johnson, Alicia A., Miles Ott, and Mine Dogucu. 2022. <em><span class="nocase">Bayes Rules! An Introduction to Bayesian Modeling with R</span></em>. CRC Press.
</div>
<div class="csl-entry">
Kruschke, John. 2014. <em>Doing Bayesian Data Analysis: <span>A</span> Tutorial with <span>R</span>, JAGS, and <span>Stan</span></em>. Academic Press.
</div>
<div class="csl-entry">
Lee, Michael D, and Eric-Jan Wagenmakers. 2014. <em>Bayesian Cognitive Modeling: A Practical Course</em>. Cambridge university press.
</div>
<div class="csl-entry">
Martin, Osvaldo A, Ravin Kumar, and Junpeng Lao. 2022. <em>Bayesian Modeling and Computation in Python</em>. CRC Press.
</div>
<div class="csl-entry">
McElreath, Richard. 2020. <em>Statistical Rethinking: <span>A</span> <span>Bayesian</span> Course with Examples in <span>R</span> and <span>Stan</span></em>. 2nd Edition. Boca Raton, Florida: CRC Press.
</div>
<div class="csl-entry">
Metropolis, Nicholas, Arianna W. Rosenbluth, Marshall N. Rosenbluth, Augusta H. Teller, and Edward Teller. 1953. <span>“Equation of State Calculations by Fast Computing Machines.”</span> <em>The Journal of Chemical Physics</em> 21 (6): 1087–92.
</div>
<div class="csl-entry">
Milgram, Stanley. 1963. <span>“Behavioral Study of Obedience.”</span> <em>The Journal of Abnormal and Social Psychology</em> 67 (4): 371–78.
</div>
<div class="csl-entry">
Schmettow, Martin. 2021. <em>New Statistics for Design Researchers</em>. Springer.
</div>
<div class="csl-entry">
Schoot, Rens van de, Sarah Depaoli, Ruth King, Bianca Kramer, Kaspar Märtens, Mahlet G. Tadesse, Marina Vannucci, et al. 2021. <span>“Bayesian Statistics and Modelling.”</span> <em>Nature Reviews Methods Primer</em> 1 (1): 1–26.
</div>
<div class="csl-entry">
Zetsche, Ulrike, Paul-Christian Bürkner, and Babette Renneberg. 2019. <span>“Future Expectations in Clinical Depression: <span>Biased</span> or Realistic?”</span> <em>Journal of Abnormal Psychology</em> 128 (7): 678–88.
</div>
</div>
</div>
</div>




















<h3>References</h3>
<div id="refs" class="references csl-bib-body hanging-indent">
<div id="ref-zetschefuture2019" class="csl-entry">
Zetsche, Ulrike, Paul-Christian Bürkner, and Babette Renneberg. 2019. <span>“Future Expectations in Clinical Depression: <span>Biased</span> or Realistic?”</span> <em>Journal of Abnormal Psychology</em> 128 (7): 678–88.
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="ch-prediction.html" class="navigation navigation-prev navigation-unique" aria-label="Previous page"><i class="fa fa-angle-left"></i></a>

    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/rstudio/bookdown-demo/edit/master/050_normal_normal_mod.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["bookdown-demo.pdf", "bookdown-demo.epub"],
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
