<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Capitolo 3 Modello lineare in Stan | Data Science per psicologi</title>
  <meta name="description" content="This document contains the materials of the lessons of Psicometria B000286 (2021/2022) aimed at students of the first year of the Degree Course in Psychological Sciences and Techniques of the University of Florence, Italy." />
  <meta name="generator" content="bookdown 0.26.2 and GitBook 2.6.7" />

  <meta property="og:title" content="Capitolo 3 Modello lineare in Stan | Data Science per psicologi" />
  <meta property="og:type" content="book" />
  
  <meta property="og:description" content="This document contains the materials of the lessons of Psicometria B000286 (2021/2022) aimed at students of the first year of the Degree Course in Psychological Sciences and Techniques of the University of Florence, Italy." />
  <meta name="github-repo" content="rstudio/bookdown-demo" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Capitolo 3 Modello lineare in Stan | Data Science per psicologi" />
  
  <meta name="twitter:description" content="This document contains the materials of the lessons of Psicometria B000286 (2021/2022) aimed at students of the first year of the Degree Course in Psychological Sciences and Techniques of the University of Florence, Italy." />
  

<meta name="author" content="Corrado Caudek" />


<meta name="date" content="2022-04-22" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="regr-model-lm.html"/>
<link rel="next" href="inference-reg-lin-stan.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
/* Used with Pandoc 2.11+ new --citeproc when CSL is used */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Data science per psicologi</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Prefazione</a>
<ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#la-psicologia-e-la-data-science"><i class="fa fa-check"></i>La psicologia e la Data science</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#come-studiare"><i class="fa fa-check"></i>Come studiare</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#sviluppare-un-metodo-di-studio-efficace"><i class="fa fa-check"></i>Sviluppare un metodo di studio efficace</a></li>
</ul></li>
<li class="part"><span><b>I Il modello lineare</b></span></li>
<li class="chapter" data-level="1" data-path="regr-models-intro.html"><a href="regr-models-intro.html"><i class="fa fa-check"></i><b>1</b> Introduzione</a>
<ul>
<li class="chapter" data-level="1.1" data-path="regr-models-intro.html"><a href="regr-models-intro.html#la-funzione-lineare"><i class="fa fa-check"></i><b>1.1</b> La funzione lineare</a></li>
<li class="chapter" data-level="1.2" data-path="regr-models-intro.html"><a href="regr-models-intro.html#una-media-per-ciascuna-osservazione"><i class="fa fa-check"></i><b>1.2</b> Una media per ciascuna osservazione</a>
<ul>
<li class="chapter" data-level="1.2.1" data-path="regr-models-intro.html"><a href="regr-models-intro.html#relazione-lineare-tra-la-media-y-mid-x-e-il-predittore"><i class="fa fa-check"></i><b>1.2.1</b> Relazione lineare tra la media <span class="math inline">\(y \mid x\)</span> e il predittore</a></li>
<li class="chapter" data-level="1.2.2" data-path="regr-models-intro.html"><a href="regr-models-intro.html#il-modello-lineare"><i class="fa fa-check"></i><b>1.2.2</b> Il modello lineare</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="regr-models-intro.html"><a href="regr-models-intro.html#commenti-e-considerazioni-finali"><i class="fa fa-check"></i>Commenti e considerazioni finali</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="regr-model-lm.html"><a href="regr-model-lm.html"><i class="fa fa-check"></i><b>2</b> Il modello lineare visto da vicino</a>
<ul>
<li class="chapter" data-level="2.1" data-path="regr-model-lm.html"><a href="regr-model-lm.html#stima-dei-coefficienti-di-regressione"><i class="fa fa-check"></i><b>2.1</b> Stima dei coefficienti di regressione</a>
<ul>
<li class="chapter" data-level="2.1.1" data-path="regr-model-lm.html"><a href="regr-model-lm.html#trasformazione-dei-dati"><i class="fa fa-check"></i><b>2.1.1</b> Trasformazione dei dati</a></li>
<li class="chapter" data-level="2.1.2" data-path="regr-model-lm.html"><a href="regr-model-lm.html#il-metodo-dei-minimi-quadrati"><i class="fa fa-check"></i><b>2.1.2</b> Il metodo dei minimi quadrati</a></li>
<li class="chapter" data-level="2.1.3" data-path="regr-model-lm.html"><a href="regr-model-lm.html#il-coefficiente-di-determinazione"><i class="fa fa-check"></i><b>2.1.3</b> Il coefficiente di determinazione</a></li>
</ul></li>
<li class="chapter" data-level="2.2" data-path="regr-model-lm.html"><a href="regr-model-lm.html#indice-di-determinazione"><i class="fa fa-check"></i><b>2.2</b> Indice di determinazione</a>
<ul>
<li class="chapter" data-level="2.2.1" data-path="regr-model-lm.html"><a href="regr-model-lm.html#inferenza-sul-modello-di-regressione"><i class="fa fa-check"></i><b>2.2.1</b> Inferenza sul modello di regressione</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="regr-model-lm.html"><a href="regr-model-lm.html#commenti-e-considerazioni-finali-1"><i class="fa fa-check"></i>Commenti e considerazioni finali</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="reg-lin-stan.html"><a href="reg-lin-stan.html"><i class="fa fa-check"></i><b>3</b> Modello lineare in Stan</a>
<ul>
<li class="chapter" data-level="3.1" data-path="reg-lin-stan.html"><a href="reg-lin-stan.html#una-distribuzione-a-priori-debolmente-informativa"><i class="fa fa-check"></i><b>3.1</b> Una distribuzione a priori debolmente informativa</a></li>
<li class="chapter" data-level="3.2" data-path="reg-lin-stan.html"><a href="reg-lin-stan.html#linguaggio-stan"><i class="fa fa-check"></i><b>3.2</b> Linguaggio Stan</a>
<ul>
<li class="chapter" data-level="3.2.1" data-path="reg-lin-stan.html"><a href="reg-lin-stan.html#standardizzare-i-dati"><i class="fa fa-check"></i><b>3.2.1</b> Standardizzare i dati</a></li>
</ul></li>
<li class="chapter" data-level="3.3" data-path="reg-lin-stan.html"><a href="reg-lin-stan.html#interpretazione-dei-parametri"><i class="fa fa-check"></i><b>3.3</b> Interpretazione dei parametri</a>
<ul>
<li class="chapter" data-level="3.3.1" data-path="reg-lin-stan.html"><a href="reg-lin-stan.html#centrare-i-predittori"><i class="fa fa-check"></i><b>3.3.1</b> Centrare i predittori</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="reg-lin-stan.html"><a href="reg-lin-stan.html#commenti-e-considerazioni-finali-2"><i class="fa fa-check"></i>Commenti e considerazioni finali</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="inference-reg-lin-stan.html"><a href="inference-reg-lin-stan.html"><i class="fa fa-check"></i><b>4</b> Inferenza sul modello lineare</a>
<ul>
<li class="chapter" data-level="4.1" data-path="inference-reg-lin-stan.html"><a href="inference-reg-lin-stan.html#rappresentazione-grafica-dellincertezza-della-stima"><i class="fa fa-check"></i><b>4.1</b> Rappresentazione grafica dell’incertezza della stima</a></li>
<li class="chapter" data-level="4.2" data-path="inference-reg-lin-stan.html"><a href="inference-reg-lin-stan.html#intervalli-di-credibilità"><i class="fa fa-check"></i><b>4.2</b> Intervalli di credibilità</a>
<ul>
<li class="chapter" data-level="4.2.1" data-path="inference-reg-lin-stan.html"><a href="inference-reg-lin-stan.html#quale-soglia-usare"><i class="fa fa-check"></i><b>4.2.1</b> Quale soglia usare?</a></li>
</ul></li>
<li class="chapter" data-level="4.3" data-path="inference-reg-lin-stan.html"><a href="inference-reg-lin-stan.html#test-di-ipotesi"><i class="fa fa-check"></i><b>4.3</b> Test di ipotesi</a></li>
<li class="chapter" data-level="4.4" data-path="inference-reg-lin-stan.html"><a href="inference-reg-lin-stan.html#modello-lineare-robusto"><i class="fa fa-check"></i><b>4.4</b> Modello lineare robusto</a></li>
<li class="chapter" data-level="" data-path="inference-reg-lin-stan.html"><a href="inference-reg-lin-stan.html#commenti-e-considerazioni-finali-3"><i class="fa fa-check"></i>Commenti e considerazioni finali</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="comp-two-means-stan.html"><a href="comp-two-means-stan.html"><i class="fa fa-check"></i><b>5</b> Confronto tra due gruppi indipendenti</a>
<ul>
<li class="chapter" data-level="5.1" data-path="comp-two-means-stan.html"><a href="comp-two-means-stan.html#modello-lineare-con-una-variabile-dicotomica"><i class="fa fa-check"></i><b>5.1</b> Modello lineare con una variabile dicotomica</a>
<ul>
<li class="chapter" data-level="5.1.1" data-path="comp-two-means-stan.html"><a href="comp-two-means-stan.html#confronti-non-effetti"><i class="fa fa-check"></i><b>5.1.1</b> Confronti, non effetti</a></li>
<li class="chapter" data-level="5.1.2" data-path="comp-two-means-stan.html"><a href="comp-two-means-stan.html#un-esempio-concreto"><i class="fa fa-check"></i><b>5.1.2</b> Un esempio concreto</a></li>
</ul></li>
<li class="chapter" data-level="5.2" data-path="comp-two-means-stan.html"><a href="comp-two-means-stan.html#la-dimensione-delleffetto"><i class="fa fa-check"></i><b>5.2</b> La dimensione dell’effetto</a></li>
<li class="chapter" data-level="" data-path="comp-two-means-stan.html"><a href="comp-two-means-stan.html#commenti-e-considerazioni-finali-4"><i class="fa fa-check"></i>Commenti e considerazioni finali</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="ch-pred-checks.html"><a href="ch-pred-checks.html"><i class="fa fa-check"></i><b>6</b> Predictive checks</a>
<ul>
<li class="chapter" data-level="6.1" data-path="ch-pred-checks.html"><a href="ch-pred-checks.html#campionamento-dalla-distribuzione-predittiva-a-posteriori"><i class="fa fa-check"></i><b>6.1</b> Campionamento dalla distribuzione predittiva a posteriori</a></li>
<li class="chapter" data-level="6.2" data-path="ch-pred-checks.html"><a href="ch-pred-checks.html#campionamento-dalla-distribuzione-predittiva-a-priori"><i class="fa fa-check"></i><b>6.2</b> Campionamento dalla distribuzione predittiva a priori</a></li>
<li class="chapter" data-level="" data-path="ch-pred-checks.html"><a href="ch-pred-checks.html#commenti-e-considerazioni-finali-5"><i class="fa fa-check"></i>Commenti e considerazioni finali</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="ch-anova.html"><a href="ch-anova.html"><i class="fa fa-check"></i><b>7</b> Confronto di <span class="math inline">\(k\)</span> gruppi</a>
<ul>
<li class="chapter" data-level="7.1" data-path="ch-anova.html"><a href="ch-anova.html#le-abilità-sociali-di-un-robot"><i class="fa fa-check"></i><b>7.1</b> Le abilità sociali di un robot</a></li>
<li class="chapter" data-level="7.2" data-path="ch-anova.html"><a href="ch-anova.html#anova-stan"><i class="fa fa-check"></i><b>7.2</b> I test statistici dell’Analisi della Varianza</a>
<ul>
<li class="chapter" data-level="7.2.1" data-path="ch-anova.html"><a href="ch-anova.html#test-sullinterazione"><i class="fa fa-check"></i><b>7.2.1</b> Test sull’interazione</a></li>
<li class="chapter" data-level="7.2.2" data-path="ch-anova.html"><a href="ch-anova.html#test-sugli-effetti-principali"><i class="fa fa-check"></i><b>7.2.2</b> Test sugli effetti principali</a></li>
</ul></li>
<li class="chapter" data-level="7.3" data-path="ch-anova.html"><a href="ch-anova.html#codice-stan-versione-2"><i class="fa fa-check"></i><b>7.3</b> Codice Stan (versione 2)</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="mod-hier-stan.html"><a href="mod-hier-stan.html"><i class="fa fa-check"></i><b>8</b> Modello gerarchico</a>
<ul>
<li class="chapter" data-level="8.1" data-path="mod-hier-stan.html"><a href="mod-hier-stan.html#modello-gerarchico"><i class="fa fa-check"></i><b>8.1</b> Modello gerarchico</a></li>
<li class="chapter" data-level="8.2" data-path="mod-hier-stan.html"><a href="mod-hier-stan.html#modello-ad-effetti-fissi"><i class="fa fa-check"></i><b>8.2</b> Modello ad effetti fissi</a></li>
<li class="chapter" data-level="8.3" data-path="mod-hier-stan.html"><a href="mod-hier-stan.html#modello-gerarchico-1"><i class="fa fa-check"></i><b>8.3</b> Modello gerarchico</a></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Data Science per psicologi</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="reg-lin-stan" class="section level1 hasAnchor" number="3">
<h1><span class="header-section-number">Capitolo 3</span> Modello lineare in Stan<a href="reg-lin-stan.html#reg-lin-stan" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<p>Mostreremo qui come sia possibile usare il linguaggio probabilistico Stan per la stima dei parametri del modello di regressione e per l’inferenza.</p>
<div id="una-distribuzione-a-priori-debolmente-informativa" class="section level2 hasAnchor" number="3.1">
<h2><span class="header-section-number">3.1</span> Una distribuzione a priori debolmente informativa<a href="reg-lin-stan.html#una-distribuzione-a-priori-debolmente-informativa" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Per implementare l’approccio bayesiano è necessario assegnare una distribuzione a priori ai parametri. Nel contesto del modello di regressione è desiderabile scegliere distribuzioni a priori che abbiano uno scarso impatto sulla distribuzione a posteriori.</p>
<p>Supponiamo che le nostre credenza a priori sui parametri del modello, <span class="math inline">\(\beta_0\)</span>, <span class="math inline">\(\beta_1\)</span> e <span class="math inline">\(\sigma\)</span> siano tra loro indipendenti. Allora possiamo scrivere la distribuzione congiunta dei parametri nel modo seguente:</p>
<p><span class="math display">\[
p(\beta_0, \beta_1, \sigma) = p(\beta_0)p(\beta_1)p(\sigma).
\]</span></p>
<p>Per i coefficienti di regressione possiamo assumere <span class="math inline">\(\beta_0 \sim \mathcal{N}(\mu_0, s_0)\)</span> e <span class="math inline">\(\beta_1 \sim \mathcal{N}(\mu_1, s_1)\)</span>. Per <span class="math inline">\(\sigma\)</span> possiamo assumere, ad esempio, <span class="math inline">\(\sigma \sim \mbox{Cauchy}(a, b)\)</span>. Moltiplicando la verosimiglianza</p>
<p><span class="math display">\[
\prod_{i=1}^n p(y_i \mid x_i; \beta_0, \beta_1, \sigma^2) = \prod_{i=1}^n \frac{1}{\sqrt{2 \pi \sigma^2}}e^{-\frac{(y_i-(\beta_0+\beta_1 x_i))^2}{2\sigma^2}}
\]</span></p>
<p>per le distribuzioni a priori dei parametri, si ottiene la distribuzione a posteriori. Tuttavia, tale distribuzione non è risolvibile per via analitica. Come in precedenza, usiamo invece un algoritmo MCMC per ottenere una sequenza di campioni casuali dalla distribuzione a posteriori.</p>
</div>
<div id="linguaggio-stan" class="section level2 hasAnchor" number="3.2">
<h2><span class="header-section-number">3.2</span> Linguaggio Stan<a href="reg-lin-stan.html#linguaggio-stan" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>È conveniente usare il linguaggio Stan per ottenere una sequenza MCMC dalla distribuzione a posteriori di un modello di regressione. È semplice formulare la descrizione di un modello bayesiano (verosimiglianza e distribuzione a priori) in uno script scritto in linguaggio Stan.</p>
<p>Continuiamo qui l’esempio precedente in cui ci si poneva il problema di descrivere l’associazione tra il QI dei figli e il QI delle madri mediante un modello lineare. I dati sono quelli del dataset <code>kidiq</code>:</p>
<div class="sourceCode" id="cb35"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb35-1"><a href="reg-lin-stan.html#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(<span class="st">&quot;rio&quot;</span>)</span>
<span id="cb35-2"><a href="reg-lin-stan.html#cb35-2" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> rio<span class="sc">::</span><span class="fu">import</span>(here<span class="sc">::</span><span class="fu">here</span>(<span class="st">&quot;data&quot;</span>, <span class="st">&quot;kidiq.dta&quot;</span>))</span>
<span id="cb35-3"><a href="reg-lin-stan.html#cb35-3" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(df)</span>
<span id="cb35-4"><a href="reg-lin-stan.html#cb35-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   kid_score mom_hs    mom_iq mom_work mom_age</span></span>
<span id="cb35-5"><a href="reg-lin-stan.html#cb35-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1        65      1 121.11753        4      27</span></span>
<span id="cb35-6"><a href="reg-lin-stan.html#cb35-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 2        98      1  89.36188        4      25</span></span>
<span id="cb35-7"><a href="reg-lin-stan.html#cb35-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 3        85      1 115.44316        4      27</span></span>
<span id="cb35-8"><a href="reg-lin-stan.html#cb35-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 4        83      1  99.44964        3      25</span></span>
<span id="cb35-9"><a href="reg-lin-stan.html#cb35-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 5       115      1  92.74571        4      27</span></span>
<span id="cb35-10"><a href="reg-lin-stan.html#cb35-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 6        98      0 107.90184        1      18</span></span></code></pre></div>
<p>Per farci un’idea del valore dei parametri, adattiamo il modello lineare ai dati mediante la procedura di massima verosimiglianza (come abbiamo fatto nel capitolo precedente):</p>
<div class="sourceCode" id="cb36"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb36-1"><a href="reg-lin-stan.html#cb36-1" aria-hidden="true" tabindex="-1"></a>fm <span class="ot">&lt;-</span> <span class="fu">lm</span>(kid_score <span class="sc">~</span> mom_iq, <span class="at">data =</span> df)</span>
<span id="cb36-2"><a href="reg-lin-stan.html#cb36-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(fm)</span>
<span id="cb36-3"><a href="reg-lin-stan.html#cb36-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb36-4"><a href="reg-lin-stan.html#cb36-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Call:</span></span>
<span id="cb36-5"><a href="reg-lin-stan.html#cb36-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; lm(formula = kid_score ~ mom_iq, data = df)</span></span>
<span id="cb36-6"><a href="reg-lin-stan.html#cb36-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb36-7"><a href="reg-lin-stan.html#cb36-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Residuals:</span></span>
<span id="cb36-8"><a href="reg-lin-stan.html#cb36-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;     Min      1Q  Median      3Q     Max </span></span>
<span id="cb36-9"><a href="reg-lin-stan.html#cb36-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; -56.753 -12.074   2.217  11.710  47.691 </span></span>
<span id="cb36-10"><a href="reg-lin-stan.html#cb36-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb36-11"><a href="reg-lin-stan.html#cb36-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Coefficients:</span></span>
<span id="cb36-12"><a href="reg-lin-stan.html#cb36-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;             Estimate Std. Error t value Pr(&gt;|t|)    </span></span>
<span id="cb36-13"><a href="reg-lin-stan.html#cb36-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; (Intercept) 25.79978    5.91741    4.36 1.63e-05 ***</span></span>
<span id="cb36-14"><a href="reg-lin-stan.html#cb36-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; mom_iq       0.60997    0.05852   10.42  &lt; 2e-16 ***</span></span>
<span id="cb36-15"><a href="reg-lin-stan.html#cb36-15" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; ---</span></span>
<span id="cb36-16"><a href="reg-lin-stan.html#cb36-16" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</span></span>
<span id="cb36-17"><a href="reg-lin-stan.html#cb36-17" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb36-18"><a href="reg-lin-stan.html#cb36-18" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Residual standard error: 18.27 on 432 degrees of freedom</span></span>
<span id="cb36-19"><a href="reg-lin-stan.html#cb36-19" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Multiple R-squared:  0.201,  Adjusted R-squared:  0.1991 </span></span>
<span id="cb36-20"><a href="reg-lin-stan.html#cb36-20" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; F-statistic: 108.6 on 1 and 432 DF,  p-value: &lt; 2.2e-16</span></span></code></pre></div>
<p>Sulla base delle informazioni precedenti, giungiamo alla seguente formulazione bayesiana del modello lineare:</p>
<p><span class="math display">\[
\begin{aligned}
y_i &amp;\sim \mathcal{N}(\mu_i, \sigma) \\
\mu_i &amp;= \beta_0 + \beta_1 x_i \\
\beta_0 &amp;\sim \mathcal{N}(25, 10) \\
\beta_1 &amp;\sim \mathcal{N}(0, 1) \\
\sigma &amp;\sim \text{Cauchy}(18, 5)
\end{aligned}
\]</span></p>
<p>La prima riga definisce la funzione di verosimiglianza e le righe successive definiscono le distribuzioni a priori dei parametri. Il segno <span class="math inline">\(\sim\)</span> (tilde) si può leggere “si distribuisce come”. La prima riga ci dice che ciascuna osservazione <span class="math inline">\(y_i\)</span> è una variabile casuale che segue la distribuzione gaussiana di parametri <span class="math inline">\(\mu_i\)</span> e <span class="math inline">\(\sigma\)</span>. La seconda riga specifica, in maniera deterministica, che ciascun <span class="math inline">\(\mu_i\)</span> è una funzione lineare di <span class="math inline">\(x_i\)</span>, con parametri <span class="math inline">\(\beta_0\)</span> e <span class="math inline">\(\beta_1\)</span>. Le due righe successive specificano le distribuzioni a priori per <span class="math inline">\(\beta_0\)</span> e <span class="math inline">\(\beta_1\)</span>. La distribuzione a priori di <span class="math inline">\(\beta_0\)</span> è una distribuzione gaussiana di parametri <span class="math inline">\(\mu_{\alpha} = 25\)</span> e deviazione standard <span class="math inline">\(\sigma_{\alpha} = 10\)</span>; la distribuzione a priori di <span class="math inline">\(\beta_1\)</span> è una distribuzione gaussiana standardizzata. L’ultima riga definisce la distribuzione a priori di <span class="math inline">\(\sigma\)</span>, ovvero una Cauchy di parametri 18 e 5.</p>
<p>Dobbiamo ora specificare il modello bayesiano descritto sopra in linguaggio Stan<a href="#fn3" class="footnote-ref" id="fnref3"><sup>3</sup></a>.</p>
<p>Consideriamo il seguente modello in linguaggio Stan:</p>
<div class="sourceCode" id="cb37"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb37-1"><a href="reg-lin-stan.html#cb37-1" aria-hidden="true" tabindex="-1"></a>model_string_1 <span class="ot">=</span> <span class="st">&quot;</span></span>
<span id="cb37-2"><a href="reg-lin-stan.html#cb37-2" aria-hidden="true" tabindex="-1"></a><span class="st">data {</span></span>
<span id="cb37-3"><a href="reg-lin-stan.html#cb37-3" aria-hidden="true" tabindex="-1"></a><span class="st">  int&lt;lower=0&gt; N;</span></span>
<span id="cb37-4"><a href="reg-lin-stan.html#cb37-4" aria-hidden="true" tabindex="-1"></a><span class="st">  vector[N] y;</span></span>
<span id="cb37-5"><a href="reg-lin-stan.html#cb37-5" aria-hidden="true" tabindex="-1"></a><span class="st">  vector[N] x;</span></span>
<span id="cb37-6"><a href="reg-lin-stan.html#cb37-6" aria-hidden="true" tabindex="-1"></a><span class="st">}</span></span>
<span id="cb37-7"><a href="reg-lin-stan.html#cb37-7" aria-hidden="true" tabindex="-1"></a><span class="st">parameters {</span></span>
<span id="cb37-8"><a href="reg-lin-stan.html#cb37-8" aria-hidden="true" tabindex="-1"></a><span class="st">  real alpha;</span></span>
<span id="cb37-9"><a href="reg-lin-stan.html#cb37-9" aria-hidden="true" tabindex="-1"></a><span class="st">  real beta;</span></span>
<span id="cb37-10"><a href="reg-lin-stan.html#cb37-10" aria-hidden="true" tabindex="-1"></a><span class="st">  real&lt;lower=0&gt; sigma;</span></span>
<span id="cb37-11"><a href="reg-lin-stan.html#cb37-11" aria-hidden="true" tabindex="-1"></a><span class="st">}</span></span>
<span id="cb37-12"><a href="reg-lin-stan.html#cb37-12" aria-hidden="true" tabindex="-1"></a><span class="st">model {</span></span>
<span id="cb37-13"><a href="reg-lin-stan.html#cb37-13" aria-hidden="true" tabindex="-1"></a><span class="st">  // priors</span></span>
<span id="cb37-14"><a href="reg-lin-stan.html#cb37-14" aria-hidden="true" tabindex="-1"></a><span class="st">  alpha ~ normal(25, 10);</span></span>
<span id="cb37-15"><a href="reg-lin-stan.html#cb37-15" aria-hidden="true" tabindex="-1"></a><span class="st">  beta ~ normal(0, 1);</span></span>
<span id="cb37-16"><a href="reg-lin-stan.html#cb37-16" aria-hidden="true" tabindex="-1"></a><span class="st">  sigma ~ cauchy(18, 5);</span></span>
<span id="cb37-17"><a href="reg-lin-stan.html#cb37-17" aria-hidden="true" tabindex="-1"></a><span class="st">  // likelihood</span></span>
<span id="cb37-18"><a href="reg-lin-stan.html#cb37-18" aria-hidden="true" tabindex="-1"></a><span class="st">  for (n in 1:N)</span></span>
<span id="cb37-19"><a href="reg-lin-stan.html#cb37-19" aria-hidden="true" tabindex="-1"></a><span class="st">    y[n] ~ normal(alpha + beta * x[n], sigma);</span></span>
<span id="cb37-20"><a href="reg-lin-stan.html#cb37-20" aria-hidden="true" tabindex="-1"></a><span class="st">}</span></span>
<span id="cb37-21"><a href="reg-lin-stan.html#cb37-21" aria-hidden="true" tabindex="-1"></a><span class="st">&quot;</span></span>
<span id="cb37-22"><a href="reg-lin-stan.html#cb37-22" aria-hidden="true" tabindex="-1"></a><span class="fu">writeLines</span>(model_string_1, <span class="at">con =</span> <span class="st">&quot;code/simpleregkidiq.stan&quot;</span>)</span></code></pre></div>
<p>La funzione <code>modelString()</code> registra una stringa di testo mentre <code>writeLines()</code> crea un file nell’indirizzo specificato. Tale file deve avere l’estensione <code>.stan</code>.</p>
<p>Per svolgere l’analisi bayesiana sistemiamo i dati nel formato appropriato per Stan:</p>
<div class="sourceCode" id="cb38"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb38-1"><a href="reg-lin-stan.html#cb38-1" aria-hidden="true" tabindex="-1"></a>data_list <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb38-2"><a href="reg-lin-stan.html#cb38-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">N =</span> <span class="fu">length</span>(df<span class="sc">$</span>kid_score),</span>
<span id="cb38-3"><a href="reg-lin-stan.html#cb38-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">y =</span> df<span class="sc">$</span>kid_score,</span>
<span id="cb38-4"><a href="reg-lin-stan.html#cb38-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">x =</span> df<span class="sc">$</span>mom_iq</span>
<span id="cb38-5"><a href="reg-lin-stan.html#cb38-5" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<p>La funzione <code>file.path()</code> ritorna l’indirizzo del file con il codice Stan:</p>
<div class="sourceCode" id="cb39"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb39-1"><a href="reg-lin-stan.html#cb39-1" aria-hidden="true" tabindex="-1"></a>file_simple_reg <span class="ot">&lt;-</span> <span class="fu">file.path</span>(<span class="st">&quot;code&quot;</span>, <span class="st">&quot;simpleregstd.stan&quot;</span>)</span></code></pre></div>
<p>Prendendo come input un file contenente un programma Stan, la funzione <code>cmdstan_model()</code> ritorna un oggetto di classe <code>CmdStanModel</code>. In pratica, <code>CmdStan</code> traduce un programma Stan in C++ e crea un eseguibile compilato.</p>
<div class="sourceCode" id="cb40"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb40-1"><a href="reg-lin-stan.html#cb40-1" aria-hidden="true" tabindex="-1"></a>mod1 <span class="ot">&lt;-</span> <span class="fu">cmdstan_model</span>(file_simple_reg)</span></code></pre></div>
<p>Il codice Stan può essere stampato usando il metodo <code>$print()</code>:</p>
<div class="sourceCode" id="cb41"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb41-1"><a href="reg-lin-stan.html#cb41-1" aria-hidden="true" tabindex="-1"></a>mod1<span class="sc">$</span><span class="fu">print</span>()</span></code></pre></div>
<p>L’indirizzo dell’eseguibile compilato viene ritornato da <code>$exe_file()</code>:</p>
<div class="sourceCode" id="cb42"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb42-1"><a href="reg-lin-stan.html#cb42-1" aria-hidden="true" tabindex="-1"></a>mod1<span class="sc">$</span><span class="fu">exe_file</span>()</span></code></pre></div>
<p>Applicando il metodo <code>$sample()</code> ad un oggetto <code>CmdStanModel</code> eseguiamo il campionamento MCMC:</p>
<div class="sourceCode" id="cb43"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb43-1"><a href="reg-lin-stan.html#cb43-1" aria-hidden="true" tabindex="-1"></a>fit_1 <span class="ot">&lt;-</span> mod1<span class="sc">$</span><span class="fu">sample</span>(</span>
<span id="cb43-2"><a href="reg-lin-stan.html#cb43-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> data_list,</span>
<span id="cb43-3"><a href="reg-lin-stan.html#cb43-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">iter_sampling =</span> 4000L,</span>
<span id="cb43-4"><a href="reg-lin-stan.html#cb43-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">iter_warmup =</span> 2000L,</span>
<span id="cb43-5"><a href="reg-lin-stan.html#cb43-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">seed =</span> SEED,</span>
<span id="cb43-6"><a href="reg-lin-stan.html#cb43-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">chains =</span> 4L,</span>
<span id="cb43-7"><a href="reg-lin-stan.html#cb43-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">parallel_chains =</span> 2L,</span>
<span id="cb43-8"><a href="reg-lin-stan.html#cb43-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">refresh =</span> <span class="dv">0</span>,</span>
<span id="cb43-9"><a href="reg-lin-stan.html#cb43-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">thin =</span> <span class="dv">1</span></span>
<span id="cb43-10"><a href="reg-lin-stan.html#cb43-10" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<p>Al metodo <code>$sample()</code> possono essere passati molti argomenti. La pagina di documentazione è disponibile al seguente <a href="https://mc-stan.org/cmdstanr/reference/model-method-sample.html">link</a>.</p>
<p>Un sommario della distribuzione a posteriori per i parametri stimati si ottiene con il metodo <code>$summary()</code>, il quale chiama la funzione <code>summarise_draws()</code> del pacchetto <code>posterior</code>:</p>
<div class="sourceCode" id="cb44"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb44-1"><a href="reg-lin-stan.html#cb44-1" aria-hidden="true" tabindex="-1"></a>fit_1<span class="sc">$</span><span class="fu">summary</span>(<span class="fu">c</span>(<span class="st">&quot;alpha&quot;</span>, <span class="st">&quot;beta&quot;</span>, <span class="st">&quot;sigma&quot;</span>))</span>
<span id="cb44-2"><a href="reg-lin-stan.html#cb44-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # A tibble: 3 × 10</span></span>
<span id="cb44-3"><a href="reg-lin-stan.html#cb44-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   variable   mean median     sd    mad     q5    q95  rhat ess_bulk ess_tail</span></span>
<span id="cb44-4"><a href="reg-lin-stan.html#cb44-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   &lt;chr&gt;     &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt;</span></span>
<span id="cb44-5"><a href="reg-lin-stan.html#cb44-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1 alpha    25.9   25.9   5.98   6.03   16.1   35.7    1.00   15872.   10568.</span></span>
<span id="cb44-6"><a href="reg-lin-stan.html#cb44-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 2 beta      0.609  0.609 0.0591 0.0593  0.512  0.706  1.00   15511.   10930.</span></span>
<span id="cb44-7"><a href="reg-lin-stan.html#cb44-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 3 sigma    18.3   18.3   0.631  0.629  17.3   19.4    1.00   16089.   12115.</span></span></code></pre></div>
<p>Da questo output possiamo valutare rapidamente la convergenza del modello osservando i valori di Rhat per ciascun parametro. Quando questi sono pari o vicini a 1, le catene hanno realizzato la convergenza. Ci sono molti altri test diagnostici, ma questo test è importante per Stan.</p>
<p>Oppure è possibile usare:</p>
<div class="sourceCode" id="cb45"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb45-1"><a href="reg-lin-stan.html#cb45-1" aria-hidden="true" tabindex="-1"></a>fit_1<span class="sc">$</span><span class="fu">cmdstan_summary</span>()</span></code></pre></div>
<p>Le statistiche diagnostiche sono fornite dal metodo <code>$cmdstan_diagnose()</code>:</p>
<div class="sourceCode" id="cb46"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb46-1"><a href="reg-lin-stan.html#cb46-1" aria-hidden="true" tabindex="-1"></a>fit_1<span class="sc">$</span><span class="fu">cmdstan_diagnose</span>()</span></code></pre></div>
<p>È possibile creare un oggetto di classe <code>stanfit</code></p>
<div class="sourceCode" id="cb47"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb47-1"><a href="reg-lin-stan.html#cb47-1" aria-hidden="true" tabindex="-1"></a>stanfit_1 <span class="ot">&lt;-</span> rstan<span class="sc">::</span><span class="fu">read_stan_csv</span>(fit_1<span class="sc">$</span><span class="fu">output_files</span>())</span></code></pre></div>
<p>per poi utilizzare le funzioni del pacchetto <code>bayesplot</code>. Ad esempio:</p>
<div class="sourceCode" id="cb48"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb48-1"><a href="reg-lin-stan.html#cb48-1" aria-hidden="true" tabindex="-1"></a>stanfit_1 <span class="sc">%&gt;%</span> </span>
<span id="cb48-2"><a href="reg-lin-stan.html#cb48-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mcmc_trace</span>(<span class="at">pars =</span> <span class="fu">c</span>(<span class="st">&quot;alpha&quot;</span>, <span class="st">&quot;beta&quot;</span>, <span class="st">&quot;sigma&quot;</span>))</span></code></pre></div>
<p><img src="ds4psy_files/figure-html/unnamed-chunk-51-1.png" width="576" style="display: block; margin: auto;" /></p>
<p>Infine, eseguendo la funzione <code>launch_shinystan(fit)</code>, è possibile analizzare oggetti di classe <code>stanfit</code> mediante le funzionalità del pacchetto <code>ShinyStan</code>.</p>
<div id="standardizzare-i-dati" class="section level3 hasAnchor" number="3.2.1">
<h3><span class="header-section-number">3.2.1</span> Standardizzare i dati<a href="reg-lin-stan.html#standardizzare-i-dati" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Il codice Stan viene eseguito più velocemente se l’input è standardizzato così da avere una media pari a zero e una varianza unitaria.<a href="#fn4" class="footnote-ref" id="fnref4"><sup>4</sup></a> Ponendo <span class="math inline">\(y = (y_1, \dots, y_n)\)</span> e <span class="math inline">\(x = (x_1, \dots, x_n)\)</span>, il modello lineare può essere scritto come</p>
<p><span class="math display">\[
y_i = \alpha + \beta x_i + \varepsilon_i,
\]</span></p>
<p>dove</p>
<p><span class="math display">\[
\varepsilon_i \sim \mathcal{N}(0, \sigma).
\]</span></p>
<p>Seguendo la notazione del manuale Stan, i parametri del modello lineare sono qui denotati da <span class="math inline">\(\alpha\)</span> e <span class="math inline">\(\beta\)</span>. Per eseguire la standardizzazione dei dati, è necessario centrare i dati, sottraendo da essi la media campionaria, per poi scalarli dividendo per la deviazione standard campionaria. Una singola osservazione <span class="math inline">\(u\)</span> viene standardizzata dalla funzione <span class="math inline">\(z\)</span> definita da</p>
<p><span class="math display">\[
z_y(u) = \frac{u - \bar{y}}{\texttt{sd}(y)}
\]</span></p>
<p>dove la media <span class="math inline">\(\bar{y}\)</span> è</p>
<p><span class="math display">\[
\bar{y} = \frac{1}{n} \sum_{i=1}^n y_i,
\]</span>
e la deviazione standard è</p>
<p><span class="math display">\[
\texttt{sd} = \left(\frac{1}{n}\sum_{i=1}^n(y_i - \bar{y})^2\right)^{-\frac{1}{2}}.
\]</span></p>
<p>La trasformata inversa è definita invertendo i due passaggi precedenti: la deviazione standard è usata per scalare i valori <span class="math inline">\(u\)</span> e la media campionaria è usata per traslare la distribuzione dei valori <span class="math inline">\(u\)</span> scalati:</p>
<p><span class="math display">\[
z_y^{-1}(u) = \texttt{sd}(y)u + \bar{y}.
\]</span></p>
<p>Modificando il codice del modello precedente otteniamo il modello Stan per dati standardizzati. Il blocco <code>data</code> è identico a quello del caso precedente. I predittori e la risposta standardizzati sono definiti nel blocco <code>transformed data</code>. Per semplificare la notazione (e velocizzare l’esecuzione), nel blocco <code>model</code> l’istruzione di campionamento è espressa in forma vettorializzata: <code>y_std ~ normal(alpha_std + beta_std * x_std, sigma_std);</code>.</p>
<div class="sourceCode" id="cb49"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb49-1"><a href="reg-lin-stan.html#cb49-1" aria-hidden="true" tabindex="-1"></a>model_string_2 <span class="ot">=</span> <span class="st">&quot;</span></span>
<span id="cb49-2"><a href="reg-lin-stan.html#cb49-2" aria-hidden="true" tabindex="-1"></a><span class="st">data {</span></span>
<span id="cb49-3"><a href="reg-lin-stan.html#cb49-3" aria-hidden="true" tabindex="-1"></a><span class="st">  int&lt;lower=0&gt; N; </span></span>
<span id="cb49-4"><a href="reg-lin-stan.html#cb49-4" aria-hidden="true" tabindex="-1"></a><span class="st">  vector[N] y; </span></span>
<span id="cb49-5"><a href="reg-lin-stan.html#cb49-5" aria-hidden="true" tabindex="-1"></a><span class="st">  vector[N] x; </span></span>
<span id="cb49-6"><a href="reg-lin-stan.html#cb49-6" aria-hidden="true" tabindex="-1"></a><span class="st">}</span></span>
<span id="cb49-7"><a href="reg-lin-stan.html#cb49-7" aria-hidden="true" tabindex="-1"></a><span class="st">transformed data {</span></span>
<span id="cb49-8"><a href="reg-lin-stan.html#cb49-8" aria-hidden="true" tabindex="-1"></a><span class="st">  vector[N] x_std;</span></span>
<span id="cb49-9"><a href="reg-lin-stan.html#cb49-9" aria-hidden="true" tabindex="-1"></a><span class="st">  vector[N] y_std;</span></span>
<span id="cb49-10"><a href="reg-lin-stan.html#cb49-10" aria-hidden="true" tabindex="-1"></a><span class="st">  x_std = (x - mean(x)) / sd(x);</span></span>
<span id="cb49-11"><a href="reg-lin-stan.html#cb49-11" aria-hidden="true" tabindex="-1"></a><span class="st">  y_std = (y - mean(y)) / sd(y);</span></span>
<span id="cb49-12"><a href="reg-lin-stan.html#cb49-12" aria-hidden="true" tabindex="-1"></a><span class="st">}</span></span>
<span id="cb49-13"><a href="reg-lin-stan.html#cb49-13" aria-hidden="true" tabindex="-1"></a><span class="st">parameters {</span></span>
<span id="cb49-14"><a href="reg-lin-stan.html#cb49-14" aria-hidden="true" tabindex="-1"></a><span class="st">  real alpha_std;</span></span>
<span id="cb49-15"><a href="reg-lin-stan.html#cb49-15" aria-hidden="true" tabindex="-1"></a><span class="st">  real beta_std;</span></span>
<span id="cb49-16"><a href="reg-lin-stan.html#cb49-16" aria-hidden="true" tabindex="-1"></a><span class="st">  real&lt;lower=0&gt; sigma_std;</span></span>
<span id="cb49-17"><a href="reg-lin-stan.html#cb49-17" aria-hidden="true" tabindex="-1"></a><span class="st">}</span></span>
<span id="cb49-18"><a href="reg-lin-stan.html#cb49-18" aria-hidden="true" tabindex="-1"></a><span class="st">transformed parameters {</span></span>
<span id="cb49-19"><a href="reg-lin-stan.html#cb49-19" aria-hidden="true" tabindex="-1"></a><span class="st">  vector[N] mu_std = alpha_std + beta_std * x_std; </span></span>
<span id="cb49-20"><a href="reg-lin-stan.html#cb49-20" aria-hidden="true" tabindex="-1"></a><span class="st">}</span></span>
<span id="cb49-21"><a href="reg-lin-stan.html#cb49-21" aria-hidden="true" tabindex="-1"></a><span class="st">model {</span></span>
<span id="cb49-22"><a href="reg-lin-stan.html#cb49-22" aria-hidden="true" tabindex="-1"></a><span class="st">  alpha_std ~ normal(0, 1); </span></span>
<span id="cb49-23"><a href="reg-lin-stan.html#cb49-23" aria-hidden="true" tabindex="-1"></a><span class="st">  beta_std ~ normal(0, 1);  </span></span>
<span id="cb49-24"><a href="reg-lin-stan.html#cb49-24" aria-hidden="true" tabindex="-1"></a><span class="st">  sigma_std ~ normal(0, 1); </span></span>
<span id="cb49-25"><a href="reg-lin-stan.html#cb49-25" aria-hidden="true" tabindex="-1"></a><span class="st">  y_std ~ normal(mu_std, sigma_std); </span></span>
<span id="cb49-26"><a href="reg-lin-stan.html#cb49-26" aria-hidden="true" tabindex="-1"></a><span class="st">}</span></span>
<span id="cb49-27"><a href="reg-lin-stan.html#cb49-27" aria-hidden="true" tabindex="-1"></a><span class="st">generated quantities {</span></span>
<span id="cb49-28"><a href="reg-lin-stan.html#cb49-28" aria-hidden="true" tabindex="-1"></a><span class="st">  // transform to the original data scale</span></span>
<span id="cb49-29"><a href="reg-lin-stan.html#cb49-29" aria-hidden="true" tabindex="-1"></a><span class="st">  real alpha;</span></span>
<span id="cb49-30"><a href="reg-lin-stan.html#cb49-30" aria-hidden="true" tabindex="-1"></a><span class="st">  real beta;</span></span>
<span id="cb49-31"><a href="reg-lin-stan.html#cb49-31" aria-hidden="true" tabindex="-1"></a><span class="st">  real&lt;lower=0&gt; sigma;</span></span>
<span id="cb49-32"><a href="reg-lin-stan.html#cb49-32" aria-hidden="true" tabindex="-1"></a><span class="st">  alpha = sd(y) * (alpha_std - beta_std * mean(x) / sd(x)) + mean(y);</span></span>
<span id="cb49-33"><a href="reg-lin-stan.html#cb49-33" aria-hidden="true" tabindex="-1"></a><span class="st">  beta = beta_std * sd(y) / sd(x);</span></span>
<span id="cb49-34"><a href="reg-lin-stan.html#cb49-34" aria-hidden="true" tabindex="-1"></a><span class="st">  sigma = sd(y) * sigma_std;</span></span>
<span id="cb49-35"><a href="reg-lin-stan.html#cb49-35" aria-hidden="true" tabindex="-1"></a><span class="st">}</span></span>
<span id="cb49-36"><a href="reg-lin-stan.html#cb49-36" aria-hidden="true" tabindex="-1"></a><span class="st">&quot;</span></span>
<span id="cb49-37"><a href="reg-lin-stan.html#cb49-37" aria-hidden="true" tabindex="-1"></a><span class="fu">writeLines</span>(model_string_2, <span class="at">con =</span> <span class="st">&quot;code/simpleregstd.stan&quot;</span>)</span></code></pre></div>
<p>Si noti che i parametri vengono rinominati per indicare che non sono i parametri “naturali”, ma per il resto il modello è identico. Sono qui utilizzate distribuzioni a priori debolmente informative per i parametri <code>alpha</code> e <code>beta</code>.</p>
<p>I valori dei parametri sulla scala originale dei dati vengono calcolati nel blocco <code>generated quantities</code> e possono essere recuperati con un po’ di algebra.</p>
<p><span class="math display">\[\begin{align}
y_n &amp;= \textrm{z}_y^{-1}(\textrm{z}_y(y_n)) \notag\\
    &amp;= \textrm{z}_y^{-1}
\left( \alpha&#39; + \beta&#39; \textrm{z}_x(x_n) + \epsilon_n&#39; \right) \notag\\
    &amp;= \textrm{z}_y^{-1}
\left( \alpha&#39; + \beta&#39; \left( \frac{x_n - \bar{x}}{\texttt{sd}(x)} \right) + \epsilon_n&#39; \right) \notag\\
    &amp;= \texttt{sd}(y)
\left( \alpha&#39; + \beta&#39; \left( \frac{x_n - \bar{x}}{\texttt{sd}(x)} \right) + \epsilon_n&#39; \right) + \bar{y} \notag\\
    &amp;=
\left( \texttt{sd}(y) \left( \alpha&#39; - \beta&#39; \frac{\bar{x}}{\texttt{sd}(x)} \right) + \bar{y} \right)
+ \left( \beta&#39; \frac{\texttt{sd}(y)}{\texttt{sd}(x)} \right) x_n
+ \texttt{sd}(y) \epsilon&#39;_n,
\end{align}\]</span></p>
<p>da cui</p>
<p><span class="math display">\[
\alpha
=
\texttt{sd}(y)
      \left(
          \alpha&#39;
          - \beta&#39; \frac{\bar{x}}{\texttt{sd}(x)}
      \right)
  + \bar{y};
\qquad
\beta = \beta&#39; \frac{\texttt{sd}(y)}{\texttt{sd}(x)};
\qquad
\sigma = \texttt{sd}(y) \sigma&#39;.
\]</span></p>
<p>La funzione <code>file.path()</code> ritorna l’indirizzo del file con il codice Stan:</p>
<div class="sourceCode" id="cb50"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb50-1"><a href="reg-lin-stan.html#cb50-1" aria-hidden="true" tabindex="-1"></a>file_simple_reg_std <span class="ot">&lt;-</span> <span class="fu">file.path</span>(<span class="st">&quot;code&quot;</span>, <span class="st">&quot;simpleregstd.stan&quot;</span>)</span></code></pre></div>
<p>Compiliamo.</p>
<div class="sourceCode" id="cb51"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb51-1"><a href="reg-lin-stan.html#cb51-1" aria-hidden="true" tabindex="-1"></a>mod2 <span class="ot">&lt;-</span> <span class="fu">cmdstan_model</span>(file_simple_reg_std)</span></code></pre></div>
<p>Eseguo il campionamento MCMC.</p>
<div class="sourceCode" id="cb52"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb52-1"><a href="reg-lin-stan.html#cb52-1" aria-hidden="true" tabindex="-1"></a>fit_2 <span class="ot">&lt;-</span> mod2<span class="sc">$</span><span class="fu">sample</span>(</span>
<span id="cb52-2"><a href="reg-lin-stan.html#cb52-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> data_list,</span>
<span id="cb52-3"><a href="reg-lin-stan.html#cb52-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">iter_sampling =</span> 4000L,</span>
<span id="cb52-4"><a href="reg-lin-stan.html#cb52-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">iter_warmup =</span> 2000L,</span>
<span id="cb52-5"><a href="reg-lin-stan.html#cb52-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">seed =</span> SEED,</span>
<span id="cb52-6"><a href="reg-lin-stan.html#cb52-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">chains =</span> 4L,</span>
<span id="cb52-7"><a href="reg-lin-stan.html#cb52-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">parallel_chains =</span> 2L,</span>
<span id="cb52-8"><a href="reg-lin-stan.html#cb52-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">refresh =</span> <span class="dv">0</span>,</span>
<span id="cb52-9"><a href="reg-lin-stan.html#cb52-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">thin =</span> <span class="dv">1</span></span>
<span id="cb52-10"><a href="reg-lin-stan.html#cb52-10" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<p>Esamino i risultati</p>
<div class="sourceCode" id="cb53"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb53-1"><a href="reg-lin-stan.html#cb53-1" aria-hidden="true" tabindex="-1"></a>fit_2<span class="sc">$</span><span class="fu">summary</span>(<span class="fu">c</span>(<span class="st">&quot;alpha_std&quot;</span>, <span class="st">&quot;beta_std&quot;</span>, <span class="st">&quot;sigma_std&quot;</span>, <span class="st">&quot;alpha&quot;</span>, <span class="st">&quot;beta&quot;</span>, <span class="st">&quot;sigma&quot;</span>))</span>
<span id="cb53-2"><a href="reg-lin-stan.html#cb53-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # A tibble: 6 × 10</span></span>
<span id="cb53-3"><a href="reg-lin-stan.html#cb53-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   variable       mean    median     sd    mad      q5     q95  rhat ess_bulk</span></span>
<span id="cb53-4"><a href="reg-lin-stan.html#cb53-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   &lt;chr&gt;         &lt;dbl&gt;     &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt; &lt;dbl&gt;    &lt;dbl&gt;</span></span>
<span id="cb53-5"><a href="reg-lin-stan.html#cb53-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1 alpha_std  0.000107 -0.000149 0.0432 0.0423 -0.0703  0.0715  1.00   18705.</span></span>
<span id="cb53-6"><a href="reg-lin-stan.html#cb53-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 2 beta_std   0.448     0.448    0.0438 0.0443  0.375   0.520   1.00   20084.</span></span>
<span id="cb53-7"><a href="reg-lin-stan.html#cb53-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 3 sigma_std  0.897     0.896    0.0311 0.0316  0.848   0.950   1.00   18813.</span></span>
<span id="cb53-8"><a href="reg-lin-stan.html#cb53-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 4 alpha     25.9      25.8      6.02   6.02   16.0    35.8     1.00   20176.</span></span>
<span id="cb53-9"><a href="reg-lin-stan.html#cb53-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 5 beta       0.609     0.609    0.0596 0.0603  0.511   0.707   1.00   20084.</span></span>
<span id="cb53-10"><a href="reg-lin-stan.html#cb53-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 6 sigma     18.3      18.3      0.634  0.644  17.3    19.4     1.00   18813.</span></span>
<span id="cb53-11"><a href="reg-lin-stan.html#cb53-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # … with 1 more variable: ess_tail &lt;dbl&gt;</span></span></code></pre></div>
<p>Si noti che, avendo usato delle distribuzioni a priori debolmente informative, le stime dei parametri sono molto simili a quelle ottenute mediante la procedura di massima verosimiglianza.</p>
<div class="sourceCode" id="cb54"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb54-1"><a href="reg-lin-stan.html#cb54-1" aria-hidden="true" tabindex="-1"></a><span class="fu">coef</span>(fm)</span>
<span id="cb54-2"><a href="reg-lin-stan.html#cb54-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; (Intercept)      mom_iq </span></span>
<span id="cb54-3"><a href="reg-lin-stan.html#cb54-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  25.7997778   0.6099746</span></span></code></pre></div>
<p>Anziché standardizzare i dati all’interno del programma Stan è anche possibile procedere in un modo diverso, ovvero standardizzare i dati forniti in input. Questa, in realtà, è la procedura usuale. Ciò consente di specificare, per ciascun parametro, una distribuzione a priori su una scala “naturale” per Stan, ovvero quella di una variabile Normale standardizzata. Se non ci sono ragioni particolari per mantenere l’unità di misura dei dati grezzi, standardizzare i dati in input è la strategia migliore.</p>
</div>
</div>
<div id="interpretazione-dei-parametri" class="section level2 hasAnchor" number="3.3">
<h2><span class="header-section-number">3.3</span> Interpretazione dei parametri<a href="reg-lin-stan.html#interpretazione-dei-parametri" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Ripeto qui la discussione del capitolo precedente. Assegnamo ai parametri la seguente interpretazione.</p>
<ul>
<li><p>L’intercetta pari a 25.9 indica il QI medio dei bamini la cui madre ha un QI = 0. Ovviamente questo non ha alcun significato. Vedremo nel modello successivo come trasformare il modello in modo da potere assegnare all’intercetta un’interpretazione sensata.</p></li>
<li><p>La pendenza di 0.61 indica che, all’aumentare di un punto del QI delle madri, il QI medio dei loro bambini aumenta di 0.61 unità. Se consideriamo la gamma di variazione del QI delle madri nel campione, il QI medio dei bambini cambia di 41 punti. Questo indica un sostanziale effetto del QI delle madri sul QI dei loro bambini: <span class="math inline">\((138.89 - 71.04) * 0.61 = 41.39\)</span>.</p></li>
<li><p>Il parametro <span class="math inline">\(\sigma\)</span> = 18.3 fornisce una stima della dispersione delle osservazioni attorno al valore predetto dal modello lineare, ovvero fornisce una stima della deviazione standard dei residui attorno al valore atteso del modello lineare.</p></li>
</ul>
<div id="centrare-i-predittori" class="section level3 hasAnchor" number="3.3.1">
<h3><span class="header-section-number">3.3.1</span> Centrare i predittori<a href="reg-lin-stan.html#centrare-i-predittori" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Come abbiamo detto in precedenza, per migliorare l’interpretazione dell’intercetta possiamo “centrare” la <span class="math inline">\(x\)</span>, ovvero esprimere la <span class="math inline">\(x\)</span> nei termini degli scarti dalla media: <span class="math inline">\(x - \bar{x}\)</span>. In tali circostanze, la pendenza della retta specificata dal modello lineare resta immutata, ma l’intercetta corrisponde a <span class="math inline">\(\E(y \mid x = \bar{x})\)</span>. Per ottenere questo risultato, modifichiamo i dati da passare a Stan:</p>
<div class="sourceCode" id="cb55"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb55-1"><a href="reg-lin-stan.html#cb55-1" aria-hidden="true" tabindex="-1"></a>data2_list <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb55-2"><a href="reg-lin-stan.html#cb55-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">N =</span> <span class="fu">length</span>(df<span class="sc">$</span>kid_score),</span>
<span id="cb55-3"><a href="reg-lin-stan.html#cb55-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">y =</span> df<span class="sc">$</span>kid_score,</span>
<span id="cb55-4"><a href="reg-lin-stan.html#cb55-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">x =</span> df<span class="sc">$</span>mom_iq <span class="sc">-</span> <span class="fu">mean</span>(df<span class="sc">$</span>mom_iq)</span>
<span id="cb55-5"><a href="reg-lin-stan.html#cb55-5" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<p>Adattiamo il modello:</p>
<div class="sourceCode" id="cb56"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb56-1"><a href="reg-lin-stan.html#cb56-1" aria-hidden="true" tabindex="-1"></a>fit_3 <span class="ot">&lt;-</span> mod2<span class="sc">$</span><span class="fu">sample</span>(</span>
<span id="cb56-2"><a href="reg-lin-stan.html#cb56-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> data2_list,</span>
<span id="cb56-3"><a href="reg-lin-stan.html#cb56-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">iter_sampling =</span> 4000L,</span>
<span id="cb56-4"><a href="reg-lin-stan.html#cb56-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">iter_warmup =</span> 2000L,</span>
<span id="cb56-5"><a href="reg-lin-stan.html#cb56-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">seed =</span> SEED,</span>
<span id="cb56-6"><a href="reg-lin-stan.html#cb56-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">chains =</span> 4L,</span>
<span id="cb56-7"><a href="reg-lin-stan.html#cb56-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">parallel_chains =</span> 2L,</span>
<span id="cb56-8"><a href="reg-lin-stan.html#cb56-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">refresh =</span> <span class="dv">0</span>,</span>
<span id="cb56-9"><a href="reg-lin-stan.html#cb56-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">thin =</span> <span class="dv">1</span></span>
<span id="cb56-10"><a href="reg-lin-stan.html#cb56-10" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<p>Trasformiamo l’oggetto <code>fit</code> in un oggetto di classe <code>stanfit</code>:</p>
<div class="sourceCode" id="cb57"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb57-1"><a href="reg-lin-stan.html#cb57-1" aria-hidden="true" tabindex="-1"></a>stanfit_3 <span class="ot">&lt;-</span> rstan<span class="sc">::</span><span class="fu">read_stan_csv</span>(fit_3<span class="sc">$</span><span class="fu">output_files</span>())</span></code></pre></div>
<p>Le stime a posteriori dei parametri si ottengono con</p>
<div class="sourceCode" id="cb58"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb58-1"><a href="reg-lin-stan.html#cb58-1" aria-hidden="true" tabindex="-1"></a>fit_3<span class="sc">$</span><span class="fu">summary</span>(<span class="fu">c</span>(<span class="st">&quot;alpha&quot;</span>, <span class="st">&quot;beta&quot;</span>, <span class="st">&quot;sigma&quot;</span>))</span>
<span id="cb58-2"><a href="reg-lin-stan.html#cb58-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # A tibble: 3 × 10</span></span>
<span id="cb58-3"><a href="reg-lin-stan.html#cb58-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   variable   mean median     sd    mad     q5    q95  rhat ess_bulk ess_tail</span></span>
<span id="cb58-4"><a href="reg-lin-stan.html#cb58-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   &lt;chr&gt;     &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt;</span></span>
<span id="cb58-5"><a href="reg-lin-stan.html#cb58-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1 alpha    86.8   86.8   0.876  0.871  85.4   88.2    1.00   16318.   11494.</span></span>
<span id="cb58-6"><a href="reg-lin-stan.html#cb58-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 2 beta      0.609  0.609 0.0591 0.0589  0.513  0.707  1.00   16206.   11236.</span></span>
<span id="cb58-7"><a href="reg-lin-stan.html#cb58-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 3 sigma    18.3   18.3   0.630  0.624  17.3   19.4    1.00   15617.   11986.</span></span></code></pre></div>
<p>Si noti la nuova intercetta, ovvero 86.8. Questo valore indica il QI medio dei bambini le cui madri hanno un QI pari alla media del campione. Centrare i dati consente dunque di assegnare all’intercetta un’interpretazione utile.</p>
</div>
</div>
<div id="commenti-e-considerazioni-finali-2" class="section level2 unnumbered hasAnchor">
<h2>Commenti e considerazioni finali<a href="reg-lin-stan.html#commenti-e-considerazioni-finali-2" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>La presente discussione suggerisce che è conveniente standardizzare i dati prima di procedere con l’analisi. Ciò può essere fatto all’interno del codice Stan (come negli esempi di questo Capitolo), oppure prima di passare i dati a Stan. Se vengono usati dati standardizzati diventa poi facile utilizzare distribuzioni a priori debolmente informative per i parametri. Tali distribuzioni a priori hanno, come unico scopo, quello di regolarizzare i dati e di facilitare la stima dei parametri mediante MCMC.</p>

</div>
</div>
<div class="footnotes">
<hr />
<ol start="3">
<li id="fn3"><p>Nella discussione che segue ripeto pari pari ciò che è riportato nel manuale del linguaggio <a href="https://mc-stan.org/docs/2_27/stan-users-guide/standardizing-predictors-and-outputs.html">Stan</a>.<a href="reg-lin-stan.html#fnref3" class="footnote-back">↩︎</a></p></li>
<li id="fn4"><p>Si noti un punto importante. Il fatto di standardizzare i dati fa in modo che le distribuzioni a priori sui parametri vadano espresse sulla scala delle v.c. normali standardizzate. Se centriamo sullo 0 tali distribuzioni a priori, con una deviazione standard dell’ordine di grandezza dell’unità, i discorsi sull’arbitrarietà delle distribuzioni a priori perdono di significato: nel caso di dati standardizzati le distribuzioni a priori formulate come indicato sopra sono distribuzioni debolmente informative il cui unico scopo è la regolarizzazione dei dati, ovvero di mantenere le inferenze in una gamma ragionevole di valori. L’uso di distribuzioni a priori debolmente informative contribuisce nel contempo a limitare l’influenza eccessiva delle osservazioni estreme (valori anomali). Il punto importante qui è che tali distribuzioni a priori non introducono alcuna distorsione sistematica nella stima a posteriori.<a href="reg-lin-stan.html#fnref4" class="footnote-back">↩︎</a></p></li>
</ol>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="regr-model-lm.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="inference-reg-lin-stan.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/rstudio/bookdown-demo/edit/master/053_reglin3.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["ds4psy.pdf", "ds4psy.epub"],
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
