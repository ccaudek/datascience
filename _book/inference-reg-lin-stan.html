<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Capitolo 4 Inferenza sul modello lineare | Data Science per psicologi</title>
  <meta name="description" content="This document contains the materials of the lessons of Psicometria B000286 (2021/2022) aimed at students of the first year of the Degree Course in Psychological Sciences and Techniques of the University of Florence, Italy." />
  <meta name="generator" content="bookdown 0.26.2 and GitBook 2.6.7" />

  <meta property="og:title" content="Capitolo 4 Inferenza sul modello lineare | Data Science per psicologi" />
  <meta property="og:type" content="book" />
  
  <meta property="og:description" content="This document contains the materials of the lessons of Psicometria B000286 (2021/2022) aimed at students of the first year of the Degree Course in Psychological Sciences and Techniques of the University of Florence, Italy." />
  <meta name="github-repo" content="rstudio/bookdown-demo" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Capitolo 4 Inferenza sul modello lineare | Data Science per psicologi" />
  
  <meta name="twitter:description" content="This document contains the materials of the lessons of Psicometria B000286 (2021/2022) aimed at students of the first year of the Degree Course in Psychological Sciences and Techniques of the University of Florence, Italy." />
  

<meta name="author" content="Corrado Caudek" />


<meta name="date" content="2022-04-22" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="reg-lin-stan.html"/>
<link rel="next" href="comp-two-means-stan.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
/* Used with Pandoc 2.11+ new --citeproc when CSL is used */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Data science per psicologi</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Prefazione</a>
<ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#la-psicologia-e-la-data-science"><i class="fa fa-check"></i>La psicologia e la Data science</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#come-studiare"><i class="fa fa-check"></i>Come studiare</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#sviluppare-un-metodo-di-studio-efficace"><i class="fa fa-check"></i>Sviluppare un metodo di studio efficace</a></li>
</ul></li>
<li class="part"><span><b>I Il modello lineare</b></span></li>
<li class="chapter" data-level="1" data-path="regr-models-intro.html"><a href="regr-models-intro.html"><i class="fa fa-check"></i><b>1</b> Introduzione</a>
<ul>
<li class="chapter" data-level="1.1" data-path="regr-models-intro.html"><a href="regr-models-intro.html#la-funzione-lineare"><i class="fa fa-check"></i><b>1.1</b> La funzione lineare</a></li>
<li class="chapter" data-level="1.2" data-path="regr-models-intro.html"><a href="regr-models-intro.html#una-media-per-ciascuna-osservazione"><i class="fa fa-check"></i><b>1.2</b> Una media per ciascuna osservazione</a>
<ul>
<li class="chapter" data-level="1.2.1" data-path="regr-models-intro.html"><a href="regr-models-intro.html#relazione-lineare-tra-la-media-y-mid-x-e-il-predittore"><i class="fa fa-check"></i><b>1.2.1</b> Relazione lineare tra la media <span class="math inline">\(y \mid x\)</span> e il predittore</a></li>
<li class="chapter" data-level="1.2.2" data-path="regr-models-intro.html"><a href="regr-models-intro.html#il-modello-lineare"><i class="fa fa-check"></i><b>1.2.2</b> Il modello lineare</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="regr-models-intro.html"><a href="regr-models-intro.html#commenti-e-considerazioni-finali"><i class="fa fa-check"></i>Commenti e considerazioni finali</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="regr-model-lm.html"><a href="regr-model-lm.html"><i class="fa fa-check"></i><b>2</b> Il modello lineare visto da vicino</a>
<ul>
<li class="chapter" data-level="2.1" data-path="regr-model-lm.html"><a href="regr-model-lm.html#stima-dei-coefficienti-di-regressione"><i class="fa fa-check"></i><b>2.1</b> Stima dei coefficienti di regressione</a>
<ul>
<li class="chapter" data-level="2.1.1" data-path="regr-model-lm.html"><a href="regr-model-lm.html#trasformazione-dei-dati"><i class="fa fa-check"></i><b>2.1.1</b> Trasformazione dei dati</a></li>
<li class="chapter" data-level="2.1.2" data-path="regr-model-lm.html"><a href="regr-model-lm.html#il-metodo-dei-minimi-quadrati"><i class="fa fa-check"></i><b>2.1.2</b> Il metodo dei minimi quadrati</a></li>
<li class="chapter" data-level="2.1.3" data-path="regr-model-lm.html"><a href="regr-model-lm.html#il-coefficiente-di-determinazione"><i class="fa fa-check"></i><b>2.1.3</b> Il coefficiente di determinazione</a></li>
</ul></li>
<li class="chapter" data-level="2.2" data-path="regr-model-lm.html"><a href="regr-model-lm.html#indice-di-determinazione"><i class="fa fa-check"></i><b>2.2</b> Indice di determinazione</a>
<ul>
<li class="chapter" data-level="2.2.1" data-path="regr-model-lm.html"><a href="regr-model-lm.html#inferenza-sul-modello-di-regressione"><i class="fa fa-check"></i><b>2.2.1</b> Inferenza sul modello di regressione</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="regr-model-lm.html"><a href="regr-model-lm.html#commenti-e-considerazioni-finali-1"><i class="fa fa-check"></i>Commenti e considerazioni finali</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="reg-lin-stan.html"><a href="reg-lin-stan.html"><i class="fa fa-check"></i><b>3</b> Modello lineare in Stan</a>
<ul>
<li class="chapter" data-level="3.1" data-path="reg-lin-stan.html"><a href="reg-lin-stan.html#una-distribuzione-a-priori-debolmente-informativa"><i class="fa fa-check"></i><b>3.1</b> Una distribuzione a priori debolmente informativa</a></li>
<li class="chapter" data-level="3.2" data-path="reg-lin-stan.html"><a href="reg-lin-stan.html#linguaggio-stan"><i class="fa fa-check"></i><b>3.2</b> Linguaggio Stan</a>
<ul>
<li class="chapter" data-level="3.2.1" data-path="reg-lin-stan.html"><a href="reg-lin-stan.html#standardizzare-i-dati"><i class="fa fa-check"></i><b>3.2.1</b> Standardizzare i dati</a></li>
</ul></li>
<li class="chapter" data-level="3.3" data-path="reg-lin-stan.html"><a href="reg-lin-stan.html#interpretazione-dei-parametri"><i class="fa fa-check"></i><b>3.3</b> Interpretazione dei parametri</a>
<ul>
<li class="chapter" data-level="3.3.1" data-path="reg-lin-stan.html"><a href="reg-lin-stan.html#centrare-i-predittori"><i class="fa fa-check"></i><b>3.3.1</b> Centrare i predittori</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="reg-lin-stan.html"><a href="reg-lin-stan.html#commenti-e-considerazioni-finali-2"><i class="fa fa-check"></i>Commenti e considerazioni finali</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="inference-reg-lin-stan.html"><a href="inference-reg-lin-stan.html"><i class="fa fa-check"></i><b>4</b> Inferenza sul modello lineare</a>
<ul>
<li class="chapter" data-level="4.1" data-path="inference-reg-lin-stan.html"><a href="inference-reg-lin-stan.html#rappresentazione-grafica-dellincertezza-della-stima"><i class="fa fa-check"></i><b>4.1</b> Rappresentazione grafica dell’incertezza della stima</a></li>
<li class="chapter" data-level="4.2" data-path="inference-reg-lin-stan.html"><a href="inference-reg-lin-stan.html#intervalli-di-credibilità"><i class="fa fa-check"></i><b>4.2</b> Intervalli di credibilità</a>
<ul>
<li class="chapter" data-level="4.2.1" data-path="inference-reg-lin-stan.html"><a href="inference-reg-lin-stan.html#quale-soglia-usare"><i class="fa fa-check"></i><b>4.2.1</b> Quale soglia usare?</a></li>
</ul></li>
<li class="chapter" data-level="4.3" data-path="inference-reg-lin-stan.html"><a href="inference-reg-lin-stan.html#test-di-ipotesi"><i class="fa fa-check"></i><b>4.3</b> Test di ipotesi</a></li>
<li class="chapter" data-level="4.4" data-path="inference-reg-lin-stan.html"><a href="inference-reg-lin-stan.html#modello-lineare-robusto"><i class="fa fa-check"></i><b>4.4</b> Modello lineare robusto</a></li>
<li class="chapter" data-level="" data-path="inference-reg-lin-stan.html"><a href="inference-reg-lin-stan.html#commenti-e-considerazioni-finali-3"><i class="fa fa-check"></i>Commenti e considerazioni finali</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="comp-two-means-stan.html"><a href="comp-two-means-stan.html"><i class="fa fa-check"></i><b>5</b> Confronto tra due gruppi indipendenti</a>
<ul>
<li class="chapter" data-level="5.1" data-path="comp-two-means-stan.html"><a href="comp-two-means-stan.html#modello-lineare-con-una-variabile-dicotomica"><i class="fa fa-check"></i><b>5.1</b> Modello lineare con una variabile dicotomica</a>
<ul>
<li class="chapter" data-level="5.1.1" data-path="comp-two-means-stan.html"><a href="comp-two-means-stan.html#confronti-non-effetti"><i class="fa fa-check"></i><b>5.1.1</b> Confronti, non effetti</a></li>
<li class="chapter" data-level="5.1.2" data-path="comp-two-means-stan.html"><a href="comp-two-means-stan.html#un-esempio-concreto"><i class="fa fa-check"></i><b>5.1.2</b> Un esempio concreto</a></li>
</ul></li>
<li class="chapter" data-level="5.2" data-path="comp-two-means-stan.html"><a href="comp-two-means-stan.html#la-dimensione-delleffetto"><i class="fa fa-check"></i><b>5.2</b> La dimensione dell’effetto</a></li>
<li class="chapter" data-level="" data-path="comp-two-means-stan.html"><a href="comp-two-means-stan.html#commenti-e-considerazioni-finali-4"><i class="fa fa-check"></i>Commenti e considerazioni finali</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="ch-pred-checks.html"><a href="ch-pred-checks.html"><i class="fa fa-check"></i><b>6</b> Predictive checks</a>
<ul>
<li class="chapter" data-level="6.1" data-path="ch-pred-checks.html"><a href="ch-pred-checks.html#campionamento-dalla-distribuzione-predittiva-a-posteriori"><i class="fa fa-check"></i><b>6.1</b> Campionamento dalla distribuzione predittiva a posteriori</a></li>
<li class="chapter" data-level="6.2" data-path="ch-pred-checks.html"><a href="ch-pred-checks.html#campionamento-dalla-distribuzione-predittiva-a-priori"><i class="fa fa-check"></i><b>6.2</b> Campionamento dalla distribuzione predittiva a priori</a></li>
<li class="chapter" data-level="" data-path="ch-pred-checks.html"><a href="ch-pred-checks.html#commenti-e-considerazioni-finali-5"><i class="fa fa-check"></i>Commenti e considerazioni finali</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="ch-anova.html"><a href="ch-anova.html"><i class="fa fa-check"></i><b>7</b> Confronto di <span class="math inline">\(k\)</span> gruppi</a>
<ul>
<li class="chapter" data-level="7.1" data-path="ch-anova.html"><a href="ch-anova.html#le-abilità-sociali-di-un-robot"><i class="fa fa-check"></i><b>7.1</b> Le abilità sociali di un robot</a></li>
<li class="chapter" data-level="7.2" data-path="ch-anova.html"><a href="ch-anova.html#anova-stan"><i class="fa fa-check"></i><b>7.2</b> I test statistici dell’Analisi della Varianza</a>
<ul>
<li class="chapter" data-level="7.2.1" data-path="ch-anova.html"><a href="ch-anova.html#test-sullinterazione"><i class="fa fa-check"></i><b>7.2.1</b> Test sull’interazione</a></li>
<li class="chapter" data-level="7.2.2" data-path="ch-anova.html"><a href="ch-anova.html#test-sugli-effetti-principali"><i class="fa fa-check"></i><b>7.2.2</b> Test sugli effetti principali</a></li>
</ul></li>
<li class="chapter" data-level="7.3" data-path="ch-anova.html"><a href="ch-anova.html#codice-stan-versione-2"><i class="fa fa-check"></i><b>7.3</b> Codice Stan (versione 2)</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="mod-hier-stan.html"><a href="mod-hier-stan.html"><i class="fa fa-check"></i><b>8</b> Modello gerarchico</a>
<ul>
<li class="chapter" data-level="8.1" data-path="mod-hier-stan.html"><a href="mod-hier-stan.html#modello-gerarchico"><i class="fa fa-check"></i><b>8.1</b> Modello gerarchico</a></li>
<li class="chapter" data-level="8.2" data-path="mod-hier-stan.html"><a href="mod-hier-stan.html#modello-ad-effetti-fissi"><i class="fa fa-check"></i><b>8.2</b> Modello ad effetti fissi</a></li>
<li class="chapter" data-level="8.3" data-path="mod-hier-stan.html"><a href="mod-hier-stan.html#modello-gerarchico-1"><i class="fa fa-check"></i><b>8.3</b> Modello gerarchico</a></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Data Science per psicologi</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="inference-reg-lin-stan" class="section level1 hasAnchor" number="4">
<h1><span class="header-section-number">Capitolo 4</span> Inferenza sul modello lineare<a href="inference-reg-lin-stan.html#inference-reg-lin-stan" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<div id="rappresentazione-grafica-dellincertezza-della-stima" class="section level2 hasAnchor" number="4.1">
<h2><span class="header-section-number">4.1</span> Rappresentazione grafica dell’incertezza della stima<a href="inference-reg-lin-stan.html#rappresentazione-grafica-dellincertezza-della-stima" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Un primo modo per rappresentare l’incertezza dell’inferenza in un ottica bayesiana è quella di rappresentare graficamente la retta specificata dal modello lineare. Continuando con l’esempio descritto nel Capitolo precedente (ovvero, i dati <code>kid_score</code> e i valori <code>mom_iq</code> centrati), usando la funzione <code>rstan::read_stan_csv</code> leggiamo i file CSV generati da <code>cmdstan</code> e trasformiamo le stime a posteriori dei parametri in formato <code>stanfit</code>:</p>
<div class="sourceCode" id="cb59"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb59-1"><a href="inference-reg-lin-stan.html#cb59-1" aria-hidden="true" tabindex="-1"></a>stanfit <span class="ot">&lt;-</span> rstan<span class="sc">::</span><span class="fu">read_stan_csv</span>(fit2<span class="sc">$</span><span class="fu">output_files</span>())</span>
<span id="cb59-2"><a href="inference-reg-lin-stan.html#cb59-2" aria-hidden="true" tabindex="-1"></a>posterior <span class="ot">&lt;-</span> <span class="fu">extract</span>(stanfit)</span></code></pre></div>
<p>Creiamo ora un diagramma a dispersione dei dati con sovrapposto il valore atteso della <span class="math inline">\(y\)</span>:</p>
<div class="sourceCode" id="cb60"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb60-1"><a href="inference-reg-lin-stan.html#cb60-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tibble</span>(</span>
<span id="cb60-2"><a href="inference-reg-lin-stan.html#cb60-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">kid_score =</span> df<span class="sc">$</span>kid_score,</span>
<span id="cb60-3"><a href="inference-reg-lin-stan.html#cb60-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">mom_iq =</span> df<span class="sc">$</span>mom_iq <span class="sc">-</span> <span class="fu">mean</span>(df<span class="sc">$</span>mom_iq)</span>
<span id="cb60-4"><a href="inference-reg-lin-stan.html#cb60-4" aria-hidden="true" tabindex="-1"></a>) <span class="sc">%&gt;%</span></span>
<span id="cb60-5"><a href="inference-reg-lin-stan.html#cb60-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(mom_iq, kid_score)) <span class="sc">+</span></span>
<span id="cb60-6"><a href="inference-reg-lin-stan.html#cb60-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb60-7"><a href="inference-reg-lin-stan.html#cb60-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_abline</span>(</span>
<span id="cb60-8"><a href="inference-reg-lin-stan.html#cb60-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">intercept =</span> <span class="fu">mean</span>(posterior<span class="sc">$</span>alpha),</span>
<span id="cb60-9"><a href="inference-reg-lin-stan.html#cb60-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">slope =</span> <span class="fu">mean</span>(posterior<span class="sc">$</span>beta)</span>
<span id="cb60-10"><a href="inference-reg-lin-stan.html#cb60-10" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div>
<p><img src="ds4psy_files/figure-html/unnamed-chunk-64-1.png" width="576" style="display: block; margin: auto;" /></p>
<p>L’incertezza della stima della retta specifiata dal modello lineare può essere visualizzata tracciando molteplici rette, ciascuna delle quali definita da un diverso valore estratto a caso dalla distribuzione a posteriori dei parametri <span class="math inline">\(\alpha\)</span> e <span class="math inline">\(\beta\)</span>. Per ottenere questo risultato dobbiamo estrarre le informazioni richieste dall’oggetto <code>stanfit</code> che abbiamo creato; usiamo, per esempio, le funzionalità di <code>tidybayes</code>:</p>
<div class="sourceCode" id="cb61"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb61-1"><a href="inference-reg-lin-stan.html#cb61-1" aria-hidden="true" tabindex="-1"></a>tidybayes<span class="sc">::</span><span class="fu">get_variables</span>(stanfit)</span>
<span id="cb61-2"><a href="inference-reg-lin-stan.html#cb61-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  [1] &quot;alpha_std&quot;     &quot;beta_std&quot;      &quot;sigma_std&quot;     &quot;alpha&quot;        </span></span>
<span id="cb61-3"><a href="inference-reg-lin-stan.html#cb61-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  [5] &quot;beta&quot;          &quot;sigma&quot;         &quot;lp__&quot;          &quot;accept_stat__&quot;</span></span>
<span id="cb61-4"><a href="inference-reg-lin-stan.html#cb61-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  [9] &quot;treedepth__&quot;   &quot;stepsize__&quot;    &quot;divergent__&quot;   &quot;n_leapfrog__&quot; </span></span>
<span id="cb61-5"><a href="inference-reg-lin-stan.html#cb61-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [13] &quot;energy__&quot;</span></span></code></pre></div>
<p>Creiamo un Dataframe in formato tidy (cioè, tale per cui le osservazioni stanno sulle righe e le variabili stanno sulle colonne) che contiene le stime a posteriori di <span class="math inline">\(\alpha\)</span> e <span class="math inline">\(\beta\)</span>:</p>
<div class="sourceCode" id="cb62"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb62-1"><a href="inference-reg-lin-stan.html#cb62-1" aria-hidden="true" tabindex="-1"></a>draws <span class="ot">&lt;-</span> stanfit <span class="sc">%&gt;%</span></span>
<span id="cb62-2"><a href="inference-reg-lin-stan.html#cb62-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">spread_draws</span>(beta, alpha)</span></code></pre></div>
<div class="sourceCode" id="cb63"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb63-1"><a href="inference-reg-lin-stan.html#cb63-1" aria-hidden="true" tabindex="-1"></a>draws <span class="sc">%&gt;%</span></span>
<span id="cb63-2"><a href="inference-reg-lin-stan.html#cb63-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">head</span>(<span class="dv">10</span>)</span>
<span id="cb63-3"><a href="inference-reg-lin-stan.html#cb63-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # A tibble: 10 × 5</span></span>
<span id="cb63-4"><a href="inference-reg-lin-stan.html#cb63-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   .chain .iteration .draw  beta alpha</span></span>
<span id="cb63-5"><a href="inference-reg-lin-stan.html#cb63-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;    &lt;int&gt;      &lt;int&gt; &lt;int&gt; &lt;dbl&gt; &lt;dbl&gt;</span></span>
<span id="cb63-6"><a href="inference-reg-lin-stan.html#cb63-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1      1          1     1 0.632  88.4</span></span>
<span id="cb63-7"><a href="inference-reg-lin-stan.html#cb63-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 2      1          2     2 0.491  87.5</span></span>
<span id="cb63-8"><a href="inference-reg-lin-stan.html#cb63-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 3      1          3     3 0.717  85.9</span></span>
<span id="cb63-9"><a href="inference-reg-lin-stan.html#cb63-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 4      1          4     4 0.478  87.5</span></span>
<span id="cb63-10"><a href="inference-reg-lin-stan.html#cb63-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 5      1          5     5 0.610  86.4</span></span>
<span id="cb63-11"><a href="inference-reg-lin-stan.html#cb63-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 6      1          6     6 0.570  86.7</span></span>
<span id="cb63-12"><a href="inference-reg-lin-stan.html#cb63-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 7      1          7     7 0.623  87.0</span></span>
<span id="cb63-13"><a href="inference-reg-lin-stan.html#cb63-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 8      1          8     8 0.616  87.2</span></span>
<span id="cb63-14"><a href="inference-reg-lin-stan.html#cb63-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # … with 2 more rows</span></span></code></pre></div>
<p>Possiamo ora generare un diagramma a dispersione con <code>ggplot()</code>:</p>
<div class="sourceCode" id="cb64"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb64-1"><a href="inference-reg-lin-stan.html#cb64-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tibble</span>(</span>
<span id="cb64-2"><a href="inference-reg-lin-stan.html#cb64-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">kid_score =</span> df<span class="sc">$</span>kid_score,</span>
<span id="cb64-3"><a href="inference-reg-lin-stan.html#cb64-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">mom_iq =</span> df<span class="sc">$</span>mom_iq <span class="sc">-</span> <span class="fu">mean</span>(df<span class="sc">$</span>mom_iq)</span>
<span id="cb64-4"><a href="inference-reg-lin-stan.html#cb64-4" aria-hidden="true" tabindex="-1"></a>) <span class="sc">%&gt;%</span></span>
<span id="cb64-5"><a href="inference-reg-lin-stan.html#cb64-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(mom_iq, kid_score)) <span class="sc">+</span></span>
<span id="cb64-6"><a href="inference-reg-lin-stan.html#cb64-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb64-7"><a href="inference-reg-lin-stan.html#cb64-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_abline</span>(</span>
<span id="cb64-8"><a href="inference-reg-lin-stan.html#cb64-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> draws, <span class="fu">aes</span>(<span class="at">intercept =</span> alpha, <span class="at">slope =</span> beta),</span>
<span id="cb64-9"><a href="inference-reg-lin-stan.html#cb64-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">size =</span> <span class="fl">0.2</span>, <span class="at">alpha =</span> <span class="fl">0.01</span>, <span class="at">color =</span> <span class="st">&quot;darkgray&quot;</span></span>
<span id="cb64-10"><a href="inference-reg-lin-stan.html#cb64-10" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb64-11"><a href="inference-reg-lin-stan.html#cb64-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_abline</span>(</span>
<span id="cb64-12"><a href="inference-reg-lin-stan.html#cb64-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">intercept =</span> <span class="fu">mean</span>(posterior<span class="sc">$</span>alpha),</span>
<span id="cb64-13"><a href="inference-reg-lin-stan.html#cb64-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">slope =</span> <span class="fu">mean</span>(posterior<span class="sc">$</span>beta)</span>
<span id="cb64-14"><a href="inference-reg-lin-stan.html#cb64-14" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb64-15"><a href="inference-reg-lin-stan.html#cb64-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb64-16"><a href="inference-reg-lin-stan.html#cb64-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">&quot;Quoziente di intelligenza della madre&quot;</span>,</span>
<span id="cb64-17"><a href="inference-reg-lin-stan.html#cb64-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">&quot;Quoziente di intelligenza del bambino&quot;</span></span>
<span id="cb64-18"><a href="inference-reg-lin-stan.html#cb64-18" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div>
<p><img src="ds4psy_files/figure-html/unnamed-chunk-68-1.png" width="576" style="display: block; margin: auto;" /></p>
<p>Il grafico indica che le rette di regressione costruite estraendo a caso valori dalla distribuzione a posteriori dei parametri <span class="math inline">\(\beta_0\)</span> e <span class="math inline">\(\beta_1\)</span> tendono ad essere molto simili tra loro. Ciò significa che, relativamente alla dipendenza (lineare) del quoziente di intelligenza del bambino da quello della madra, la nostra incertezza è molto piccola.</p>
</div>
<div id="intervalli-di-credibilità" class="section level2 hasAnchor" number="4.2">
<h2><span class="header-section-number">4.2</span> Intervalli di credibilità<a href="inference-reg-lin-stan.html#intervalli-di-credibilità" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>L’incertezza inferenziale sui parametri può anche essere descritta mediante gli <em>intervalli di credibilità</em>, ovvero gli intervalli che contengono la quota desiderata (es., il 95%) della distribuzione a posteriori. Per l’esempio che stiamo discutendo, gli intervalli di credibilità al 95% si ottengono nel modo seguente:</p>
<div class="sourceCode" id="cb65"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb65-1"><a href="inference-reg-lin-stan.html#cb65-1" aria-hidden="true" tabindex="-1"></a>rstantools<span class="sc">::</span><span class="fu">posterior_interval</span>(</span>
<span id="cb65-2"><a href="inference-reg-lin-stan.html#cb65-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.matrix</span>(stanfit), </span>
<span id="cb65-3"><a href="inference-reg-lin-stan.html#cb65-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">prob =</span> <span class="fl">0.95</span></span>
<span id="cb65-4"><a href="inference-reg-lin-stan.html#cb65-4" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb65-5"><a href="inference-reg-lin-stan.html#cb65-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;                    2.5%         97.5%</span></span>
<span id="cb65-6"><a href="inference-reg-lin-stan.html#cb65-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; alpha_std   -0.08427372    0.08441589</span></span>
<span id="cb65-7"><a href="inference-reg-lin-stan.html#cb65-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; beta_std     0.36136782    0.53165187</span></span>
<span id="cb65-8"><a href="inference-reg-lin-stan.html#cb65-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; sigma_std    0.83902970    0.96033440</span></span>
<span id="cb65-9"><a href="inference-reg-lin-stan.html#cb65-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; alpha       85.07713000   88.52020750</span></span>
<span id="cb65-10"><a href="inference-reg-lin-stan.html#cb65-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; beta         0.49171840    0.72342520</span></span>
<span id="cb65-11"><a href="inference-reg-lin-stan.html#cb65-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; sigma       17.12519250   19.60110750</span></span>
<span id="cb65-12"><a href="inference-reg-lin-stan.html#cb65-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; lp__      -173.15907500 -168.54400000</span></span></code></pre></div>
<p>Un grafico che, nel caso dei dati standardizzati, riporta l’intervallo di credibilità ai livelli di probabilità desiderati per i parametri <span class="math inline">\(\alpha\)</span>, <span class="math inline">\(\beta\)</span> e <span class="math inline">\(\sigma\)</span> si ottiene con l’istruzione</p>
<div class="sourceCode" id="cb66"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb66-1"><a href="inference-reg-lin-stan.html#cb66-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mcmc_areas</span>(</span>
<span id="cb66-2"><a href="inference-reg-lin-stan.html#cb66-2" aria-hidden="true" tabindex="-1"></a>  fit2<span class="sc">$</span><span class="fu">draws</span>(<span class="fu">c</span>(<span class="st">&quot;alpha_std&quot;</span>, <span class="st">&quot;beta_std&quot;</span>, <span class="st">&quot;sigma_std&quot;</span>)),</span>
<span id="cb66-3"><a href="inference-reg-lin-stan.html#cb66-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">prob =</span> <span class="fl">0.8</span>,</span>
<span id="cb66-4"><a href="inference-reg-lin-stan.html#cb66-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">prob_outer =</span> <span class="fl">0.95</span></span>
<span id="cb66-5"><a href="inference-reg-lin-stan.html#cb66-5" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<p><img src="ds4psy_files/figure-html/unnamed-chunk-70-1.png" width="576" style="display: block; margin: auto;" /></p>
<p>oppure nel modo nel modo seguente</p>
<div class="sourceCode" id="cb67"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb67-1"><a href="inference-reg-lin-stan.html#cb67-1" aria-hidden="true" tabindex="-1"></a>stanfit <span class="sc">%&gt;%</span></span>
<span id="cb67-2"><a href="inference-reg-lin-stan.html#cb67-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mcmc_intervals</span>(</span>
<span id="cb67-3"><a href="inference-reg-lin-stan.html#cb67-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">pars =</span> <span class="fu">c</span>(<span class="st">&quot;alpha_std&quot;</span>, <span class="st">&quot;beta_std&quot;</span>, <span class="st">&quot;sigma_std&quot;</span>),</span>
<span id="cb67-4"><a href="inference-reg-lin-stan.html#cb67-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">prob =</span> <span class="fl">0.8</span>,</span>
<span id="cb67-5"><a href="inference-reg-lin-stan.html#cb67-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">prob_outer =</span> <span class="fl">0.95</span></span>
<span id="cb67-6"><a href="inference-reg-lin-stan.html#cb67-6" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div>
<p><img src="ds4psy_files/figure-html/unnamed-chunk-71-1.png" width="576" style="display: block; margin: auto;" /></p>
<div id="quale-soglia-usare" class="section level3 hasAnchor" number="4.2.1">
<h3><span class="header-section-number">4.2.1</span> Quale soglia usare?<a href="inference-reg-lin-stan.html#quale-soglia-usare" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Non c’è niente di “magico” o necessario relativamente al livello di 0.95: il valore 0.95 è arbitrario. Sono possibili tantissime altre soglie per quantificare la nostra incertezza: alcuni ricercatori usano il livello di 0.89, altri quello di 0.5. Se l’obiettivo è quello di descrivere il livello della nostra incertezza relativamente alla stima del parametro, allora dobbiamo riconoscere che la nostra incertezza è descritta dall’<em>intera</em> distribuzione a posteriori. Per cui il metodo più semplice, più diretto e più completo per descrivere la nostra incertezza rispetto alla stima dei parametri è semplicemente quello di riportare graficamente <em>tutta</em> la distribuzione a posteriori. Una rappresentazione della distribuzione a posteriori dei parametri del modello dell’esempio si ottiene nel modo seguente:</p>
<div class="sourceCode" id="cb68"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb68-1"><a href="inference-reg-lin-stan.html#cb68-1" aria-hidden="true" tabindex="-1"></a>rstan<span class="sc">::</span><span class="fu">stan_dens</span>(</span>
<span id="cb68-2"><a href="inference-reg-lin-stan.html#cb68-2" aria-hidden="true" tabindex="-1"></a>  stanfit,</span>
<span id="cb68-3"><a href="inference-reg-lin-stan.html#cb68-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">pars =</span> <span class="fu">c</span>(<span class="st">&quot;alpha&quot;</span>, <span class="st">&quot;beta&quot;</span>, <span class="st">&quot;sigma&quot;</span>),</span>
<span id="cb68-4"><a href="inference-reg-lin-stan.html#cb68-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">fill =</span> <span class="st">&quot;lightgray&quot;</span></span>
<span id="cb68-5"><a href="inference-reg-lin-stan.html#cb68-5" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<p><img src="ds4psy_files/figure-html/unnamed-chunk-72-1.png" width="576" style="display: block; margin: auto;" /></p>
</div>
</div>
<div id="test-di-ipotesi" class="section level2 hasAnchor" number="4.3">
<h2><span class="header-section-number">4.3</span> Test di ipotesi<a href="inference-reg-lin-stan.html#test-di-ipotesi" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>È facile valutare ipotesi direzionali usando Stan. Per esempio, la probabilità <span class="math inline">\(Pr(\hat{\beta}_1 &gt; 0)\)</span> è</p>
<div class="sourceCode" id="cb69"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb69-1"><a href="inference-reg-lin-stan.html#cb69-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sum</span>(posterior<span class="sc">$</span>beta <span class="sc">&gt;</span> <span class="dv">0</span>) <span class="sc">/</span> <span class="fu">length</span>(posterior<span class="sc">$</span>beta)</span>
<span id="cb69-2"><a href="inference-reg-lin-stan.html#cb69-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] 1</span></span></code></pre></div>
<p>ovvero, la probabilità <span class="math inline">\(Pr(\hat{\beta}_1 &lt; 0)\)</span> è</p>
<div class="sourceCode" id="cb70"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb70-1"><a href="inference-reg-lin-stan.html#cb70-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sum</span>(posterior<span class="sc">$</span>beta <span class="sc">&lt;</span> <span class="dv">0</span>) <span class="sc">/</span> <span class="fu">length</span>(posterior<span class="sc">$</span>beta)</span>
<span id="cb70-2"><a href="inference-reg-lin-stan.html#cb70-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] 0</span></span></code></pre></div>
</div>
<div id="modello-lineare-robusto" class="section level2 hasAnchor" number="4.4">
<h2><span class="header-section-number">4.4</span> Modello lineare robusto<a href="inference-reg-lin-stan.html#modello-lineare-robusto" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Spesso i ricercatori devono affrontare il problema degli outlier: in presenza di outlier, un modello statistico basato sulla distribuzione gaussiana produrrà delle stime distorte dei parametri, ovvero stime che non si generalizzano ad altri campioni di dati. Il metodo tradizionale per affrontare questo problema è quello di eliminare gli outlier prima di eseguire l’analisi statistica. Il problema di questo approccio, però, è che il criterio utilizzato per eliminare gli outlier, quale esso sia, è arbitrario; dunque, usando criteri diversi per la rimozione di outlier, i ricercatori finiscono per trovare risultati diversi.</p>
<p>Questo problema trova una semplice soluzione nell’approccio bayesiano. Il modello lineare che abbiamo dicusso finora ipotizza una specifica distribuzione degli errori, ovvero <span class="math inline">\(\varepsilon \sim \mathcal{N}(0, \sigma_{\varepsilon})\)</span>. In un modello formulato in questi termini, la presenza di solo un valore anomalo e influente ha un effetto drammatico sulle stime dei parametri.</p>
<p>Per fare un esempio, introduciamo un singlo valore anomalo e influente nel set dei dati dell’esempio che stiamo discutendo:</p>
<div class="sourceCode" id="cb71"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb71-1"><a href="inference-reg-lin-stan.html#cb71-1" aria-hidden="true" tabindex="-1"></a>df2 <span class="ot">&lt;-</span> df</span>
<span id="cb71-2"><a href="inference-reg-lin-stan.html#cb71-2" aria-hidden="true" tabindex="-1"></a>df2<span class="sc">$</span>kid_score[<span class="dv">434</span>] <span class="ot">&lt;-</span> <span class="sc">-</span><span class="dv">500</span></span>
<span id="cb71-3"><a href="inference-reg-lin-stan.html#cb71-3" aria-hidden="true" tabindex="-1"></a>df2<span class="sc">$</span>mom_iq[<span class="dv">434</span>] <span class="ot">&lt;-</span> <span class="dv">140</span></span></code></pre></div>
<p>Per comodità, calcoliamo le stime di <span class="math inline">\(\alpha\)</span> e <span class="math inline">\(\beta\)</span> con il metodo dei minimi quadrati (tali stime sono simili a quelle che si otterrebbero con un modello bayesiano gaussiano che impiega distribuzioni a priori debolmente informative). Sappiamo che, nel campione originale di dati, <span class="math inline">\(\hat{\beta} \approx 0.6\)</span>. In presenza di un solo outlier troviamo la stima di <span class="math inline">\(\beta\)</span> viene drammaticamente ridotta:</p>
<div class="sourceCode" id="cb72"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb72-1"><a href="inference-reg-lin-stan.html#cb72-1" aria-hidden="true" tabindex="-1"></a><span class="fu">lm</span>(kid_score <span class="sc">~</span> mom_iq, <span class="at">data =</span> df2) <span class="sc">%&gt;%</span> </span>
<span id="cb72-2"><a href="inference-reg-lin-stan.html#cb72-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coef</span>() </span>
<span id="cb72-3"><a href="inference-reg-lin-stan.html#cb72-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; (Intercept)      mom_iq </span></span>
<span id="cb72-4"><a href="inference-reg-lin-stan.html#cb72-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   49.187954    0.362552</span></span></code></pre></div>
<p>In generale, però, non è necessario assumere <span class="math inline">\(\varepsilon \sim \mathcal{N}(0, \sigma_{\varepsilon})\)</span>. È altrettanto valido un modello che ipotizza una diversa distribuzione di densità per gli errori come, ad esempio, la distribuzione <span class="math inline">\(t\)</span> di Student con un piccolo numero di gradi di libertà. Una caratteristica della <span class="math inline">\(t\)</span> di Student è che le code della distribuzione contengono una massa di probabilità maggiore della distribuzione gaussiana. Ciò fornisce alla <span class="math inline">\(t\)</span> di Student la possibilità di “rendere conto” della presenza di osservazioni lontane dalla media della distribuzione. In altri termini, se in modello lineare usiamo la <span class="math inline">\(t\)</span> di Student quale distribuzione degli errori, la presenza di outlier avrà una minore influenza sulle stime dei parametri di quanto avvenga nel tradizionale modello lineare gaussiano.</p>
<p>Per verificare questa affermazione, modifichiamo il codice Stan usato in precedenza in modo tale da ipotizzare che <span class="math inline">\(y\)</span> segua una distribuzione <span class="math inline">\(t\)</span> di Student con un numero <span class="math inline">\(\nu\)</span> gradi di libertà stimato dal modello: <code>student_t(nu, mu, sigma)</code>.<a href="#fn5" class="footnote-ref" id="fnref5"><sup>5</sup></a></p>
<div class="sourceCode" id="cb73"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb73-1"><a href="inference-reg-lin-stan.html#cb73-1" aria-hidden="true" tabindex="-1"></a>modelString <span class="ot">&lt;-</span> <span class="st">&quot;</span></span>
<span id="cb73-2"><a href="inference-reg-lin-stan.html#cb73-2" aria-hidden="true" tabindex="-1"></a><span class="st">data {</span></span>
<span id="cb73-3"><a href="inference-reg-lin-stan.html#cb73-3" aria-hidden="true" tabindex="-1"></a><span class="st">  int&lt;lower=0&gt; N;</span></span>
<span id="cb73-4"><a href="inference-reg-lin-stan.html#cb73-4" aria-hidden="true" tabindex="-1"></a><span class="st">  vector[N] y;</span></span>
<span id="cb73-5"><a href="inference-reg-lin-stan.html#cb73-5" aria-hidden="true" tabindex="-1"></a><span class="st">  vector[N] x;</span></span>
<span id="cb73-6"><a href="inference-reg-lin-stan.html#cb73-6" aria-hidden="true" tabindex="-1"></a><span class="st">}</span></span>
<span id="cb73-7"><a href="inference-reg-lin-stan.html#cb73-7" aria-hidden="true" tabindex="-1"></a><span class="st">transformed data {</span></span>
<span id="cb73-8"><a href="inference-reg-lin-stan.html#cb73-8" aria-hidden="true" tabindex="-1"></a><span class="st">  vector[N] x_std;</span></span>
<span id="cb73-9"><a href="inference-reg-lin-stan.html#cb73-9" aria-hidden="true" tabindex="-1"></a><span class="st">  vector[N] y_std;</span></span>
<span id="cb73-10"><a href="inference-reg-lin-stan.html#cb73-10" aria-hidden="true" tabindex="-1"></a><span class="st">  x_std = (x - mean(x)) / sd(x);</span></span>
<span id="cb73-11"><a href="inference-reg-lin-stan.html#cb73-11" aria-hidden="true" tabindex="-1"></a><span class="st">  y_std = (y - mean(y)) / sd(y);</span></span>
<span id="cb73-12"><a href="inference-reg-lin-stan.html#cb73-12" aria-hidden="true" tabindex="-1"></a><span class="st">}</span></span>
<span id="cb73-13"><a href="inference-reg-lin-stan.html#cb73-13" aria-hidden="true" tabindex="-1"></a><span class="st">parameters {</span></span>
<span id="cb73-14"><a href="inference-reg-lin-stan.html#cb73-14" aria-hidden="true" tabindex="-1"></a><span class="st">  real alpha_std;</span></span>
<span id="cb73-15"><a href="inference-reg-lin-stan.html#cb73-15" aria-hidden="true" tabindex="-1"></a><span class="st">  real beta_std;</span></span>
<span id="cb73-16"><a href="inference-reg-lin-stan.html#cb73-16" aria-hidden="true" tabindex="-1"></a><span class="st">  real&lt;lower=0&gt; sigma_std;</span></span>
<span id="cb73-17"><a href="inference-reg-lin-stan.html#cb73-17" aria-hidden="true" tabindex="-1"></a><span class="st">  real&lt;lower=1&gt; nu;    // degrees of freedom is constrained &gt;1</span></span>
<span id="cb73-18"><a href="inference-reg-lin-stan.html#cb73-18" aria-hidden="true" tabindex="-1"></a><span class="st">}</span></span>
<span id="cb73-19"><a href="inference-reg-lin-stan.html#cb73-19" aria-hidden="true" tabindex="-1"></a><span class="st">model {</span></span>
<span id="cb73-20"><a href="inference-reg-lin-stan.html#cb73-20" aria-hidden="true" tabindex="-1"></a><span class="st">  alpha_std ~ normal(0, 1);</span></span>
<span id="cb73-21"><a href="inference-reg-lin-stan.html#cb73-21" aria-hidden="true" tabindex="-1"></a><span class="st">  beta_std ~ normal(0, 1);</span></span>
<span id="cb73-22"><a href="inference-reg-lin-stan.html#cb73-22" aria-hidden="true" tabindex="-1"></a><span class="st">  sigma_std ~ normal(0, 1);</span></span>
<span id="cb73-23"><a href="inference-reg-lin-stan.html#cb73-23" aria-hidden="true" tabindex="-1"></a><span class="st">  nu ~ gamma(2, 0.1);   // Juárez and Steel(2010)</span></span>
<span id="cb73-24"><a href="inference-reg-lin-stan.html#cb73-24" aria-hidden="true" tabindex="-1"></a><span class="st">  y_std ~ student_t(nu, alpha_std + beta_std * x_std, sigma_std);</span></span>
<span id="cb73-25"><a href="inference-reg-lin-stan.html#cb73-25" aria-hidden="true" tabindex="-1"></a><span class="st">}</span></span>
<span id="cb73-26"><a href="inference-reg-lin-stan.html#cb73-26" aria-hidden="true" tabindex="-1"></a><span class="st">generated quantities {</span></span>
<span id="cb73-27"><a href="inference-reg-lin-stan.html#cb73-27" aria-hidden="true" tabindex="-1"></a><span class="st">  real alpha;</span></span>
<span id="cb73-28"><a href="inference-reg-lin-stan.html#cb73-28" aria-hidden="true" tabindex="-1"></a><span class="st">  real beta;</span></span>
<span id="cb73-29"><a href="inference-reg-lin-stan.html#cb73-29" aria-hidden="true" tabindex="-1"></a><span class="st">  real&lt;lower=0&gt; sigma;</span></span>
<span id="cb73-30"><a href="inference-reg-lin-stan.html#cb73-30" aria-hidden="true" tabindex="-1"></a><span class="st">  alpha = sd(y) * (alpha_std - beta_std * mean(x) / sd(x))</span></span>
<span id="cb73-31"><a href="inference-reg-lin-stan.html#cb73-31" aria-hidden="true" tabindex="-1"></a><span class="st">           + mean(y);</span></span>
<span id="cb73-32"><a href="inference-reg-lin-stan.html#cb73-32" aria-hidden="true" tabindex="-1"></a><span class="st">  beta = beta_std * sd(y) / sd(x);</span></span>
<span id="cb73-33"><a href="inference-reg-lin-stan.html#cb73-33" aria-hidden="true" tabindex="-1"></a><span class="st">  sigma = sd(y) * sigma_std;</span></span>
<span id="cb73-34"><a href="inference-reg-lin-stan.html#cb73-34" aria-hidden="true" tabindex="-1"></a><span class="st">}</span></span>
<span id="cb73-35"><a href="inference-reg-lin-stan.html#cb73-35" aria-hidden="true" tabindex="-1"></a><span class="st">&quot;</span></span>
<span id="cb73-36"><a href="inference-reg-lin-stan.html#cb73-36" aria-hidden="true" tabindex="-1"></a><span class="fu">writeLines</span>(modelString, <span class="at">con =</span> <span class="st">&quot;code/simpleregstdrobust.stan&quot;</span>)</span></code></pre></div>
<p>Costruiamo la lista dei dati usando il data.frame <code>df2</code> che include l’outlier:</p>
<div class="sourceCode" id="cb74"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb74-1"><a href="inference-reg-lin-stan.html#cb74-1" aria-hidden="true" tabindex="-1"></a>data3_list <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb74-2"><a href="inference-reg-lin-stan.html#cb74-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">N =</span> <span class="fu">length</span>(df2<span class="sc">$</span>kid_score),</span>
<span id="cb74-3"><a href="inference-reg-lin-stan.html#cb74-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">y =</span> df2<span class="sc">$</span>kid_score,</span>
<span id="cb74-4"><a href="inference-reg-lin-stan.html#cb74-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">x =</span> df2<span class="sc">$</span>mom_iq <span class="sc">-</span> <span class="fu">mean</span>(df2<span class="sc">$</span>mom_iq)</span>
<span id="cb74-5"><a href="inference-reg-lin-stan.html#cb74-5" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<p>Adattiamo il modello lineare robusto ai dati:</p>
<div class="sourceCode" id="cb75"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb75-1"><a href="inference-reg-lin-stan.html#cb75-1" aria-hidden="true" tabindex="-1"></a>file <span class="ot">&lt;-</span> <span class="fu">file.path</span>(<span class="st">&quot;code&quot;</span>, <span class="st">&quot;simpleregstdrobust.stan&quot;</span>)</span>
<span id="cb75-2"><a href="inference-reg-lin-stan.html#cb75-2" aria-hidden="true" tabindex="-1"></a>mod <span class="ot">&lt;-</span> <span class="fu">cmdstan_model</span>(file)</span>
<span id="cb75-3"><a href="inference-reg-lin-stan.html#cb75-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-4"><a href="inference-reg-lin-stan.html#cb75-4" aria-hidden="true" tabindex="-1"></a>fit4 <span class="ot">&lt;-</span> mod<span class="sc">$</span><span class="fu">sample</span>(</span>
<span id="cb75-5"><a href="inference-reg-lin-stan.html#cb75-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> data3_list,</span>
<span id="cb75-6"><a href="inference-reg-lin-stan.html#cb75-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">iter_sampling =</span> 4000L,</span>
<span id="cb75-7"><a href="inference-reg-lin-stan.html#cb75-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">iter_warmup =</span> 2000L,</span>
<span id="cb75-8"><a href="inference-reg-lin-stan.html#cb75-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">seed =</span> SEED,</span>
<span id="cb75-9"><a href="inference-reg-lin-stan.html#cb75-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">chains =</span> 4L,</span>
<span id="cb75-10"><a href="inference-reg-lin-stan.html#cb75-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">parallel_chains =</span> 2L,</span>
<span id="cb75-11"><a href="inference-reg-lin-stan.html#cb75-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">refresh =</span> <span class="dv">0</span>,</span>
<span id="cb75-12"><a href="inference-reg-lin-stan.html#cb75-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">thin =</span> <span class="dv">1</span></span>
<span id="cb75-13"><a href="inference-reg-lin-stan.html#cb75-13" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<p>Se esaminiamo le stime dei parametri notiamo che la stima di <span class="math inline">\(\beta\)</span> non è stata influenzata dalla presenza di un’osservazione anomala e influente:</p>
<div class="sourceCode" id="cb76"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb76-1"><a href="inference-reg-lin-stan.html#cb76-1" aria-hidden="true" tabindex="-1"></a>fit4<span class="sc">$</span><span class="fu">summary</span>(<span class="fu">c</span>(<span class="st">&quot;alpha&quot;</span>, <span class="st">&quot;beta&quot;</span>, <span class="st">&quot;sigma&quot;</span>, <span class="st">&quot;nu&quot;</span>))</span>
<span id="cb76-2"><a href="inference-reg-lin-stan.html#cb76-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # A tibble: 4 × 10</span></span>
<span id="cb76-3"><a href="inference-reg-lin-stan.html#cb76-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   variable   mean median     sd    mad     q5    q95  rhat ess_bulk ess_tail</span></span>
<span id="cb76-4"><a href="inference-reg-lin-stan.html#cb76-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   &lt;chr&gt;     &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt;</span></span>
<span id="cb76-5"><a href="inference-reg-lin-stan.html#cb76-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1 alpha    87.8   87.8   0.901  0.898  86.3   89.3    1.00   14740.   12422.</span></span>
<span id="cb76-6"><a href="inference-reg-lin-stan.html#cb76-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 2 beta      0.602  0.602 0.0589 0.0587  0.505  0.699  1.00   14903.   11582.</span></span>
<span id="cb76-7"><a href="inference-reg-lin-stan.html#cb76-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 3 sigma    15.9   15.9   0.800  0.803  14.6   17.2    1.00   12993.   11619.</span></span>
<span id="cb76-8"><a href="inference-reg-lin-stan.html#cb76-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 4 nu        5.58   5.46  1.15   1.09    3.93   7.64   1.00   12998.   11288.</span></span></code></pre></div>
<p>Il modello lineare robusto non risente dunque della presenza di outlier.</p>
</div>
<div id="commenti-e-considerazioni-finali-3" class="section level2 unnumbered hasAnchor">
<h2>Commenti e considerazioni finali<a href="inference-reg-lin-stan.html#commenti-e-considerazioni-finali-3" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Nell’approccio bayesiano possiamo rappresentare l’incertezza delle nostre credenze a posteriori in due modi: mediante la rappresentazione grafica dell’intera distribuzione a posteriori dei parametri o mediante l’uso degli intervalli di credibilità. Un bonus della discussione del presente Capitolo è quello di mostrare come il modello lineare tradizionale (che assume <span class="math inline">\(\varepsilon \sim \mathcal{N}(0, \sigma_{\varepsilon})\)</span>) possa essere facilmente esteso nei termini di un modello robusto che offre una semplice soluzione al problema di ridurre l’effetto della presenza di osservazioni outlier.</p>

</div>
</div>
<div class="footnotes">
<hr />
<ol start="5">
<li id="fn5"><p>È equivalente scrivere <span class="math inline">\(y_i = \mu_i + \varepsilon_i\)</span>, dove <span class="math inline">\(\mu_i = \alpha + \beta x_i, \varepsilon_i \sim \mathcal{N}(0, \sigma_\varepsilon),\)</span> oppure <span class="math inline">\(y_i \sim \mathcal{N}(\mu_i, \sigma_\varepsilon).\)</span><a href="inference-reg-lin-stan.html#fnref5" class="footnote-back">↩︎</a></p></li>
</ol>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="reg-lin-stan.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="comp-two-means-stan.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/rstudio/bookdown-demo/edit/master/054_reglin4.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["ds4psy.pdf", "ds4psy.epub"],
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
