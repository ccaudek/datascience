<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Capitolo 6 Predictive checks | Data Science per psicologi</title>
  <meta name="description" content="This document contains the materials of the lessons of Psicometria B000286 (2021/2022) aimed at students of the first year of the Degree Course in Psychological Sciences and Techniques of the University of Florence, Italy." />
  <meta name="generator" content="bookdown 0.26.2 and GitBook 2.6.7" />

  <meta property="og:title" content="Capitolo 6 Predictive checks | Data Science per psicologi" />
  <meta property="og:type" content="book" />
  
  <meta property="og:description" content="This document contains the materials of the lessons of Psicometria B000286 (2021/2022) aimed at students of the first year of the Degree Course in Psychological Sciences and Techniques of the University of Florence, Italy." />
  <meta name="github-repo" content="rstudio/bookdown-demo" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Capitolo 6 Predictive checks | Data Science per psicologi" />
  
  <meta name="twitter:description" content="This document contains the materials of the lessons of Psicometria B000286 (2021/2022) aimed at students of the first year of the Degree Course in Psychological Sciences and Techniques of the University of Florence, Italy." />
  

<meta name="author" content="Corrado Caudek" />


<meta name="date" content="2022-04-22" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="comp-two-means-stan.html"/>
<link rel="next" href="ch-anova.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
/* Used with Pandoc 2.11+ new --citeproc when CSL is used */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Data science per psicologi</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Prefazione</a>
<ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#la-psicologia-e-la-data-science"><i class="fa fa-check"></i>La psicologia e la Data science</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#come-studiare"><i class="fa fa-check"></i>Come studiare</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#sviluppare-un-metodo-di-studio-efficace"><i class="fa fa-check"></i>Sviluppare un metodo di studio efficace</a></li>
</ul></li>
<li class="part"><span><b>I Il modello lineare</b></span></li>
<li class="chapter" data-level="1" data-path="regr-models-intro.html"><a href="regr-models-intro.html"><i class="fa fa-check"></i><b>1</b> Introduzione</a>
<ul>
<li class="chapter" data-level="1.1" data-path="regr-models-intro.html"><a href="regr-models-intro.html#la-funzione-lineare"><i class="fa fa-check"></i><b>1.1</b> La funzione lineare</a></li>
<li class="chapter" data-level="1.2" data-path="regr-models-intro.html"><a href="regr-models-intro.html#una-media-per-ciascuna-osservazione"><i class="fa fa-check"></i><b>1.2</b> Una media per ciascuna osservazione</a>
<ul>
<li class="chapter" data-level="1.2.1" data-path="regr-models-intro.html"><a href="regr-models-intro.html#relazione-lineare-tra-la-media-y-mid-x-e-il-predittore"><i class="fa fa-check"></i><b>1.2.1</b> Relazione lineare tra la media <span class="math inline">\(y \mid x\)</span> e il predittore</a></li>
<li class="chapter" data-level="1.2.2" data-path="regr-models-intro.html"><a href="regr-models-intro.html#il-modello-lineare"><i class="fa fa-check"></i><b>1.2.2</b> Il modello lineare</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="regr-models-intro.html"><a href="regr-models-intro.html#commenti-e-considerazioni-finali"><i class="fa fa-check"></i>Commenti e considerazioni finali</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="regr-model-lm.html"><a href="regr-model-lm.html"><i class="fa fa-check"></i><b>2</b> Il modello lineare visto da vicino</a>
<ul>
<li class="chapter" data-level="2.1" data-path="regr-model-lm.html"><a href="regr-model-lm.html#stima-dei-coefficienti-di-regressione"><i class="fa fa-check"></i><b>2.1</b> Stima dei coefficienti di regressione</a>
<ul>
<li class="chapter" data-level="2.1.1" data-path="regr-model-lm.html"><a href="regr-model-lm.html#trasformazione-dei-dati"><i class="fa fa-check"></i><b>2.1.1</b> Trasformazione dei dati</a></li>
<li class="chapter" data-level="2.1.2" data-path="regr-model-lm.html"><a href="regr-model-lm.html#il-metodo-dei-minimi-quadrati"><i class="fa fa-check"></i><b>2.1.2</b> Il metodo dei minimi quadrati</a></li>
<li class="chapter" data-level="2.1.3" data-path="regr-model-lm.html"><a href="regr-model-lm.html#il-coefficiente-di-determinazione"><i class="fa fa-check"></i><b>2.1.3</b> Il coefficiente di determinazione</a></li>
</ul></li>
<li class="chapter" data-level="2.2" data-path="regr-model-lm.html"><a href="regr-model-lm.html#indice-di-determinazione"><i class="fa fa-check"></i><b>2.2</b> Indice di determinazione</a>
<ul>
<li class="chapter" data-level="2.2.1" data-path="regr-model-lm.html"><a href="regr-model-lm.html#inferenza-sul-modello-di-regressione"><i class="fa fa-check"></i><b>2.2.1</b> Inferenza sul modello di regressione</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="regr-model-lm.html"><a href="regr-model-lm.html#commenti-e-considerazioni-finali-1"><i class="fa fa-check"></i>Commenti e considerazioni finali</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="reg-lin-stan.html"><a href="reg-lin-stan.html"><i class="fa fa-check"></i><b>3</b> Modello lineare in Stan</a>
<ul>
<li class="chapter" data-level="3.1" data-path="reg-lin-stan.html"><a href="reg-lin-stan.html#una-distribuzione-a-priori-debolmente-informativa"><i class="fa fa-check"></i><b>3.1</b> Una distribuzione a priori debolmente informativa</a></li>
<li class="chapter" data-level="3.2" data-path="reg-lin-stan.html"><a href="reg-lin-stan.html#linguaggio-stan"><i class="fa fa-check"></i><b>3.2</b> Linguaggio Stan</a>
<ul>
<li class="chapter" data-level="3.2.1" data-path="reg-lin-stan.html"><a href="reg-lin-stan.html#standardizzare-i-dati"><i class="fa fa-check"></i><b>3.2.1</b> Standardizzare i dati</a></li>
</ul></li>
<li class="chapter" data-level="3.3" data-path="reg-lin-stan.html"><a href="reg-lin-stan.html#interpretazione-dei-parametri"><i class="fa fa-check"></i><b>3.3</b> Interpretazione dei parametri</a>
<ul>
<li class="chapter" data-level="3.3.1" data-path="reg-lin-stan.html"><a href="reg-lin-stan.html#centrare-i-predittori"><i class="fa fa-check"></i><b>3.3.1</b> Centrare i predittori</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="reg-lin-stan.html"><a href="reg-lin-stan.html#commenti-e-considerazioni-finali-2"><i class="fa fa-check"></i>Commenti e considerazioni finali</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="inference-reg-lin-stan.html"><a href="inference-reg-lin-stan.html"><i class="fa fa-check"></i><b>4</b> Inferenza sul modello lineare</a>
<ul>
<li class="chapter" data-level="4.1" data-path="inference-reg-lin-stan.html"><a href="inference-reg-lin-stan.html#rappresentazione-grafica-dellincertezza-della-stima"><i class="fa fa-check"></i><b>4.1</b> Rappresentazione grafica dell’incertezza della stima</a></li>
<li class="chapter" data-level="4.2" data-path="inference-reg-lin-stan.html"><a href="inference-reg-lin-stan.html#intervalli-di-credibilità"><i class="fa fa-check"></i><b>4.2</b> Intervalli di credibilità</a>
<ul>
<li class="chapter" data-level="4.2.1" data-path="inference-reg-lin-stan.html"><a href="inference-reg-lin-stan.html#quale-soglia-usare"><i class="fa fa-check"></i><b>4.2.1</b> Quale soglia usare?</a></li>
</ul></li>
<li class="chapter" data-level="4.3" data-path="inference-reg-lin-stan.html"><a href="inference-reg-lin-stan.html#test-di-ipotesi"><i class="fa fa-check"></i><b>4.3</b> Test di ipotesi</a></li>
<li class="chapter" data-level="4.4" data-path="inference-reg-lin-stan.html"><a href="inference-reg-lin-stan.html#modello-lineare-robusto"><i class="fa fa-check"></i><b>4.4</b> Modello lineare robusto</a></li>
<li class="chapter" data-level="" data-path="inference-reg-lin-stan.html"><a href="inference-reg-lin-stan.html#commenti-e-considerazioni-finali-3"><i class="fa fa-check"></i>Commenti e considerazioni finali</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="comp-two-means-stan.html"><a href="comp-two-means-stan.html"><i class="fa fa-check"></i><b>5</b> Confronto tra due gruppi indipendenti</a>
<ul>
<li class="chapter" data-level="5.1" data-path="comp-two-means-stan.html"><a href="comp-two-means-stan.html#modello-lineare-con-una-variabile-dicotomica"><i class="fa fa-check"></i><b>5.1</b> Modello lineare con una variabile dicotomica</a>
<ul>
<li class="chapter" data-level="5.1.1" data-path="comp-two-means-stan.html"><a href="comp-two-means-stan.html#confronti-non-effetti"><i class="fa fa-check"></i><b>5.1.1</b> Confronti, non effetti</a></li>
<li class="chapter" data-level="5.1.2" data-path="comp-two-means-stan.html"><a href="comp-two-means-stan.html#un-esempio-concreto"><i class="fa fa-check"></i><b>5.1.2</b> Un esempio concreto</a></li>
</ul></li>
<li class="chapter" data-level="5.2" data-path="comp-two-means-stan.html"><a href="comp-two-means-stan.html#la-dimensione-delleffetto"><i class="fa fa-check"></i><b>5.2</b> La dimensione dell’effetto</a></li>
<li class="chapter" data-level="" data-path="comp-two-means-stan.html"><a href="comp-two-means-stan.html#commenti-e-considerazioni-finali-4"><i class="fa fa-check"></i>Commenti e considerazioni finali</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="ch-pred-checks.html"><a href="ch-pred-checks.html"><i class="fa fa-check"></i><b>6</b> Predictive checks</a>
<ul>
<li class="chapter" data-level="6.1" data-path="ch-pred-checks.html"><a href="ch-pred-checks.html#campionamento-dalla-distribuzione-predittiva-a-posteriori"><i class="fa fa-check"></i><b>6.1</b> Campionamento dalla distribuzione predittiva a posteriori</a></li>
<li class="chapter" data-level="6.2" data-path="ch-pred-checks.html"><a href="ch-pred-checks.html#campionamento-dalla-distribuzione-predittiva-a-priori"><i class="fa fa-check"></i><b>6.2</b> Campionamento dalla distribuzione predittiva a priori</a></li>
<li class="chapter" data-level="" data-path="ch-pred-checks.html"><a href="ch-pred-checks.html#commenti-e-considerazioni-finali-5"><i class="fa fa-check"></i>Commenti e considerazioni finali</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="ch-anova.html"><a href="ch-anova.html"><i class="fa fa-check"></i><b>7</b> Confronto di <span class="math inline">\(k\)</span> gruppi</a>
<ul>
<li class="chapter" data-level="7.1" data-path="ch-anova.html"><a href="ch-anova.html#le-abilità-sociali-di-un-robot"><i class="fa fa-check"></i><b>7.1</b> Le abilità sociali di un robot</a></li>
<li class="chapter" data-level="7.2" data-path="ch-anova.html"><a href="ch-anova.html#anova-stan"><i class="fa fa-check"></i><b>7.2</b> I test statistici dell’Analisi della Varianza</a>
<ul>
<li class="chapter" data-level="7.2.1" data-path="ch-anova.html"><a href="ch-anova.html#test-sullinterazione"><i class="fa fa-check"></i><b>7.2.1</b> Test sull’interazione</a></li>
<li class="chapter" data-level="7.2.2" data-path="ch-anova.html"><a href="ch-anova.html#test-sugli-effetti-principali"><i class="fa fa-check"></i><b>7.2.2</b> Test sugli effetti principali</a></li>
</ul></li>
<li class="chapter" data-level="7.3" data-path="ch-anova.html"><a href="ch-anova.html#codice-stan-versione-2"><i class="fa fa-check"></i><b>7.3</b> Codice Stan (versione 2)</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="mod-hier-stan.html"><a href="mod-hier-stan.html"><i class="fa fa-check"></i><b>8</b> Modello gerarchico</a>
<ul>
<li class="chapter" data-level="8.1" data-path="mod-hier-stan.html"><a href="mod-hier-stan.html#modello-gerarchico"><i class="fa fa-check"></i><b>8.1</b> Modello gerarchico</a></li>
<li class="chapter" data-level="8.2" data-path="mod-hier-stan.html"><a href="mod-hier-stan.html#modello-ad-effetti-fissi"><i class="fa fa-check"></i><b>8.2</b> Modello ad effetti fissi</a></li>
<li class="chapter" data-level="8.3" data-path="mod-hier-stan.html"><a href="mod-hier-stan.html#modello-gerarchico-1"><i class="fa fa-check"></i><b>8.3</b> Modello gerarchico</a></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Data Science per psicologi</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="ch-pred-checks" class="section level1 hasAnchor" number="6">
<h1><span class="header-section-number">Capitolo 6</span> Predictive checks<a href="ch-pred-checks.html#ch-pred-checks" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<p>Nel Capitolo <a href="#chapter-ppc"><strong>??</strong></a> abbiamo visto come si genera la distribuzione predittiva a posteriori nel caso del modello più semplice: quello di un’unica variabile con una data distribuzione di probabilità. In questo capitolo estenderemo questa discussione al modello lineare. Esamineremo un esempio di <em>posterior predictive check</em> in cui simuleremo da <span class="math inline">\(p(y^{rep} \mid \theta, y)\)</span>, usando le stime a posteriori dei parametri <span class="math inline">\(\theta\)</span> del modello, e un esempio di <em>prior predictive check</em> in cui simuleremo da <span class="math inline">\(p(y^{rep} \mid \mathcal{M})\)</span>, ovvero usando il meccanismo generatore dei dati del modello <span class="math inline">\(\mathcal{M}\)</span> in esame, senza però includere i dati.</p>
<div id="campionamento-dalla-distribuzione-predittiva-a-posteriori" class="section level2 hasAnchor" number="6.1">
<h2><span class="header-section-number">6.1</span> Campionamento dalla distribuzione predittiva a posteriori<a href="ch-pred-checks.html#campionamento-dalla-distribuzione-predittiva-a-posteriori" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>La distribuzione predittiva a priori equivale alla distribuzione predittiva a posteriori, senza però i dati osservati. Quindi la distribuzione predittiva a priori non è altro che il caso limite della distribuzione predittiva a posteriori, calcolata però senza utilizzare i dati del campione. Il manuale Stan afferma che, se il codice per il il controllo predittivo a posteriori è già stato scritto, ed è possibile impostare il codice in modo che non sia necessario specificare i dati, allora non è necessario fare nient’altro.</p>
<p>Consideriamo qui un esempio nel quale vengono usati i dati <code>kidiq</code> <span class="citation">(<a href="#ref-gelman2020regression" role="doc-biblioref">Gelman, Hill, and Vehtari 2020</a>)</span>.</p>
<div class="sourceCode" id="cb89"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb89-1"><a href="ch-pred-checks.html#cb89-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(<span class="st">&quot;rio&quot;</span>)</span>
<span id="cb89-2"><a href="ch-pred-checks.html#cb89-2" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> rio<span class="sc">::</span><span class="fu">import</span>(<span class="fu">here</span>(<span class="st">&quot;data&quot;</span>, <span class="st">&quot;kidiq.dta&quot;</span>))</span></code></pre></div>
<p>Iniziamo a generare un istogramma dei valori <span class="math inline">\(y\)</span> stanardizzati:</p>
<div class="sourceCode" id="cb90"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb90-1"><a href="ch-pred-checks.html#cb90-1" aria-hidden="true" tabindex="-1"></a>df <span class="sc">%&gt;%</span> </span>
<span id="cb90-2"><a href="ch-pred-checks.html#cb90-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="fu">scale</span>(kid_score)[, <span class="dv">1</span>])) <span class="sc">+</span></span>
<span id="cb90-3"><a href="ch-pred-checks.html#cb90-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>()</span></code></pre></div>
<p><img src="ds4psy_files/figure-html/unnamed-chunk-94-1.png" width="576" style="display: block; margin: auto;" /></p>
<p>Per svolgere l’analisi bayesiana sistemiamo i dati (standardizzati) nel formato appropriato per Stan:</p>
<div class="sourceCode" id="cb91"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb91-1"><a href="ch-pred-checks.html#cb91-1" aria-hidden="true" tabindex="-1"></a>data_list <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb91-2"><a href="ch-pred-checks.html#cb91-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">N =</span> <span class="fu">length</span>(df<span class="sc">$</span>kid_score),</span>
<span id="cb91-3"><a href="ch-pred-checks.html#cb91-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">x =</span> <span class="fu">scale</span>(df<span class="sc">$</span>mom_iq)[, <span class="dv">1</span>],</span>
<span id="cb91-4"><a href="ch-pred-checks.html#cb91-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">y =</span> <span class="fu">scale</span>(df<span class="sc">$</span>kid_score)[, <span class="dv">1</span>]</span>
<span id="cb91-5"><a href="ch-pred-checks.html#cb91-5" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<p>Il seguente listato specifica il codice Stan necessario per simulare dati dalla distribuzione predittiva a posteriori.</p>
<div class="sourceCode" id="cb92"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb92-1"><a href="ch-pred-checks.html#cb92-1" aria-hidden="true" tabindex="-1"></a>stancode <span class="ot">&lt;-</span> <span class="st">&#39;</span></span>
<span id="cb92-2"><a href="ch-pred-checks.html#cb92-2" aria-hidden="true" tabindex="-1"></a><span class="st">data {</span></span>
<span id="cb92-3"><a href="ch-pred-checks.html#cb92-3" aria-hidden="true" tabindex="-1"></a><span class="st">  int&lt;lower=0&gt; N;  </span></span>
<span id="cb92-4"><a href="ch-pred-checks.html#cb92-4" aria-hidden="true" tabindex="-1"></a><span class="st">  vector[N] x; </span></span>
<span id="cb92-5"><a href="ch-pred-checks.html#cb92-5" aria-hidden="true" tabindex="-1"></a><span class="st">  vector[N] y; </span></span>
<span id="cb92-6"><a href="ch-pred-checks.html#cb92-6" aria-hidden="true" tabindex="-1"></a><span class="st">}</span></span>
<span id="cb92-7"><a href="ch-pred-checks.html#cb92-7" aria-hidden="true" tabindex="-1"></a><span class="st">parameters {</span></span>
<span id="cb92-8"><a href="ch-pred-checks.html#cb92-8" aria-hidden="true" tabindex="-1"></a><span class="st">  real alpha;</span></span>
<span id="cb92-9"><a href="ch-pred-checks.html#cb92-9" aria-hidden="true" tabindex="-1"></a><span class="st">  real beta;</span></span>
<span id="cb92-10"><a href="ch-pred-checks.html#cb92-10" aria-hidden="true" tabindex="-1"></a><span class="st">  real&lt;lower=0&gt; sigma;</span></span>
<span id="cb92-11"><a href="ch-pred-checks.html#cb92-11" aria-hidden="true" tabindex="-1"></a><span class="st">}</span></span>
<span id="cb92-12"><a href="ch-pred-checks.html#cb92-12" aria-hidden="true" tabindex="-1"></a><span class="st">model {</span></span>
<span id="cb92-13"><a href="ch-pred-checks.html#cb92-13" aria-hidden="true" tabindex="-1"></a><span class="st">  alpha ~ normal(0, 1);</span></span>
<span id="cb92-14"><a href="ch-pred-checks.html#cb92-14" aria-hidden="true" tabindex="-1"></a><span class="st">  beta ~ normal(0, 1);</span></span>
<span id="cb92-15"><a href="ch-pred-checks.html#cb92-15" aria-hidden="true" tabindex="-1"></a><span class="st">  sigma ~ normal(0, 1);</span></span>
<span id="cb92-16"><a href="ch-pred-checks.html#cb92-16" aria-hidden="true" tabindex="-1"></a><span class="st">  y ~ normal(alpha + beta * x, sigma);</span></span>
<span id="cb92-17"><a href="ch-pred-checks.html#cb92-17" aria-hidden="true" tabindex="-1"></a><span class="st">}</span></span>
<span id="cb92-18"><a href="ch-pred-checks.html#cb92-18" aria-hidden="true" tabindex="-1"></a><span class="st">generated quantities {</span></span>
<span id="cb92-19"><a href="ch-pred-checks.html#cb92-19" aria-hidden="true" tabindex="-1"></a><span class="st">  vector[N] y_rep;</span></span>
<span id="cb92-20"><a href="ch-pred-checks.html#cb92-20" aria-hidden="true" tabindex="-1"></a><span class="st">  for(i in 1:N){</span></span>
<span id="cb92-21"><a href="ch-pred-checks.html#cb92-21" aria-hidden="true" tabindex="-1"></a><span class="st">    y_rep[i] = normal_rng(alpha + beta * x[i], sigma);</span></span>
<span id="cb92-22"><a href="ch-pred-checks.html#cb92-22" aria-hidden="true" tabindex="-1"></a><span class="st">  }</span></span>
<span id="cb92-23"><a href="ch-pred-checks.html#cb92-23" aria-hidden="true" tabindex="-1"></a><span class="st">}</span></span>
<span id="cb92-24"><a href="ch-pred-checks.html#cb92-24" aria-hidden="true" tabindex="-1"></a><span class="st">&#39;</span></span>
<span id="cb92-25"><a href="ch-pred-checks.html#cb92-25" aria-hidden="true" tabindex="-1"></a><span class="fu">writeLines</span>(stancode, <span class="at">con =</span> <span class="st">&quot;code/post_pred_check_1.stan&quot;</span>)</span></code></pre></div>
<div class="sourceCode" id="cb93"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb93-1"><a href="ch-pred-checks.html#cb93-1" aria-hidden="true" tabindex="-1"></a>file <span class="ot">&lt;-</span> <span class="fu">file.path</span>(<span class="st">&quot;code&quot;</span>, <span class="st">&quot;post_pred_check_1.stan&quot;</span>)</span>
<span id="cb93-2"><a href="ch-pred-checks.html#cb93-2" aria-hidden="true" tabindex="-1"></a>mod <span class="ot">&lt;-</span> <span class="fu">cmdstan_model</span>(file)</span></code></pre></div>
<div class="sourceCode" id="cb94"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb94-1"><a href="ch-pred-checks.html#cb94-1" aria-hidden="true" tabindex="-1"></a>fit <span class="ot">&lt;-</span> mod<span class="sc">$</span><span class="fu">sample</span>(</span>
<span id="cb94-2"><a href="ch-pred-checks.html#cb94-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> data_list,</span>
<span id="cb94-3"><a href="ch-pred-checks.html#cb94-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">iter_sampling =</span> 4000L,</span>
<span id="cb94-4"><a href="ch-pred-checks.html#cb94-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">iter_warmup =</span> 2000L,</span>
<span id="cb94-5"><a href="ch-pred-checks.html#cb94-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">seed =</span> SEED,</span>
<span id="cb94-6"><a href="ch-pred-checks.html#cb94-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">chains =</span> 4L,</span>
<span id="cb94-7"><a href="ch-pred-checks.html#cb94-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">parallel_chains =</span> 2L,</span>
<span id="cb94-8"><a href="ch-pred-checks.html#cb94-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">refresh =</span> <span class="dv">0</span>,</span>
<span id="cb94-9"><a href="ch-pred-checks.html#cb94-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">thin =</span> <span class="dv">1</span></span>
<span id="cb94-10"><a href="ch-pred-checks.html#cb94-10" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<div class="sourceCode" id="cb95"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb95-1"><a href="ch-pred-checks.html#cb95-1" aria-hidden="true" tabindex="-1"></a>stanfit1 <span class="ot">&lt;-</span> rstan<span class="sc">::</span><span class="fu">read_stan_csv</span>(fit<span class="sc">$</span><span class="fu">output_files</span>())</span></code></pre></div>
<p>Un istogramme dei valori <span class="math inline">\(y^{rep}\)</span> può essere generato nel modo seguente:</p>
<div class="sourceCode" id="cb96"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb96-1"><a href="ch-pred-checks.html#cb96-1" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(<span class="fu">as.matrix</span>(stanfit1, <span class="at">pars =</span> <span class="st">&quot;y_rep&quot;</span>), <span class="at">breaks =</span> <span class="dv">100</span>)</span></code></pre></div>
<p><img src="ds4psy_files/figure-html/unnamed-chunk-100-1.png" width="576" style="display: block; margin: auto;" /></p>
</div>
<div id="campionamento-dalla-distribuzione-predittiva-a-priori" class="section level2 hasAnchor" number="6.2">
<h2><span class="header-section-number">6.2</span> Campionamento dalla distribuzione predittiva a priori<a href="ch-pred-checks.html#campionamento-dalla-distribuzione-predittiva-a-priori" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Per comprendere le assunzioni che abbiamo introdotto nel modello, possiamo generare dati mediante il modello; tali dati, che sono generati interamente dalle distribuzioni a priori, sono chiamati distribuzione predittiva a priori. La generazione della distribuzione predittiva a priori ci aiuta a verificare se le distribuzioni a priori per i parametri del modello hanno senso. Quello che vogliamo sapere qui è: le distribuzioni a priori che abbiamo scelto generano dati che hanno caratteristiche realistiche?</p>
<p>Dal punto di vista della programmazione, l’unico cambiamento necessario rispetto al codice utilizzato per la distribuzione predittiva a posteriori è quello di eliminare la porzione di codice che fa riferimento ai dati <span class="math inline">\(y\)</span> – nel caso di un modello lineare, i valori <span class="math inline">\(x\)</span> devono invece essere mantenuti per potere generare <span class="math inline">\(y^{sim}\)</span> (nel codice questa variabile è ancora chiamata <code>y_rep</code>).</p>
<div class="sourceCode" id="cb97"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb97-1"><a href="ch-pred-checks.html#cb97-1" aria-hidden="true" tabindex="-1"></a>data_list <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb97-2"><a href="ch-pred-checks.html#cb97-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">N =</span> <span class="fu">length</span>(df<span class="sc">$</span>kid_score),</span>
<span id="cb97-3"><a href="ch-pred-checks.html#cb97-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">x =</span> <span class="fu">scale</span>(df<span class="sc">$</span>mom_iq)[, <span class="dv">1</span>]</span>
<span id="cb97-4"><a href="ch-pred-checks.html#cb97-4" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<div class="sourceCode" id="cb98"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb98-1"><a href="ch-pred-checks.html#cb98-1" aria-hidden="true" tabindex="-1"></a>stancode <span class="ot">&lt;-</span> <span class="st">&#39;</span></span>
<span id="cb98-2"><a href="ch-pred-checks.html#cb98-2" aria-hidden="true" tabindex="-1"></a><span class="st">data {</span></span>
<span id="cb98-3"><a href="ch-pred-checks.html#cb98-3" aria-hidden="true" tabindex="-1"></a><span class="st">  int&lt;lower=0&gt; N;  </span></span>
<span id="cb98-4"><a href="ch-pred-checks.html#cb98-4" aria-hidden="true" tabindex="-1"></a><span class="st">  vector[N] x; </span></span>
<span id="cb98-5"><a href="ch-pred-checks.html#cb98-5" aria-hidden="true" tabindex="-1"></a><span class="st">}</span></span>
<span id="cb98-6"><a href="ch-pred-checks.html#cb98-6" aria-hidden="true" tabindex="-1"></a><span class="st">parameters {</span></span>
<span id="cb98-7"><a href="ch-pred-checks.html#cb98-7" aria-hidden="true" tabindex="-1"></a><span class="st">  real alpha;</span></span>
<span id="cb98-8"><a href="ch-pred-checks.html#cb98-8" aria-hidden="true" tabindex="-1"></a><span class="st">  real beta;</span></span>
<span id="cb98-9"><a href="ch-pred-checks.html#cb98-9" aria-hidden="true" tabindex="-1"></a><span class="st">  real&lt;lower=0&gt; sigma;</span></span>
<span id="cb98-10"><a href="ch-pred-checks.html#cb98-10" aria-hidden="true" tabindex="-1"></a><span class="st">}</span></span>
<span id="cb98-11"><a href="ch-pred-checks.html#cb98-11" aria-hidden="true" tabindex="-1"></a><span class="st">model {</span></span>
<span id="cb98-12"><a href="ch-pred-checks.html#cb98-12" aria-hidden="true" tabindex="-1"></a><span class="st">  alpha ~ normal(0, 1);</span></span>
<span id="cb98-13"><a href="ch-pred-checks.html#cb98-13" aria-hidden="true" tabindex="-1"></a><span class="st">  beta ~ normal(0, 1);</span></span>
<span id="cb98-14"><a href="ch-pred-checks.html#cb98-14" aria-hidden="true" tabindex="-1"></a><span class="st">  sigma ~ normal(0, 1);</span></span>
<span id="cb98-15"><a href="ch-pred-checks.html#cb98-15" aria-hidden="true" tabindex="-1"></a><span class="st">}</span></span>
<span id="cb98-16"><a href="ch-pred-checks.html#cb98-16" aria-hidden="true" tabindex="-1"></a><span class="st">generated quantities {</span></span>
<span id="cb98-17"><a href="ch-pred-checks.html#cb98-17" aria-hidden="true" tabindex="-1"></a><span class="st">  vector[N] y_rep;</span></span>
<span id="cb98-18"><a href="ch-pred-checks.html#cb98-18" aria-hidden="true" tabindex="-1"></a><span class="st">  for(i in 1:N){</span></span>
<span id="cb98-19"><a href="ch-pred-checks.html#cb98-19" aria-hidden="true" tabindex="-1"></a><span class="st">    y_rep[i] = normal_rng(alpha + beta * x[i], sigma);</span></span>
<span id="cb98-20"><a href="ch-pred-checks.html#cb98-20" aria-hidden="true" tabindex="-1"></a><span class="st">  }</span></span>
<span id="cb98-21"><a href="ch-pred-checks.html#cb98-21" aria-hidden="true" tabindex="-1"></a><span class="st">}</span></span>
<span id="cb98-22"><a href="ch-pred-checks.html#cb98-22" aria-hidden="true" tabindex="-1"></a><span class="st">&#39;</span></span>
<span id="cb98-23"><a href="ch-pred-checks.html#cb98-23" aria-hidden="true" tabindex="-1"></a><span class="fu">writeLines</span>(stancode, <span class="at">con =</span> <span class="st">&quot;code/prior_pred_check_1.stan&quot;</span>)</span></code></pre></div>
<div class="sourceCode" id="cb99"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb99-1"><a href="ch-pred-checks.html#cb99-1" aria-hidden="true" tabindex="-1"></a>file <span class="ot">&lt;-</span> <span class="fu">file.path</span>(<span class="st">&quot;code&quot;</span>, <span class="st">&quot;prior_pred_check_1.stan&quot;</span>)</span>
<span id="cb99-2"><a href="ch-pred-checks.html#cb99-2" aria-hidden="true" tabindex="-1"></a>mod <span class="ot">&lt;-</span> <span class="fu">cmdstan_model</span>(file)</span></code></pre></div>
<div class="sourceCode" id="cb100"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb100-1"><a href="ch-pred-checks.html#cb100-1" aria-hidden="true" tabindex="-1"></a>fit <span class="ot">&lt;-</span> mod<span class="sc">$</span><span class="fu">sample</span>(</span>
<span id="cb100-2"><a href="ch-pred-checks.html#cb100-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> data_list,</span>
<span id="cb100-3"><a href="ch-pred-checks.html#cb100-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">iter_sampling =</span> 4000L,</span>
<span id="cb100-4"><a href="ch-pred-checks.html#cb100-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">iter_warmup =</span> 2000L,</span>
<span id="cb100-5"><a href="ch-pred-checks.html#cb100-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">seed =</span> SEED,</span>
<span id="cb100-6"><a href="ch-pred-checks.html#cb100-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">chains =</span> 4L,</span>
<span id="cb100-7"><a href="ch-pred-checks.html#cb100-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">parallel_chains =</span> 2L,</span>
<span id="cb100-8"><a href="ch-pred-checks.html#cb100-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">refresh =</span> <span class="dv">0</span>,</span>
<span id="cb100-9"><a href="ch-pred-checks.html#cb100-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">thin =</span> <span class="dv">1</span></span>
<span id="cb100-10"><a href="ch-pred-checks.html#cb100-10" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<div class="sourceCode" id="cb101"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb101-1"><a href="ch-pred-checks.html#cb101-1" aria-hidden="true" tabindex="-1"></a>stanfit2 <span class="ot">&lt;-</span> rstan<span class="sc">::</span><span class="fu">read_stan_csv</span>(fit<span class="sc">$</span><span class="fu">output_files</span>())</span></code></pre></div>
<p>Questo è un istogramma della distribuzione preditiva a priori. Tale distribuzione viene usata per valutare se le distribuzioni a priori dei parametri sono sensate. Concludiamo che sono sensate se la distribuzione preditiva a priori include tutti i valori possibili della distribuzione della <span class="math inline">\(y\)</span>, senza scostarsti troppo da essa.</p>
<div class="sourceCode" id="cb102"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb102-1"><a href="ch-pred-checks.html#cb102-1" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(<span class="fu">as.matrix</span>(stanfit2, <span class="at">pars =</span> <span class="st">&quot;y_rep&quot;</span>), <span class="at">breaks =</span> <span class="dv">100</span>)</span></code></pre></div>
<p><img src="ds4psy_files/figure-html/unnamed-chunk-106-1.png" width="576" style="display: block; margin: auto;" /></p>
</div>
<div id="commenti-e-considerazioni-finali-5" class="section level2 unnumbered hasAnchor">
<h2>Commenti e considerazioni finali<a href="ch-pred-checks.html#commenti-e-considerazioni-finali-5" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>I due <em>predictive checks</em> che abbiamo esaminato in questo capitolo servono due scopi diversi.</p>
<p>La distribuzione predittiva a priori viene utilizzata per comprendere le assunzioni introdotte nel modello. Per fare questo possiamo generare dei dati dal modello. Tali dati, che vengono prodotti interamente dalle distribuzioni a priori, sono chiamati distribuzione predittiva a priori. La distribuzione predittiva a priori ci aiuta a capire se le distribuzioni a priori per i parametri del modello hanno un senso. Quello che ci chiedimo è: le distribuzioni a priori generano dei dati che hanno caratteristiche realistiche? Una risposta affermativa a tale domanda corrisponde ad una distribuzione predittiva a priori che è più ampia della distribuzione dei dati osservati, in linea con il principio dei prior debolmente informativi. Tale distribuzione dovrebbe avere almeno una qualche massa nell’intorno ai valori estremi, ma plausibili dei dati; non dovrebbe, invece, esserci massa in corrispondenza di valori di dati completamente implausibili.</p>
<p>La distribuzione predittiva a posteriori viene invece utilizzata per esplorare le caratteristiche che potrebbero avere i possibili dati futuri. L’idea alla base del controllo predittivo a posteriori è semplice: se un modello è appropriato, dovremmo essere in grado di usarlo per generare dati che assomigliano ai dati che abbiamo osservato nel campione. La motivazione è simile a quella che ci ha condotto alla distribuzione predittiva a priori, tranne per il fatto che ora abbiamo un modello generativo dei dati basato sui dati osservati.</p>

</div>
</div>
<h3>References</h3>
<div id="refs" class="references csl-bib-body hanging-indent">
<div id="ref-gelman2020regression" class="csl-entry">
Gelman, Andrew, Jennifer Hill, and Aki Vehtari. 2020. <em>Regression and Other Stories</em>. Cambridge University Press.
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="comp-two-means-stan.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="ch-anova.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/rstudio/bookdown-demo/edit/master/056_pred_check.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["ds4psy.pdf", "ds4psy.epub"],
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
